{"hash": "27bb76cf2c5f269835f8c32e47c2b60b4ea54edf", "message": "refactoring in aggregation query. add countGroupBy test", "file_num_lines": 108, "diff_parsed": {"added": [[10, "import org.elasticsearch.index.query.BoolQueryBuilder;"], [28, "import org.nlpcn.es4sql.query.maker.QueryMaker;"], [30, "/**"], [31, " * Transform SQL query to Elasticsearch aggregations query"], [32, " */"], [43, "\t\tsetWhere(select.getWhere());"], [54, ""], [55, "\t\t\trequest.addAggregation(lastAgg);"], [56, ""], [72, "\t\t\texplanFields(request, select.getFields(), lastAgg);"], [106, "\tprivate void explanFields(SearchRequestBuilder request, List<Field> fields, AggregationBuilder<?> groupByAgg) throws SqlParseException {"], [112, "\t\t\t\t}"], [113, "\t\t\t\t else {"], [123, ""], [124, "\t/**"], [125, "\t * Create filters based on"], [126, "\t * the Where clause."], [127, "\t * @param where the 'WHERE' part of the SQL query."], [128, "\t * @throws SqlParseException"], [129, "\t */"], [130, "\tprivate void setWhere(Where where) throws SqlParseException {"], [131, "\t\tif (where != null) {"], [132, "\t\t\tBoolFilterBuilder boolFilter = FilterMaker.explan(where);"], [133, "\t\t\trequest.setQuery(QueryBuilders.filteredQuery(null, boolFilter));"], [134, "\t\t}"], [135, "\t}"]], "deleted": [[38, ""], [39, "\t\tBoolFilterBuilder boolFilter = null;"], [40, "\t\t// set where"], [41, "\t\tWhere where = select.getWhere();"], [42, ""], [44, "\t\tFilterAggregationBuilder filter = null;"], [46, "\t\tif (where != null) {"], [47, "\t\t\tboolFilter = FilterMaker.explan(where);"], [48, "\t\t\trequest.setQuery(QueryBuilders.filteredQuery(null, boolFilter));"], [49, "\t\t}"], [50, ""], [51, "\t\t//"], [60, ""], [61, "\t\t\tif (filter != null) {"], [62, "\t\t\t\tfilter.subAggregation(lastAgg);"], [63, "\t\t\t} else {"], [64, "\t\t\t\trequest.addAggregation(lastAgg);"], [65, "\t\t\t}"], [81, "\t\t\texplanFields(request, select.getFields(), lastAgg, filter);"], [115, "\tprivate void explanFields(SearchRequestBuilder request, List<Field> fields, AggregationBuilder<?> groupByAgg, FilterAggregationBuilder filter) throws SqlParseException {"], [121, "\t\t\t\t} else if (filter != null) {"], [122, "\t\t\t\t\tfilter.subAggregation(makeAgg);"], [123, "\t\t\t\t} else {"]]}, "num_lines_added": 26, "num_lines_removed": 23}