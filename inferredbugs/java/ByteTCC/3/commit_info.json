{"hash": "92d06ba94302425b3f1a19e18c669c5977f37bf2", "message": "\u4fee\u590dparticipant\u5728\u8d85\u65f6\u573a\u666f\u4e0b\u4e8b\u52a1\u5904\u7406\u5f02\u5e38\u7684\u95ee\u9898", "file_num_lines": 1123, "diff_parsed": {"added": [[898, "\t\t\tthis.onCompletionPhaseCommitSuccess(xid);"], [899, "\t\t} else {"], [900, "\t\t\tthis.onInvocationPhaseCommitSuccess(xid);"], [901, "\t\t}"], [902, "\t}"], [904, "\tprivate void onInvocationPhaseCommitSuccess(Xid xid) {"], [905, "\t\tCompensableLogger compensableLogger = this.beanFactory.getCompensableLogger();"], [906, "\t\tif (this.transactionContext.isCoordinator() && this.transactionContext.isPropagated() == false"], [939, "\t}"], [940, ""], [941, "\tprivate void onCompletionPhaseCommitSuccess(Xid actualXid) {"], [942, "\t\tXid expectXid = this.archive == null ? null : this.archive.getCompensableXid();"], [943, "\t\tif (CommonUtils.equals(expectXid, actualXid) == false) {"], [944, "\t\t\tthrow new IllegalStateException(\"Illegal state: maybe the try phase operation has timed out.!\");"], [945, "\t\t} // end-if (CommonUtils.equals(expectXid, actualXid) == false)"], [946, ""], [947, "\t\tif (this.positive == null) {"], [948, "\t\t\tthis.beanFactory.getCompensableLogger().updateCompensable(this.archive);"], [949, "\t\t\treturn;"], [950, "\t\t}"], [952, "\t\tif (this.positive) {"], [953, "\t\t\tlogger.info(\"{}| confirm: identifier= {}, resourceKey= {}, resourceXid= {}.\","], [954, "\t\t\t\t\tByteUtils.byteArrayToString(transactionContext.getXid().getGlobalTransactionId()),"], [955, "\t\t\t\t\tByteUtils.byteArrayToString(this.archive.getIdentifier().getGlobalTransactionId()),"], [956, "\t\t\t\t\tthis.archive.getCompensableResourceKey(), this.archive.getCompensableXid());"], [957, ""], [958, "\t\t\tthis.archive.setConfirmed(true);"], [959, "\t\t} else {"], [960, "\t\t\tlogger.info(\"{}| cancel: identifier= {}, resourceKey= {}, resourceXid= {}.\","], [961, "\t\t\t\t\tByteUtils.byteArrayToString(transactionContext.getXid().getGlobalTransactionId()),"], [962, "\t\t\t\t\tByteUtils.byteArrayToString(this.archive.getIdentifier().getGlobalTransactionId()),"], [963, "\t\t\t\t\tthis.archive.getCompensableResourceKey(), this.archive.getCompensableXid());"], [964, ""], [965, "\t\t\tthis.archive.setCancelled(true);"], [966, "\t\t}"], [967, ""], [968, "\t\tthis.beanFactory.getCompensableLogger().updateCompensable(this.archive);"]], "deleted": [[897, "\t\tCompensableLogger compensableLogger = this.beanFactory.getCompensableLogger();"], [898, ""], [900, "\t\t\tif (this.positive == null) {"], [901, "\t\t\t\t// ignore"], [902, "\t\t\t} else if (this.positive) {"], [903, "\t\t\t\tthis.archive.setConfirmed(true);"], [904, ""], [905, "\t\t\t\tlogger.info(\"{}| confirm: identifier= {}, resourceKey= {}, resourceXid= {}.\","], [906, "\t\t\t\t\t\tByteUtils.byteArrayToString(transactionContext.getXid().getGlobalTransactionId()),"], [907, "\t\t\t\t\t\tByteUtils.byteArrayToString(this.archive.getIdentifier().getGlobalTransactionId()),"], [908, "\t\t\t\t\t\tthis.archive.getCompensableResourceKey(), this.archive.getCompensableXid());"], [909, "\t\t\t} else {"], [910, "\t\t\t\tthis.archive.setCancelled(true);"], [912, "\t\t\t\tlogger.info(\"{}| cancel: identifier= {}, resourceKey= {}, resourceXid= {}.\","], [913, "\t\t\t\t\t\tByteUtils.byteArrayToString(transactionContext.getXid().getGlobalTransactionId()),"], [914, "\t\t\t\t\t\tByteUtils.byteArrayToString(this.archive.getIdentifier().getGlobalTransactionId()),"], [915, "\t\t\t\t\t\tthis.archive.getCompensableResourceKey(), this.archive.getCompensableXid());"], [916, "\t\t\t}"], [917, "\t\t\tcompensableLogger.updateCompensable(this.archive);"], [918, "\t\t} else if (this.transactionContext.isCoordinator() && this.transactionContext.isPropagated() == false"]]}, "num_lines_added": 37, "num_lines_removed": 20}