{"hash": "a99fcde160bf30c613b868e6b1b3badaea2a6458", "message": "\u89e3\u51b3issues/41\uff1a\u3010\u9879\u76ee\u62a5\u9519\uff1acom.xxl.conf.core.exception.XxlConfException: XxlZkClient.zooKeeper is null\u3011   https://github.com/xuxueli/xxl-conf/issues/41", "file_num_lines": 156, "diff_parsed": {"added": [[9, "import java.io.IOException;"], [13, "import java.util.concurrent.CountDownLatch;"], [73, "                    if (Event.KeeperState.SyncConnected == watchedEvent.getState()) {"], [74, "                        connectedSemaphore.countDown();"], [75, "                    }"], [90, "    private CountDownLatch connectedSemaphore = new CountDownLatch(1);"], [92, "        if (zooKeeper == null) {"], [93, "            try {"], [94, "                zooKeeper = new ZooKeeper(zkaddress, 10000, watcher);        // TODO\uff0c\u672c\u5730\u53d8\u91cf\u65b9\u5f0f\uff0c\u6210\u529f\u624d\u4f1a\u8d4b\u503c"], [95, "                if (zkdigest != null && zkdigest.trim().length() > 0) {"], [96, "                    zooKeeper.addAuthInfo(\"digest\", zkdigest.getBytes());        // like \"account:password\""], [97, "                }"], [98, "                zooKeeper.exists(zkpath, false);    // sync"], [99, "                connectedSemaphore.await();"], [100, "            } catch (InterruptedException e) {"], [101, "                logger.error(e.getMessage(), e);"], [102, "            } catch (KeeperException e) {"], [103, "                logger.error(e.getMessage(), e);"], [104, "            } catch (IOException e) {"], [105, "                logger.error(e.getMessage(), e);"], [106, "            }"], [107, "        }"], [108, "        if (zooKeeper == null) {"]], "deleted": [[12, "import java.util.concurrent.TimeUnit;"], [13, "import java.util.concurrent.locks.ReentrantLock;"], [73, ""], [88, "\tprivate ReentrantLock INSTANCE_INIT_LOCK = new ReentrantLock(true);"], [90, "\t\tif (zooKeeper==null) {"], [91, "\t\t\ttry {"], [92, "\t\t\t\tif (INSTANCE_INIT_LOCK.tryLock(2, TimeUnit.SECONDS)) {"], [93, "\t\t\t\t\tif (zooKeeper==null) {\t\t// \u4e8c\u6b21\u6821\u9a8c\uff0c\u9632\u6b62\u5e76\u53d1\u521b\u5efaclient"], [94, "\t\t\t\t\t\ttry {"], [95, "\t\t\t\t\t\t\tzooKeeper = new ZooKeeper(zkaddress, 10000, watcher);\t\t// TODO\uff0c\u672c\u5730\u53d8\u91cf\u65b9\u5f0f\uff0c\u6210\u529f\u624d\u4f1a\u8d4b\u503c"], [96, "\t\t\t\t\t\t\tif (zkdigest!=null && zkdigest.trim().length()>0) {"], [97, "\t\t\t\t\t\t\t\tzooKeeper.addAuthInfo(\"digest\",zkdigest.getBytes());\t\t// like \"account:password\""], [98, "\t\t\t\t\t\t\t}"], [99, ""], [100, "\t\t\t\t\t\t\tzooKeeper.exists(zkpath, false);\t// sync"], [101, "\t\t\t\t\t\t} catch (Exception e) {"], [102, "\t\t\t\t\t\t\tlogger.error(e.getMessage(), e);"], [103, "\t\t\t\t\t\t} finally {"], [104, "\t\t\t\t\t\t\tINSTANCE_INIT_LOCK.unlock();"], [105, "\t\t\t\t\t\t}"], [106, "\t\t\t\t\t\tlogger.info(\">>>>>>>>>> xxl-conf, XxlZkClient init success.\");"], [107, "\t\t\t\t\t}"], [108, "\t\t\t\t}"], [109, "\t\t\t} catch (InterruptedException e) {"], [110, "\t\t\t\tlogger.error(e.getMessage(), e);"], [111, "\t\t\t}"], [112, "\t\t}"], [113, "\t\tif (zooKeeper == null) {"]]}, "num_lines_added": 23, "num_lines_removed": 28}