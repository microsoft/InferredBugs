{"hash": "f32c301ecfc17a9d1ccb0568b81daa9b8935d8ac", "message": "Load correct region when multiple CLI profiles defined. Support AWS CLI profiles via \"--profile\" parameter. Use \"default\" profile by default.", "file_num_lines": 50, "diff_parsed": {"added": [[6, "import java.io.BufferedReader;"], [7, "import java.io.File;"], [8, "import java.io.FileReader;"], [9, "import java.util.Optional;"], [13, "    public static final String DEFAULT_REGION = \"us-east-1\";"], [15, "    private String region;"], [16, "    private String profile;"], [17, ""], [18, "    public AwsConfig(String profile) {"], [19, "        this.profile = profile;"], [20, "    }"], [31, "        Optional<String> region = loadRegion();"], [33, "        if (region.isPresent()) {"], [34, "            this.region = region.get();"], [35, "        } else {"], [36, "            this.region = DEFAULT_REGION;"], [37, "            LOG.warn(\"Could not load region configuration. Please ensure AWS CLI is \" +"], [38, "                             \"configured via 'aws configure'. Will use default region of \" + this.region);"], [40, "    }"], [42, "    private Optional<String> loadRegion() {"], [43, "        String file = System.getProperty(\"user.home\") + \"/.aws/config\";"], [45, "        boolean foundProfile = false;"], [46, "        try (BufferedReader br = new BufferedReader(new FileReader(new File(file)))) {"], [47, "            String line;"], [48, "            while ((line = br.readLine()) != null) {"], [49, ""], [50, "                if (line.startsWith(\"[\") && line.contains(this.profile)) {"], [51, "                    foundProfile = true;"], [52, "                }"], [53, ""], [54, "                if (foundProfile && line.startsWith(\"region\")) {"], [55, "                    return Optional.of(line.substring(9, line.length()));"], [56, "                }"], [57, "            }"], [58, "        } catch (Throwable t) {"], [59, "            throw new RuntimeException(\"Could not load configuration. Please run 'aws configure'\");"], [62, "        return Optional.empty();"]], "deleted": [[6, "import java.io.FileInputStream;"], [7, "import java.io.IOException;"], [8, "import java.util.Properties;"], [13, "    private String region = \"us-east-1\";"], [14, "    private String profile = \"default\";"], [25, "        String home = System.getProperty(\"user.home\");"], [26, ""], [27, "        Properties awsConfigProperties = new Properties();"], [29, "        try {"], [30, "            // todo: use default profile"], [31, "            awsConfigProperties.load(new FileInputStream(home + \"/.aws/config\"));"], [32, "        } catch (IOException e) {"], [33, "            throw new RuntimeException(\"Could not load configuration. Please run 'aws configure'\");"], [36, "        String region = awsConfigProperties.getProperty(\"region\");"], [38, "        if (region != null) {"], [39, "            this.region = region;"], [40, "        } else {"], [41, "            LOG.warn(\"Could not load region configuration. Please ensure AWS CLI is configured via 'aws configure'. Will use default region of \" + this.region);"]]}, "num_lines_added": 37, "num_lines_removed": 18}