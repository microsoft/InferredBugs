{"hash": "172fb9dc50a79f60efa547387784019c699d5019", "message": "update ...", "file_num_lines": 448, "diff_parsed": {"added": [[260, "\t\t//\u5224\u65ad\u6587\u4ef6\u5927\u5c0f\u662f\u5426\u8d85\u51fa\u6700\u5927\u9650\u5236\u7684\u5927\u5c0f"], [261, "\t\tint lengthKB = 0;"], [262, "\t\ttry {"], [263, "\t\t\tlengthKB = (int) Math.ceil(inputStream.available()/1024);"], [264, "\t\t} catch (IOException e) {"], [265, "\t\t\te.printStackTrace();"], [266, "\t\t}"], [267, "\t\tvo = verifyFileMaxLength(lengthKB);"], [268, "\t\tif(vo.getResult() - UploadFileVO.FAILURE == 0){"], [269, "\t\t\treturn vo;"], [270, "\t\t}"], [271, "\t\tvo.setSize(lengthKB);"], [272, ""], [382, "\t * SpringMVC \u4e0a\u4f20\u6587\u4ef6\uff0c\u914d\u7f6e\u5141\u8bb8\u4e0a\u4f20\u7684\u6587\u4ef6\u540e\u7f00\u518d systemConfig.xml \u7684attachmentFile.allowUploadSuffix.suffix\u8282\u70b9"], [383, "\t * @param filePath \u4e0a\u4f20\u540e\u7684\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u3001\u8def\u5f84\uff0c\u5982 \"jar/file/\""], [384, "\t * @param multipartFile SpringMVC\u63a5\u6536\u7684 {@link MultipartFile},\u82e5\u662f\u6709\u4e0a\u4f20\u6587\u4ef6\uff0c\u4f1a\u81ea\u52a8\u8f6c\u5316\u4e3a{@link MultipartFile}\u4fdd\u5b58"], [385, "\t * @return {@link UploadFileVO} \u82e5\u6210\u529f\uff0c\u5219\u4e0a\u4f20\u4e86\u6587\u4ef6\u5e76\u4e14\u4e0a\u4f20\u6210\u529f"], [386, "\t */"], [387, "\tpublic static UploadFileVO uploadFileByMultipartFile(String filePath, MultipartFile multipartFile) {"], [388, "\t\tUploadFileVO vo = new UploadFileVO();"], [389, ""], [390, "\t\tif(multipartFile == null){"], [391, "\t\t\tvo.setBaseVO(UploadFileVO.FAILURE, Language.show(\"oss_pleaseSelectUploadFile\"));"], [392, "\t\t\treturn vo;"], [393, "\t\t}"], [394, ""], [395, "\t\tInputStream inputStream = null;"], [396, "\t\ttry {"], [397, "\t\t\tinputStream = multipartFile.getInputStream();"], [398, "\t\t} catch (IOException e) {"], [399, "\t\t\te.printStackTrace();"], [400, "\t\t}"], [401, "\t\tif(inputStream == null){"], [402, "\t\t\tvo.setBaseVO(UploadFileVO.FAILURE, Language.show(\"oss_pleaseSelectUploadFile\"));"], [403, "\t\t\treturn vo;"], [404, "\t\t}"], [405, ""], [406, "\t\t//\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6\u7684\u540e\u7f00"], [407, "\t\tString fileSuffix = null;"], [408, "\t\tfileSuffix = Lang.findFileSuffix(multipartFile.getOriginalFilename());"], [409, ""], [410, "\t\tif(!allowUploadSuffix(fileSuffix)){"], [411, "\t\t\tvo.setBaseVO(UploadFileVO.FAILURE, Language.show(\"oss_uploadFileNotInSuffixList\"));"], [412, "\t\t\treturn vo;"], [413, "\t\t}"], [414, ""], [415, "\t\tvo = uploadFileByInputStream(filePath, inputStream, fileSuffix);"], [416, "\t\treturn vo;"], [417, "\t}"], [418, ""], [419, "\t/**"], [469, "\t * \u4e0a\u4f20\u6587\u4ef6"], [470, "\t * @param filePath \u4e0a\u4f20\u540e\u7684\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\u3001\u8def\u5f84\uff0c\u5982 \"jar/file/\""], [471, "\t * @param inputStream \u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u7684\u6570\u636e\u6d41"], [472, "\t * @param fileSuffix \u4e0a\u4f20\u7684\u6587\u4ef6\u7684\u540e\u7f00\u540d"], [473, "\t * @return {@link UploadFileVO}"], [474, "\t */"], [475, "\tpublic static UploadFileVO uploadFileByInputStream(String filePath, InputStream inputStream, String fileSuffix) {"], [476, "\t\tUploadFileVO vo = new UploadFileVO();"], [477, ""], [478, "\t\tif(!allowUploadSuffix(fileSuffix)){"], [479, "\t\t\tvo.setBaseVO(UploadFileVO.FAILURE, Language.show(\"oss_uploadFileNotInSuffixList\"));"], [480, "\t\t\treturn vo;"], [481, "\t\t}"], [482, ""], [483, "\t\tif(inputStream == null){"], [484, "\t\t\tvo.setBaseVO(UploadFileVO.FAILURE, Language.show(\"oss_pleaseSelectUploadFile\"));"], [485, "\t\t\treturn vo;"], [486, "\t\t}"], [487, ""], [488, "\t\treturn put(filePath, \".\"+fileSuffix, inputStream);"], [489, "\t}"], [490, ""], [491, "\t/**"], [501, ""], [626, "\t * SpringMVC \u4e0a\u4f20\u6587\u4ef6\uff0c\u914d\u7f6e\u5141\u8bb8\u4e0a\u4f20\u7684\u6587\u4ef6\u540e\u7f00\u518d systemConfig.xml \u7684AttachmentFile\u8282\u70b9"], [627, "\t * @param filePath \u4e0a\u4f20\u540e\u7684\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\u3001\u8def\u5f84\uff0c\u5982 \"jar/file/\""], [628, "\t * @param request SpringMVC\u63a5\u6536\u7684 {@link MultipartFile},\u82e5\u662f\u6709\u4e0a\u4f20\u6587\u4ef6\uff0c\u4f1a\u81ea\u52a8\u8f6c\u5316\u4e3a{@link MultipartFile}\u4fdd\u5b58"], [629, "\t * @param formFileName form\u8868\u5355\u4e0a\u4f20\u7684\u5355\u4e2a\u6587\u4ef6\uff0c\u8868\u5355\u91cc\u4e0a\u4f20\u6587\u4ef6\u7684\u6587\u4ef6\u540d"], [630, "\t * @return {@link UploadFileVO} \u82e5\u6210\u529f\uff0c\u5219\u4e0a\u4f20\u4e86\u6587\u4ef6\u5e76\u4e14\u4e0a\u4f20\u6210\u529f"], [631, "\t */"], [632, "\tpublic static UploadFileVO uploadFile(String filePath,HttpServletRequest request,String formFileName) {"], [633, "\t\tUploadFileVO uploadFileVO = new UploadFileVO();"], [634, "\t\tif (request instanceof MultipartHttpServletRequest) {"], [635, "\t\t\tMultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request;"], [636, "\t\t\tList<MultipartFile> list = multipartRequest.getFiles(formFileName);"], [637, "\t\t\tif(list.size()>0 && !list.get(0).isEmpty()){"], [638, "\t\t\t\tMultipartFile multi = list.get(0);"], [639, "\t\t\t\tuploadFileVO = uploadFileByMultipartFile(filePath, multi);"], [640, "\t\t\t}else{"], [641, "\t\t\t\tuploadFileVO.setResult(UploadFileVO.NOTFILE);"], [642, "\t\t\t\tuploadFileVO.setInfo(Language.show(\"oss_uploadNotFile\"));"], [643, "\t\t\t}"], [644, "\t    }else{"], [645, "\t    \tuploadFileVO.setResult(UploadFileVO.NOTFILE);"], [646, "\t\t\tuploadFileVO.setInfo(Language.show(\"oss_uploadNotFile\"));"], [647, "\t    }"], [648, "\t\treturn uploadFileVO;"], [649, "\t}"], [650, ""], [651, "\t/**"]], "deleted": [[383, "\t\t//\u5224\u65ad\u6587\u4ef6\u5927\u5c0f\u662f\u5426\u8d85\u51fa\u6700\u5927\u9650\u5236\u7684\u5927\u5c0f"], [384, "\t\tint lengthKB = (int) Math.ceil(multipartFile.getSize()/1024);"], [385, "\t\tvo = verifyFileMaxLength(lengthKB);"], [386, "\t\tif(vo.getResult() - UploadFileVO.FAILURE == 0){"], [387, "\t\t\treturn vo;"], [388, "\t\t}"], [389, ""], [434, ""]]}, "num_lines_added": 101, "num_lines_removed": 8}