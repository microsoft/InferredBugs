{"hash": "31bd7c219bc423e35a8b1838e0d0b180f2846254", "message": "add HmilySQLTuple to support modify multiple data row in one SQL (#211)", "file_num_lines": 51, "diff_parsed": {"added": [[22, "import org.dromara.hmily.repository.spi.entity.HmilySQLTuple;"], [33, "import java.util.Collection;"], [47, "        try (Connection connection = HmilyResourceManager.get(participantUndo.getResourceId()).getTargetDataSource().getConnection()) {"], [48, "            return doRevertInTransaction(connection, participantUndo.getUndoInvocation().getTuples());"], [49, "        } catch (final SQLException ex) {"], [50, "            log.error(\"hmily tac rollback exception -> \", ex);"], [51, "            return false;"], [52, "        }"], [53, "    }"], [54, ""], [55, "    private boolean doRevertInTransaction(final Connection connection, final Collection<HmilySQLTuple> tuples) throws SQLException {"], [56, "        connection.setAutoCommit(false);"], [57, "        for (HmilySQLTuple tuple : tuples) {"], [58, "            if (executeUpdate(connection, SQLImageMapperFactory.newInstance(tuple).cast()) == 0) {"], [59, "                connection.rollback();"], [60, "                return false;"], [61, "            }"], [62, "        }"], [63, "        connection.commit();"], [64, "        return true;"], [67, "    private int executeUpdate(final Connection connection, final RevertSQLUnit unit) {"], [68, "        try (PreparedStatement preparedStatement = connection.prepareStatement(unit.getSql())) {"], [75, "        } catch (SQLException ex) {"], [76, "            log.error(\"hmily tac rollback exception -> \", ex);"]], "deleted": [[29, "import javax.sql.DataSource;"], [46, "        RevertSQLUnit revertSQLUnit = SQLImageMapperFactory.newInstance(participantUndo.getUndoInvocation()).cast();"], [47, "        DataSource dataSource = HmilyResourceManager.get(participantUndo.getResourceId()).getTargetDataSource();"], [48, "        return executeUpdate(revertSQLUnit, dataSource) > 0;"], [51, "    private int executeUpdate(final RevertSQLUnit unit, final DataSource dataSource) {"], [52, "        try (Connection connection = dataSource.getConnection();"], [53, "             PreparedStatement preparedStatement = connection.prepareStatement(unit.getSql())) {"], [60, "        } catch (SQLException e) {"], [61, "            log.error(\"hmily tac rollback exception -> \", e);"]]}, "num_lines_added": 24, "num_lines_removed": 9}