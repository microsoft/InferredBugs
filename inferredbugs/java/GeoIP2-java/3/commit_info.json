{"hash": "7429a1e7972e4eb131faf5ba489f320b3c140006", "message": "added Exception Handling", "file_num_lines": 121, "diff_parsed": {"added": [[24, "      String uri = \"https://geoip.maxmind.com/geoip/country/\" + ip_address;"], [25, "      HttpGet httpget = new HttpGet(uri);"], [26, "      httpget.addHeader(\"Accept\",\"application/json\");"], [30, "      int status = response.getStatusLine().getStatusCode();"], [31, "      if (status == 200) {"], [32, "        return new Country(handle_success(response, uri));"], [33, "      } else {"], [34, "        handle_error_status(response, status, uri);"], [43, "  private String get_content(HttpResponse response) throws IOException {"], [44, "    HttpEntity entity = response.getEntity();"], [45, "    if (entity == null) {return \"\";}"], [46, "    InputStream instream = entity.getContent();"], [47, "    BufferedReader reader = new BufferedReader("], [48, "                 new InputStreamReader(instream));"], [49, "    String content = reader.readLine();"], [50, "    instream.close();"], [51, "    return content;"], [52, "  }"], [53, "  private JSONObject handle_success(HttpResponse response, String uri) throws IOException {"], [54, "    JSONObject json = null;"], [55, "    try {"], [56, "      String c = get_content(response);"], [57, "      json = new JSONObject(c);"], [58, "    } catch (JSONException e) {"], [59, "      throw new RuntimeException(\"Received a 200 response for \"+uri+\" but could not decode the response as JSON \",e);"], [60, "    }"], [61, "    return json;"], [62, "  }"], [63, "  private void handle_error_status(HttpResponse response, int status, String uri) throws IOException {"], [64, "    if ((status >= 400) && (status < 500)) {"], [65, "      handle_4xx_status(response,status,uri);"], [66, "    } else if ((status >= 500) && (status < 600)) {"], [67, "      handle_5xx_status(response,status,uri);"], [68, "    } else {"], [69, "      handle_non_200_status(response,status,uri);"], [70, "    }"], [71, "  }"], [72, "  private void handle_4xx_status(HttpResponse response, int status, String uri) throws IOException {"], [73, "    String content = get_content(response);"], [74, "    JSONObject body;"], [75, "    if (content.equals(\"\") == false) {"], [76, "      try {"], [77, "        body = new JSONObject(content);"], [78, "      } catch (JSONException e) {"], [79, "        throw new HTTPException("], [80, "           \"Received a \" + status + \" error for \" + uri + \" but it did not include the expected JSON body\","], [81, "           status,"], [82, "           uri"], [83, "        );"], [84, "      }"], [85, "    } else {"], [86, "       throw new HTTPException("], [87, "           \"Received a \" + status + \" error for \" + uri + \" with no body\","], [88, "           status,"], [89, "           uri"], [90, "       );"], [91, "    }"], [92, "    if (body.has(\"code\") & body.has(\"error\")) {"], [93, "      try {"], [94, "        String code = body.getString(\"code\");"], [95, "        String error = body.getString(\"error\");"], [96, "        throw new WebServiceException(error,code,status,uri);"], [97, "      } catch (JSONException e) {"], [98, "        e.printStackTrace();"], [99, "      }"], [100, "    } else {"], [101, "        throw new HTTPException("], [102, "           \"Response contains JSON but it does not specify code or error keys\","], [103, "           status,"], [104, "           uri"], [105, "        );"], [106, "    }"], [107, "  }"], [108, "  private void handle_5xx_status(HttpResponse response, int status, String uri) {"], [109, "    throw new HTTPException("], [110, "       \"Received a server error (\" + status + \") for \" + uri,"], [111, "       status,"], [112, "       uri"], [113, "    );"], [114, ""], [115, "  }"], [116, "  private void handle_non_200_status(HttpResponse response, int status, String uri) {"], [117, "    throw new HTTPException("], [118, "       \"Received a server error (\" + status + \") for \" + uri,"], [119, "       status,"], [120, "       uri"], [121, "    );"], [122, "  }"]], "deleted": [[24, "      HttpGet httpget = new HttpGet(\"https://geoip.maxmind.com/geoip/country/\" + ip_address);"], [25, "     httpget.addHeader(\"Accept\",\"application/json\");"], [29, "      HttpEntity entity = response.getEntity();"], [30, "      if (entity != null) {"], [31, "        InputStream instream = entity.getContent();"], [32, "        BufferedReader reader = new BufferedReader("], [33, "                 new InputStreamReader(instream));"], [34, "        return new Country(reader.readLine());"]]}, "num_lines_added": 88, "num_lines_removed": 8}