{"hash": "ad4c8b9f39d27db0999d4cad8b95150e997d528c", "message": "corrected connection manager test and connection manager impl. Now we invoke init from main thread and can check, that server correctly started and get port", "file_num_lines": 119, "diff_parsed": {"added": [[10, "import java.net.InetAddress;"], [11, "import java.net.ServerSocket;"], [12, "import java.net.Socket;"], [15, "import java.util.concurrent.Semaphore;"], [16, "import java.util.concurrent.TimeUnit;"], [73, "    myConnectionManager.initAndRunWorker();"], [77, "    int serverPort = myConnectionManager.getBindAddress().getPort();"], [79, "    Socket socket = new Socket(\"127.0.0.1\", serverPort);"], [134, "    this.myConnectionManager.close(true);"]], "deleted": [[10, "import java.net.*;"], [13, "import java.util.concurrent.*;"], [70, "    ExecutorService executorService = Executors.newSingleThreadExecutor();"], [71, "    Future<?> future = executorService.submit(myConnectionManager);"], [75, "    int serverPort = ConnectionManager.PORT_RANGE_START;"], [76, "    Socket socket = null;"], [77, "    while (serverPort < ConnectionManager.PORT_RANGE_END) {"], [78, "      try {"], [79, "        socket = new Socket(\"127.0.0.1\", serverPort);"], [80, "        if (socket.isConnected()) break;"], [81, "      } catch (ConnectException ignored) {}"], [82, "      serverPort++;"], [83, "    }"], [85, "    if (socket == null || !socket.isConnected()) {"], [86, "      fail(\"can not connect to server channel of connection manager\");"], [87, "    }"], [142, "    executorService.shutdownNow();"], [143, "    boolean executorShutdownCorrectly = executorService.awaitTermination(10, TimeUnit.SECONDS);"], [144, "    assertTrue(executorShutdownCorrectly);"], [145, "    executorService.shutdown();"], [146, "    executorService.awaitTermination(1, TimeUnit.MINUTES);"]]}, "num_lines_added": 9, "num_lines_removed": 21}