{"hash": "06441d365498e46cae3ec3251830c40b02b4c11f", "message": "Fixed problem with duplicate file opening", "file_num_lines": 147, "diff_parsed": {"added": [], "deleted": [[173, "      if (torrent != null && piece != null){"], [174, "        final File file;"], [175, "        if (torrent.getParentFile().isDirectory()) {"], [176, "          file = new File(torrent.getParentFile(), String.format(\"%d.txt\", piece.getIndex()));"], [177, "        } else {"], [178, "          file = new File(torrent.getParentFile().getCanonicalFile().getParentFile(), String.format(\"%s.%d.txt\", torrent.getName(), piece.getIndex()));"], [179, "        }"], [180, "        if (!valid) {"], [181, "          logger.debug(\"Piece {} invalid. Expected hash {} when actual is {}\", new Object[]{"], [182, "            piece.getIndex(), HexBin.encode(hash), HexBin.encode(calculatedHash)});"], [183, "          //saving data:"], [184, "          FileOutputStream fOut = new FileOutputStream(file);"], [185, "          fOut.write(data);"], [186, "          fOut.close();"], [187, "        } else {"], [188, "          if (file.exists()){"], [189, "            File correctFile;"], [190, "            if (torrent.getParentFile().isDirectory()) {"], [191, "              correctFile = new File(torrent.getParentFile(), String.format(\"%d.correct.txt\", piece.getIndex()));"], [192, "            } else {"], [193, "              correctFile = new File(torrent.getParentFile().getCanonicalFile().getParentFile(), String.format(\"%s.%d.correct.txt\", torrent.getName(), piece.getIndex()));"], [194, "            }"], [195, "            FileOutputStream fOut = new FileOutputStream(correctFile);"], [196, "            fOut.write(data);"], [197, "            fOut.close();"], [198, "          }"], [199, "        }"], [200, "      }"], [201, ""], [206, "/*"], [207, "    if (valid){"], [208, "      System.out.println(\"Valid\");"], [209, "    } else {"], [210, "      System.out.println(\"Invalid\");"], [211, "    }"], [212, "*/"], [213, "    logger.trace(\"Validation of {} {}\", this, this.isValid() ? \"succeeded\" : \"failed\");"]]}, "num_lines_added": 0, "num_lines_removed": 37}