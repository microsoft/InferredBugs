{"hash": "c04ba4e4a666c977817816d41f97e8a06b38d964", "message": "1)Added lock-style synchronization to FileStorage.\n2) Fixed timing in tests", "file_num_lines": 149, "diff_parsed": {"added": [[24, "import java.util.concurrent.locks.ReadWriteLock;"], [25, "import java.util.concurrent.locks.ReentrantReadWriteLock;"], [57, "  private final ReadWriteLock myLock = new ReentrantReadWriteLock();"], [58, ""], [68, "    try {"], [69, "      myLock.writeLock().lock();"], [87, ""], [88, "      this.raf = new RandomAccessFile(this.current, \"rw\");"], [103, "    } finally {"], [104, "      myLock.writeLock().unlock();"], [105, "    }"], [119, "      try {"], [120, "        myLock.readLock().lock();"], [133, "      } finally {"], [134, "        myLock.readLock().unlock();"], [135, "      }"], [136, "    }"], [140, "      try {"], [141, "        myLock.writeLock().lock();"], [149, "      } finally {"], [150, "        myLock.writeLock().unlock();"], [151, "      }"], [152, "    }"], [155, "\tpublic void close() throws IOException {"], [156, "      try {"], [157, "        myLock.writeLock().lock();"], [163, "      } finally {"], [164, "        myLock.writeLock().unlock();"], [165, "      }"], [166, "    }"], [171, "\tpublic void finish() throws IOException {"], [172, "      try {"], [173, "        myLock.writeLock().lock();"], [185, "        try {"], [186, "          FileUtils.deleteQuietly(this.target);"], [187, "          this.raf.close();"], [188, "          FileUtils.moveFile(this.current, this.target);"], [189, "        } catch (Exception ex) {"], [190, "          logger.error(\"An error occured while moving file to its final location\", ex);"], [191, "        }"], [205, "      } finally {"], [206, "        myLock.writeLock().unlock();"], [207, "      }"], [208, "    }"]], "deleted": [[81, "    this.raf = new RandomAccessFile(this.current, \"rw\");"], [121, "\t}"], [132, "\t}"], [135, "\tpublic synchronized void close() throws IOException {"], [141, "\t}"], [146, "\tpublic synchronized void finish() throws IOException {"], [158, "\t\tthis.raf.close();"], [159, "\t\tFileUtils.deleteQuietly(this.target);"], [160, "\t\tFileUtils.moveFile(this.current, this.target);"], [174, "\t}"]]}, "num_lines_added": 44, "num_lines_removed": 10}