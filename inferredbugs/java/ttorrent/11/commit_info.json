{"hash": "8a64cb8a94539efc5ce4f6700131e5d30880ae4d", "message": "More on the UDP announcer skeleton\n\nSigned-off-by: Maxime Petazzoni <mpetazzoni@turn.com>", "file_num_lines": 81, "diff_parsed": {"added": [[24, "import java.io.IOException;"], [25, ""], [26, "import java.net.DatagramPacket;"], [36, "import java.util.Date;"], [62, "\t/**"], [63, "\t * Back-off timeout uses 15 * 2 ^ n formula."], [64, "\t */"], [65, "\tprivate static final int UDP_BASE_TIMEOUT_SECONDS = 15;"], [66, ""], [67, "\t/**"], [68, "\t * We don't try more than 8 times (3840 seconds, as per the formula defined"], [69, "\t * for the backing-off timeout."], [70, "\t *"], [71, "\t * @see #UDP_BASE_TIMEOUT_SECONDS"], [72, "\t */"], [73, "\tprivate static final int UDP_MAX_TRIES = 8;"], [74, ""], [75, "\tprivate final InetSocketAddress address;"], [79, "\tprivate Date lastConnectionTime;"], [80, "\tprivate long connectionId;"], [81, ""], [82, "\tprivate enum State {"], [83, "\t\tCONNECT_REQUEST,"], [84, "\t\tANNOUNCE_REQUEST;"], [85, "\t};"], [86, ""], [105, "\t\tthis.address = new InetSocketAddress("], [107, "\t\t\tannounceURL.getPort());"], [108, ""], [109, "\t\tthis.socket = new DatagramSocket();"], [110, "\t\tthis.socket.connect(this.address);"], [111, ""], [113, "\t\tthis.lastConnectionTime = null;"], [128, "\t\t\tState state = State.CONNECT_REQUEST;"], [129, "\t\t\tint tries = 0;"], [130, ""], [131, "\t\t\twhile (tries <= UDP_MAX_TRIES) {"], [132, "\t\t\t\tif (this.lastConnectionTime != null &&"], [133, "\t\t\t\t\tnew Date().before(this.lastConnectionTime)) {"], [134, "\t\t\t\t\tstate = State.ANNOUNCE_REQUEST;"], [135, "\t\t\t\t}"], [136, ""], [137, "\t\t\t\ttries++;"], [138, "\t\t\t}"], [139, ""], [140, ""], [141, ""], [151, ""], [152, "\tprivate void send(TrackerMessage message)"], [153, "\t\tthrows IOException, SocketException {"], [154, "\t\tbyte[] data = message.getData().array();"], [155, "\t\tthis.socket.send(new DatagramPacket(data, data.length, this.address));"], [156, "\t}"], [157, ""]], "deleted": [[35, ""], [80, "\t\tthis.socket = new DatagramSocket();"], [81, "\t\tthis.socket.connect(new InetSocketAddress("], [83, "\t\t\tannounceURL.getPort()));"]]}, "num_lines_added": 54, "num_lines_removed": 4}