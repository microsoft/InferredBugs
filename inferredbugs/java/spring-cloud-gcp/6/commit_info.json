{"hash": "e6def0732952e937dd0480db4c110bd9c666117a", "message": "Firestore - automatic id generation (#2466)\n\nFirestore - automatic id generation; fixes #2428", "file_num_lines": 296, "diff_parsed": {"added": [[28, "import com.google.firestore.v1.Precondition;"], [33, "import com.google.firestore.v1.Write.Builder;"], [405, "\t\tBuilder builder = Write.newBuilder();"], [406, "\t\tif (getIdValue(entity) == null) {"], [407, "\t\t\tbuilder.setCurrentDocument(Precondition.newBuilder().setExists(false).build());"], [408, "\t\t}"], [409, "\t\tString resourceName = buildResourceName(entity);"], [410, "\t\tDocument document = getClassMapper().entityToDocument(entity, resourceName);"], [411, "\t\treturn builder.setUpdate(document).build();"], [419, "\t\tif (idVal == null) {"], [420, "\t\t\tif (idProperty.getType() != String.class) {"], [421, "\t\t\t\tthrow new FirestoreDataException("], [422, "\t\t\t\t\t\t\t\t\"ID property was null; automatic ID generation is only supported for String type\");"], [423, "\t\t\t}"], [425, "\t\t\t//TODO: replace with com.google.cloud.firestore.Internal.autoId() when it is available"], [426, "\t\t\tidVal = AutoId.autoId();"], [427, "\t\t\tpersistentEntity.getPropertyAccessor(entity).setProperty(idProperty, idVal);"], [428, "\t\t}"], [436, "\tprivate Object getIdValue(Object entity) {"], [437, "\t\tFirestorePersistentEntity<?> persistentEntity ="], [438, "\t\t\t\t\t\tthis.mappingContext.getPersistentEntity(entity.getClass());"], [441, "\t\treturn persistentEntity.getPropertyAccessor(entity).getProperty(idProperty);"]], "deleted": [[403, "\t\tString documentResourceName = buildResourceName(entity);"], [404, "\t\tDocument document = getClassMapper().entityToDocument(entity, documentResourceName);"], [405, "\t\treturn Write.newBuilder()"], [406, "\t\t\t\t.setUpdate(document)"], [407, "\t\t\t\t.build();"], [423, "\tprivate String getIdValue(Object entity, FirestorePersistentEntity persistentEntity) {"], [425, "\t\tObject idVal = persistentEntity.getPropertyAccessor(entity).getProperty(idProperty);"], [427, "\t\treturn idVal.toString();"]]}, "num_lines_added": 22, "num_lines_removed": 8}