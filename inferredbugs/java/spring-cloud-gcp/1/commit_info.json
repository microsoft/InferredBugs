{"hash": "4a3ed0718d260856d0511757e59ec7ec21875961", "message": "Remove guava from spanner module (#1374)\n\n* ImmutableMap replaced by MapBuilder where order did not matter or LinkedHashMap where order mattered.\r\n*  Stopwatch removed in favor of directly using System.currentTimeMillis().\r\n* ImmutableSet replaced by new HashSet with a constructed list parameter.\r\n* ImmutableList replaced with Arrays.asList()\r\n* @VisibleForTesting removed outright.\r\n\r\nPart of #1198 .", "file_num_lines": 257, "diff_parsed": {"added": [[2, " * Copyright 2017-2019 the original author or authors."], [20, "import java.util.Collections;"], [21, "import java.util.HashSet;"], [22, "import java.util.LinkedHashMap;"], [47, " * The primary class for adding values from entity objects to {@link WriteBuilder} for the"], [48, " * purpose of creating mutations for Spanner."], [56, ""], [57, "\tprivate static final Set<Class> SPANNER_KEY_COMPATIBLE_TYPES = Collections.unmodifiableSet("], [58, "\t\t\tnew HashSet<Class>("], [59, "\t\t\t\t\tArrays.asList("], [60, "\t\t\t\t\t\t\tBoolean.class, Integer.class, Long.class, Float.class, Double.class, String.class,"], [61, "\t\t\t\t\t\t\tByteArray.class, Timestamp.class, com.google.cloud.Date.class)));"], [73, "\t\tMap<Class<?>, BiConsumer<ValueBinder<?>, Iterable>> map = new LinkedHashMap<>();"], [74, "\t\tmap.put(com.google.cloud.Date.class, ValueBinder::toDateArray);"], [75, "\t\tmap.put(Boolean.class, ValueBinder::toBoolArray);"], [76, "\t\tmap.put(Long.class, ValueBinder::toInt64Array);"], [77, "\t\tmap.put(String.class, ValueBinder::toStringArray);"], [78, "\t\tmap.put(Double.class, ValueBinder::toFloat64Array);"], [79, "\t\tmap.put(Timestamp.class, ValueBinder::toTimestampArray);"], [80, "\t\tmap.put(ByteArray.class, ValueBinder::toBytesArray);"], [81, ""], [82, "\t\treturn Collections.unmodifiableMap(map);"], [86, "\t\tMap<Class<?>, BiFunction<ValueBinder, ?, ?>> map = new LinkedHashMap<>();"], [87, ""], [88, "\t\tmap.put(Date.class, (BiFunction<ValueBinder, Date, ?>) ValueBinder::to);"], [89, "\t\tmap.put(Boolean.class, (BiFunction<ValueBinder, Boolean, ?>) ValueBinder::to);"], [90, "\t\tmap.put(Long.class, (BiFunction<ValueBinder, Long, ?>) ValueBinder::to);"], [91, "\t\tmap.put(long.class, (BiFunction<ValueBinder, Long, ?>) ValueBinder::to);"], [92, "\t\tmap.put(Double.class, (BiFunction<ValueBinder, Double, ?>) ValueBinder::to);"], [93, "\t\tmap.put(double.class, (BiFunction<ValueBinder, Double, ?>) ValueBinder::to);"], [94, "\t\tmap.put(String.class, (BiFunction<ValueBinder, String, ?>) ValueBinder::to);"], [95, "\t\tmap.put(Timestamp.class,"], [97, "\t\tmap.put(ByteArray.class,"], [99, "\t\tmap.put(double[].class,"], [101, "\t\tmap.put(boolean[].class,"], [103, "\t\tmap.put(long[].class,"], [105, "\t\tmap.put(Struct.class, (BiFunction<ValueBinder, Struct, ?>) ValueBinder::to);"], [107, "\t\tsingleItemTypeValueBinderMethodMap = Collections.unmodifiableMap(map);"], [159, "\t\t\t\t\t\t\t.contains(spannerPersistentProperty.getColumnName())) {"], [371, "\t\tBiFunction<ValueBinder, T, ?> toMethod = (BiFunction<ValueBinder, T, ?>) singleItemTypeValueBinderMethodMap"], [372, "\t\t\t\t.get(innerType);"]], "deleted": [[2, " * Copyright 2017-2018 the original author or authors."], [35, "import com.google.common.collect.ImmutableMap;"], [36, "import com.google.common.collect.ImmutableSet;"], [46, " * The primary class for adding values from entity objects to {@link WriteBuilder} for"], [47, " * the purpose of creating mutations for Spanner."], [55, "\tprivate static final Set<Class> SPANNER_KEY_COMPATIBLE_TYPES = ImmutableSet"], [56, "\t\t\t.<Class>builder()"], [57, "\t\t\t.add(Boolean.class)"], [58, "\t\t\t.add(Integer.class)"], [59, "\t\t\t.add(Long.class)"], [60, "\t\t\t.add(Float.class)"], [61, "\t\t\t.add(Double.class)"], [62, "\t\t\t.add(String.class)"], [63, "\t\t\t.add(ByteArray.class)"], [64, "\t\t\t.add(Timestamp.class)"], [65, "\t\t\t.add(com.google.cloud.Date.class)"], [66, "\t\t\t.build();"], [78, "\t\t// Java 8 has compile errors when using the builder extension methods"], [79, "\t\t// @formatter:off"], [80, "\t\tImmutableMap.Builder<Class<?>, BiConsumer<ValueBinder<?>, Iterable>> builder ="], [81, "\t\t\t\t\t\tnew ImmutableMap.Builder<>();"], [82, "\t\t// @formatter:on"], [83, ""], [84, "\t\tbuilder.put(com.google.cloud.Date.class, ValueBinder::toDateArray);"], [85, "\t\tbuilder.put(Boolean.class, ValueBinder::toBoolArray);"], [86, "\t\tbuilder.put(Long.class, ValueBinder::toInt64Array);"], [87, "\t\tbuilder.put(String.class, ValueBinder::toStringArray);"], [88, "\t\tbuilder.put(Double.class, ValueBinder::toFloat64Array);"], [89, "\t\tbuilder.put(Timestamp.class, ValueBinder::toTimestampArray);"], [90, "\t\tbuilder.put(ByteArray.class, ValueBinder::toBytesArray);"], [91, ""], [92, "\t\treturn builder.build();"], [96, "\t\tImmutableMap.Builder<Class<?>, BiFunction<ValueBinder, ?, ?>> builder = new ImmutableMap.Builder<>();"], [97, ""], [98, "\t\tbuilder.put(Date.class, (BiFunction<ValueBinder, Date, ?>) ValueBinder::to);"], [99, "\t\tbuilder.put(Boolean.class, (BiFunction<ValueBinder, Boolean, ?>) ValueBinder::to);"], [100, "\t\tbuilder.put(Long.class, (BiFunction<ValueBinder, Long, ?>) ValueBinder::to);"], [101, "\t\tbuilder.put(long.class, (BiFunction<ValueBinder, Long, ?>) ValueBinder::to);"], [102, "\t\tbuilder.put(Double.class, (BiFunction<ValueBinder, Double, ?>) ValueBinder::to);"], [103, "\t\tbuilder.put(double.class, (BiFunction<ValueBinder, Double, ?>) ValueBinder::to);"], [104, "\t\tbuilder.put(String.class, (BiFunction<ValueBinder, String, ?>) ValueBinder::to);"], [105, "\t\tbuilder.put(Timestamp.class,"], [107, "\t\tbuilder.put(ByteArray.class,"], [109, "\t\tbuilder.put(double[].class,"], [111, "\t\tbuilder.put(boolean[].class,"], [113, "\t\tbuilder.put(long[].class,"], [115, "\t\tbuilder.put(Struct.class, (BiFunction<ValueBinder, Struct, ?>) ValueBinder::to);"], [117, "\t\tsingleItemTypeValueBinderMethodMap = builder.build();"], [169, "\t\t\t\t\t\t\t\t.contains(spannerPersistentProperty.getColumnName())) {"], [381, "\t\tBiFunction<ValueBinder, T, ?> toMethod = (BiFunction<ValueBinder, T, ?>)"], [382, "\t\tsingleItemTypeValueBinderMethodMap.get(innerType);"]]}, "num_lines_added": 41, "num_lines_removed": 51}