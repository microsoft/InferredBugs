{"hash": "c0150b1018d443b18da05536456c113e3e0c691e", "message": "bugfix: TableMetaCache refresh problem in multiple datasource (#1481)", "file_num_lines": 236, "diff_parsed": {"added": [[70, "        final String key = getCacheKey(dataSourceProxy, tableName);"], [101, "            String key = getCacheKey(dataSourceProxy, entry.getValue().getTableName());"], [102, "            if(entry.getKey().equals(key)){"], [103, "                try {"], [104, "                    TableMeta tableMeta = fetchSchema(dataSourceProxy, entry.getValue().getTableName());"], [105, "                    if (!tableMeta.equals(entry.getValue())){"], [106, "                        TABLE_META_CACHE.put(entry.getKey(), tableMeta);"], [107, "                        LOGGER.info(\"table meta change was found, update table meta cache automatically.\");"], [108, "                    }"], [109, "                } catch (SQLException e) {"], [110, "                    LOGGER.error(\"get table meta error:{}\", e.getMessage(), e);"], [128, "            StringBuilder builder = new StringBuilder(\"SELECT * FROM \");"], [129, "            builder.append(tableName);"], [130, "            builder.append(\" LIMIT 1\");"], [131, "            rs = stmt.executeQuery(builder.toString());"], [296, ""], [297, "    /**"], [298, "     * generate cache key"], [299, "     * @param dataSourceProxy"], [300, "     * @param tableName"], [301, "     * @return"], [302, "     */"], [303, "    private static String getCacheKey(DataSourceProxy dataSourceProxy, String tableName){"], [304, "        return dataSourceProxy.getResourceId() + \".\" + tableName;"], [305, "    }"]], "deleted": [[69, "        String dataSourceKey = dataSourceProxy.getResourceId();"], [70, ""], [72, "        final String key = dataSourceKey + \".\" + tableName;"], [103, "            try {"], [104, "                TableMeta tableMeta = fetchSchema(dataSourceProxy, entry.getValue().getTableName());"], [105, "                if (tableMeta == null){"], [106, "                    LOGGER.error(\"get table meta error\");"], [107, "                }"], [108, "                if (!tableMeta.equals(entry.getValue())){"], [109, "                    TABLE_META_CACHE.put(entry.getKey(), tableMeta);"], [110, "                    LOGGER.info(\"table meta change was found, update table meta cache automatically.\");"], [112, "            } catch (SQLException e) {"], [113, "                LOGGER.error(\"get table meta error:{}\", e.getMessage(), e);"], [130, "            StringBuffer sb = new StringBuffer(\"SELECT * FROM \" + tableName + \" LIMIT 1\");"], [131, "            rs = stmt.executeQuery(sb.toString());"]]}, "num_lines_added": 25, "num_lines_removed": 15}