{"hash": "054b4be8f24d75fbf4bc267294cb71306b91c0a4", "message": "update consensus", "file_num_lines": 619, "diff_parsed": {"added": [[73, "    private static final PackingRoundManager VALIDATE_INSTANCE = new PackingRoundManager();"], [74, "    private static final PackingRoundManager PACK_INSTANCE = new PackingRoundManager();"], [91, "    public static PackingRoundManager getValidateInstance() {"], [92, "        return VALIDATE_INSTANCE;"], [93, "    }"], [94, ""], [95, "    public static PackingRoundManager getPackInstance() {"], [96, "        return PACK_INSTANCE;"], [262, "        long indexOfRound = 1 + (header.getTime() - thisBlockRoundData.getRoundStartTime()) / (1000 * PocConsensusConstant.BLOCK_TIME_INTERVAL_SECOND);"], [385, "    public synchronized void calc(Block bestBlock) {"], [388, "        if (null != currentRound && currentRound.getIndex() == bestRoundData.getRoundIndex() && bestRoundData.getPackingIndexOfRound() == bestRoundData.getConsensusMemberCount()) {"], [389, "            PocMeetingRound previousRound = currentRound;"], [391, "            if (previousRound.getIndex() != (currentRound.getIndex() - 1)) {"], [392, "                previousRound = calcCurrentRound(bestBlock.getHeader(), bestHeight, bestRoundData);"], [393, "                this.currentRound.setPreRound(previousRound);"], [394, "            }"], [396, "            if (  TimeService.currentTimeMillis() > currentRound.getEndTime()) {"], [397, "                PocMeetingRound previousRound = currentRound;"], [398, "                this.currentRound = calcNextRound(bestBlock.getHeader(), bestHeight, bestRoundData);"], [399, "                if (previousRound.getIndex() != (currentRound.getIndex() - 1)) {"], [400, "                    previousRound = calcCurrentRound(bestBlock.getHeader(), bestHeight, bestRoundData);"], [401, "                    this.currentRound.setPreRound(previousRound);"], [402, "                }"], [403, "            }else{"], [404, "                return;"], [405, "            }"], [413, "            PocMeetingRound previousRound = calcCurrentRound(bestBlock.getHeader(), bestHeight, bestRoundData);"], [415, "            this.currentRound.setPreRound(previousRound);"], [417, "            PocMeetingRound previousRound = calcPreviousRound(bestBlock.getHeader(), bestHeight, bestRoundData);"], [419, "            this.currentRound.setPreRound(previousRound);"], [704, "        if (null == currentRound ) {"], [710, "        if (roundIndex == currentRound.getPreRound().getIndex()) {"], [711, "            return currentRound.getPreRound();"]], "deleted": [[73, "    private static final PackingRoundManager INSTANCE = new PackingRoundManager();"], [90, "    public static PackingRoundManager getInstance() {"], [91, "        return INSTANCE;"], [95, "    private PocMeetingRound previousRound;"], [258, "        long indexOfRound = 1+ (header.getTime() - thisBlockRoundData.getRoundStartTime()) / (1000 * PocConsensusConstant.BLOCK_TIME_INTERVAL_SECOND);"], [372, "        this.previousRound = null;"], [382, "    public void calc(Block bestBlock) {"], [385, "        if (null != currentRound && TimeService.currentTimeMillis() > currentRound.getEndTime()) {"], [386, "            this.previousRound = currentRound;"], [387, "            this.currentRound = calcNextRound(bestBlock.getHeader(), bestHeight, bestRoundData);"], [388, "        } else if (null != currentRound && currentRound.getIndex() == bestRoundData.getRoundIndex() && bestRoundData.getPackingIndexOfRound() == bestRoundData.getConsensusMemberCount()) {"], [389, "            this.previousRound = currentRound;"], [392, "            //nothing to do"], [393, "            return;"], [401, "            this.previousRound = calcCurrentRound(bestBlock.getHeader(), bestHeight, bestRoundData);"], [404, "            this.previousRound = calcPreviousRound(bestBlock.getHeader(), bestHeight, bestRoundData);"], [676, "    public PocMeetingRound getPreviousRound() {"], [677, "        return previousRound;"], [678, "    }"], [679, ""], [694, "        if (null == currentRound || previousRound == null) {"], [700, "        if (roundIndex == previousRound.getIndex()) {"], [701, "            return previousRound;"]]}, "num_lines_added": 33, "num_lines_removed": 23}