{"hash": "cf33bd51d6cf4a8cec47e9fbf8b0298ee8a7ed3d", "message": "Improving tracing spans (#1534)\n\n* Improving tracing spans\r\n- Using Closable where possible\r\n- BulkMutations now report number of mutations\r\n- Scans now report the number of rows per response and processing time.\r\n\r\n* Using Closesable instead of NonThrowingClosable.\r\n\r\n* - Added comments about spans and annotations.\r\n- Noted that RowMerger is not thread safe\r\n- Added a total rows returned per scan", "file_num_lines": 210, "diff_parsed": {"added": [[31, "import com.google.common.collect.ImmutableMap;"], [41, "import io.opencensus.trace.AttributeValue;"], [120, "  private int totalRowsProcessed = 0;"], [175, "    operationSpan.addAnnotation(\"Got a response\");"], [179, "    // Add an annotation for the number of rows that were returned in the previous response."], [180, "    int rowCountInLastMessage = rowMerger.getRowCountInLastMessage();"], [181, "    operationSpan.addAnnotation(\"Processed Response\", ImmutableMap.of(\"rowCount\","], [182, "      AttributeValue.longAttributeValue(rowCountInLastMessage)));"], [183, ""], [184, "    totalRowsProcessed += rowCountInLastMessage;"], [185, ""], [205, "  @Override"], [206, "  protected void finalizeStats(Status status) {"], [207, "    super.finalizeStats(status);"], [208, "    // Add an annotation for the total number of rows that were returned across all responses."], [209, "    operationSpan.addAnnotation(\"Total Rows Processed\","], [210, "      ImmutableMap.of(\"rowCount\", AttributeValue.longAttributeValue(totalRowsProcessed)));"], [211, "  }"], [212, ""], [302, "      performRetry(0);"]], "deleted": [[282, "      rpc.getRpcMetrics().markRetry();"], [284, "      run();"]]}, "num_lines_added": 20, "num_lines_removed": 2}