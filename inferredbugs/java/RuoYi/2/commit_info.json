{"hash": "84068a2e2e9793c52ca747dcbd681b13134f4208", "message": "\u5347\u7ea7poi\u5230\u6700\u65b0\u72483.17", "file_num_lines": 352, "diff_parsed": {"added": [[16, ""], [25, "import org.apache.poi.hssf.util.HSSFColor.HSSFColorPredefined;"], [27, "import org.apache.poi.ss.usermodel.CellType;"], [28, "import org.apache.poi.ss.usermodel.FillPatternType;"], [29, "import org.apache.poi.ss.usermodel.HorizontalAlignment;"], [32, "import org.apache.poi.ss.usermodel.VerticalAlignment;"], [39, ""], [106, "            // \u9ed8\u8ba4\u5e8f\u53f7"], [107, "            int serialNum = 0;"], [120, "                    fieldsMap.put(++serialNum, field);"], [127, "                int cellNum = serialNum;"], [139, "                        row.getCell(j).setCellType(CellType.STRING);"], [188, "                        if (cell.getCellTypeEnum() == CellType.NUMERIC)"], [221, "        OutputStream out = null;"], [222, "        HSSFWorkbook workbook = null;"], [224, "        try"], [226, "            // \u5f97\u5230\u6240\u6709\u5b9a\u4e49\u5b57\u6bb5"], [227, "            Field[] allFields = clazz.getDeclaredFields();"], [228, "            List<Field> fields = new ArrayList<Field>();"], [229, "            // \u5f97\u5230\u6240\u6709field\u5e76\u5b58\u653e\u5230\u4e00\u4e2alist\u4e2d."], [230, "            for (Field field : allFields)"], [232, "                if (field.isAnnotationPresent(Excel.class))"], [233, "                {"], [234, "                    fields.add(field);"], [235, "                }"], [238, "            // \u4ea7\u751f\u5de5\u4f5c\u8584\u5bf9\u8c61"], [239, "            workbook = new HSSFWorkbook();"], [240, "            // excel2003\u4e2d\u6bcf\u4e2asheet\u4e2d\u6700\u591a\u670965536\u884c"], [241, "            int sheetSize = 65536;"], [242, "            // \u53d6\u51fa\u4e00\u5171\u6709\u591a\u5c11\u4e2asheet."], [243, "            double sheetNo = Math.ceil(list.size() / sheetSize);"], [244, "            for (int index = 0; index <= sheetNo; index++)"], [246, "                // \u4ea7\u751f\u5de5\u4f5c\u8868\u5bf9\u8c61"], [247, "                HSSFSheet sheet = workbook.createSheet();"], [248, "                if (sheetNo == 0)"], [250, "                    workbook.setSheetName(index, sheetName);"], [254, "                    // \u8bbe\u7f6e\u5de5\u4f5c\u8868\u7684\u540d\u79f0."], [255, "                    workbook.setSheetName(index, sheetName + index);"], [257, "                HSSFRow row;"], [258, "                HSSFCell cell; // \u4ea7\u751f\u5355\u5143\u683c"], [260, "                // \u4ea7\u751f\u4e00\u884c"], [261, "                row = sheet.createRow(0);"], [262, "                // \u5199\u5165\u5404\u4e2a\u5b57\u6bb5\u7684\u5217\u5934\u540d\u79f0"], [263, "                for (int i = 0; i < fields.size(); i++)"], [265, "                    Field field = fields.get(i);"], [266, "                    Excel attr = field.getAnnotation(Excel.class);"], [267, "                    // \u521b\u5efa\u5217"], [268, "                    cell = row.createCell(i);"], [269, "                    // \u8bbe\u7f6e\u5217\u4e2d\u5199\u5165\u5185\u5bb9\u4e3aString\u7c7b\u578b"], [270, "                    cell.setCellType(CellType.STRING);"], [271, "                    HSSFCellStyle cellStyle = workbook.createCellStyle();"], [272, "                    cellStyle.setAlignment(HorizontalAlignment.CENTER);"], [273, "                    cellStyle.setVerticalAlignment(VerticalAlignment.CENTER);"], [274, "                    if (attr.name().indexOf(\"\u6ce8\uff1a\") >= 0)"], [275, "                    {"], [276, "                        HSSFFont font = workbook.createFont();"], [277, "                        font.setColor(HSSFFont.COLOR_RED);"], [278, "                        cellStyle.setFont(font);"], [279, "                        cellStyle.setFillForegroundColor(HSSFColorPredefined.YELLOW.getIndex());"], [280, "                        sheet.setColumnWidth(i, 6000);"], [281, "                    }"], [282, "                    else"], [283, "                    {"], [284, "                        HSSFFont font = workbook.createFont();"], [285, "                        // \u7c97\u4f53\u663e\u793a"], [286, "                        font.setBold(true);"], [287, "                        // \u9009\u62e9\u9700\u8981\u7528\u5230\u7684\u5b57\u4f53\u683c\u5f0f"], [288, "                        cellStyle.setFont(font);"], [289, "                        cellStyle.setFillForegroundColor(HSSFColorPredefined.LIGHT_YELLOW.getIndex());"], [290, "                        // \u8bbe\u7f6e\u5217\u5bbd"], [291, "                        sheet.setColumnWidth(i, 3766);"], [292, "                    }"], [293, "                    cellStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);"], [294, "                    cellStyle.setWrapText(true);"], [295, "                    cell.setCellStyle(cellStyle);"], [296, ""], [297, "                    // \u5199\u5165\u5217\u540d"], [298, "                    cell.setCellValue(attr.name());"], [299, ""], [300, "                    // \u5982\u679c\u8bbe\u7f6e\u4e86\u63d0\u793a\u4fe1\u606f\u5219\u9f20\u6807\u653e\u4e0a\u53bb\u63d0\u793a."], [301, "                    if (StringUtils.isNotEmpty(attr.prompt()))"], [302, "                    {"], [303, "                        // \u8fd9\u91cc\u9ed8\u8ba4\u8bbe\u4e862-101\u5217\u63d0\u793a."], [304, "                        setHSSFPrompt(sheet, \"\", attr.prompt(), 1, 100, i, i);"], [305, "                    }"], [306, "                    // \u5982\u679c\u8bbe\u7f6e\u4e86combo\u5c5e\u6027\u5219\u672c\u5217\u53ea\u80fd\u9009\u62e9\u4e0d\u80fd\u8f93\u5165"], [307, "                    if (attr.combo().length > 0)"], [308, "                    {"], [309, "                        // \u8fd9\u91cc\u9ed8\u8ba4\u8bbe\u4e862-101\u5217\u53ea\u80fd\u9009\u62e9\u4e0d\u80fd\u8f93\u5165."], [310, "                        setHSSFValidation(sheet, attr.combo(), 1, 100, i, i);"], [311, "                    }"], [314, "                int startNo = index * sheetSize;"], [315, "                int endNo = Math.min(startNo + sheetSize, list.size());"], [316, "                // \u5199\u5165\u5404\u6761\u8bb0\u5f55,\u6bcf\u6761\u8bb0\u5f55\u5bf9\u5e94excel\u8868\u4e2d\u7684\u4e00\u884c"], [317, "                HSSFCellStyle cs = workbook.createCellStyle();"], [318, "                cs.setAlignment(HorizontalAlignment.CENTER);"], [319, "                cs.setVerticalAlignment(VerticalAlignment.CENTER);"], [320, "                for (int i = startNo; i < endNo; i++)"], [322, "                    row = sheet.createRow(i + 1 - startNo);"], [323, "                    // \u5f97\u5230\u5bfc\u51fa\u5bf9\u8c61."], [324, "                    T vo = (T) list.get(i);"], [325, "                    for (int j = 0; j < fields.size(); j++)"], [327, "                        // \u83b7\u5f97field."], [328, "                        Field field = fields.get(j);"], [329, "                        // \u8bbe\u7f6e\u5b9e\u4f53\u7c7b\u79c1\u6709\u5c5e\u6027\u53ef\u8bbf\u95ee"], [330, "                        field.setAccessible(true);"], [331, "                        Excel attr = field.getAnnotation(Excel.class);"], [332, "                        try"], [334, "                            // \u6839\u636eExcel\u4e2d\u8bbe\u7f6e\u60c5\u51b5\u51b3\u5b9a\u662f\u5426\u5bfc\u51fa,\u6709\u4e9b\u60c5\u51b5\u9700\u8981\u4fdd\u6301\u4e3a\u7a7a,\u5e0c\u671b\u7528\u6237\u586b\u5199\u8fd9\u4e00\u5217."], [335, "                            if (attr.isExport())"], [337, "                                // \u521b\u5efacell"], [338, "                                cell = row.createCell(j);"], [339, "                                cell.setCellStyle(cs);"], [340, "                                try"], [342, "                                    if (String.valueOf(field.get(vo)).length() > 10)"], [343, "                                    {"], [344, "                                        throw new Exception(\"\u957f\u5ea6\u8d85\u8fc710\u4f4d\u5c31\u4e0d\u7528\u8f6c\u6570\u5b57\u4e86\");"], [345, "                                    }"], [346, "                                    // \u5982\u679c\u53ef\u4ee5\u8f6c\u6210\u6570\u5b57\u5219\u5bfc\u51fa\u4e3a\u6570\u5b57\u7c7b\u578b"], [347, "                                    BigDecimal bc = new BigDecimal(String.valueOf(field.get(vo)));"], [348, "                                    cell.setCellType(CellType.NUMERIC);"], [349, "                                    cell.setCellValue(bc.doubleValue());"], [351, "                                catch (Exception e)"], [353, "                                    cell.setCellType(CellType.STRING);"], [354, "                                    if (vo == null)"], [355, "                                    {"], [356, "                                        // \u5982\u679c\u6570\u636e\u5b58\u5728\u5c31\u586b\u5165,\u4e0d\u5b58\u5728\u586b\u5165\u7a7a\u683c."], [357, "                                        cell.setCellValue(\"\");"], [358, "                                    }"], [359, "                                    else"], [360, "                                    {"], [361, "                                        // \u5982\u679c\u6570\u636e\u5b58\u5728\u5c31\u586b\u5165,\u4e0d\u5b58\u5728\u586b\u5165\u7a7a\u683c."], [362, "                                        cell.setCellValue(field.get(vo) == null ? \"\" : String.valueOf(field.get(vo)));"], [363, "                                    }"], [365, "                                }"], [368, "                        catch (Exception e)"], [369, "                        {"], [370, "                            log.error(\"\u5bfc\u51faExcel\u5931\u8d25{}\", e.getMessage());"], [371, "                        }"], [376, "            out = new FileOutputStream(getfile() + filename);"], [382, "            log.error(\"\u5bfc\u51faExcel\u5f02\u5e38{}\", e.getMessage());"], [385, "        finally"], [386, "        {"], [387, "            if (workbook != null)"], [388, "            {"], [389, "                try"], [390, "                {"], [391, "                    workbook.close();"], [392, "                }"], [393, "                catch (IOException e1)"], [394, "                {"], [395, "                    e1.printStackTrace();"], [396, "                }"], [397, "            }"], [398, "            if (out != null)"], [399, "            {"], [400, "                try"], [401, "                {"], [402, "                    out.close();"], [403, "                }"], [404, "                catch (IOException e1)"], [405, "                {"], [406, "                    e1.printStackTrace();"], [407, "                }"], [408, "            }"], [409, "        }"]], "deleted": [[24, "import org.apache.poi.hssf.util.HSSFColor;"], [26, "import org.apache.poi.ss.usermodel.CellStyle;"], [113, "                    fieldsMap.put(col, field);"], [120, "                int cellNum = sheet.getRow(0).getPhysicalNumberOfCells();"], [132, "                        row.getCell(j).setCellType(Cell.CELL_TYPE_STRING);"], [181, "                        if (cell.getCellType() == Cell.CELL_TYPE_NUMERIC)"], [214, "        // \u5f97\u5230\u6240\u6709\u5b9a\u4e49\u5b57\u6bb5"], [215, "        Field[] allFields = clazz.getDeclaredFields();"], [216, "        List<Field> fields = new ArrayList<Field>();"], [217, "        // \u5f97\u5230\u6240\u6709field\u5e76\u5b58\u653e\u5230\u4e00\u4e2alist\u4e2d."], [218, "        for (Field field : allFields)"], [219, "        {"], [220, "            if (field.isAnnotationPresent(Excel.class))"], [221, "            {"], [222, "                fields.add(field);"], [223, "            }"], [224, "        }"], [226, "        // \u4ea7\u751f\u5de5\u4f5c\u8584\u5bf9\u8c61"], [227, "        HSSFWorkbook workbook = new HSSFWorkbook();"], [228, "        // excel2003\u4e2d\u6bcf\u4e2asheet\u4e2d\u6700\u591a\u670965536\u884c"], [229, "        int sheetSize = 65536;"], [230, "        // \u53d6\u51fa\u4e00\u5171\u6709\u591a\u5c11\u4e2asheet."], [231, "        double sheetNo = Math.ceil(list.size() / sheetSize);"], [232, "        for (int index = 0; index <= sheetNo; index++)"], [234, "            // \u4ea7\u751f\u5de5\u4f5c\u8868\u5bf9\u8c61"], [235, "            HSSFSheet sheet = workbook.createSheet();"], [236, "            if (sheetNo == 0)"], [237, "            {"], [238, "                workbook.setSheetName(index, sheetName);"], [239, "            }"], [240, "            else"], [242, "                // \u8bbe\u7f6e\u5de5\u4f5c\u8868\u7684\u540d\u79f0."], [243, "                workbook.setSheetName(index, sheetName + index);"], [245, "            HSSFRow row;"], [246, "            HSSFCell cell; // \u4ea7\u751f\u5355\u5143\u683c"], [248, "            // \u4ea7\u751f\u4e00\u884c"], [249, "            row = sheet.createRow(0);"], [250, "            // \u5199\u5165\u5404\u4e2a\u5b57\u6bb5\u7684\u5217\u5934\u540d\u79f0"], [251, "            for (int i = 0; i < fields.size(); i++)"], [253, "                Field field = fields.get(i);"], [254, "                Excel attr = field.getAnnotation(Excel.class);"], [255, "                // \u521b\u5efa\u5217"], [256, "                cell = row.createCell(i);"], [257, "                // \u8bbe\u7f6e\u5217\u4e2d\u5199\u5165\u5185\u5bb9\u4e3aString\u7c7b\u578b"], [258, "                cell.setCellType(HSSFCell.CELL_TYPE_STRING);"], [259, "                HSSFCellStyle cellStyle = workbook.createCellStyle();"], [260, "                cellStyle.setAlignment(HSSFCellStyle.ALIGN_CENTER);"], [261, "                cellStyle.setVerticalAlignment(CellStyle.VERTICAL_CENTER);"], [262, "                if (attr.name().indexOf(\"\u6ce8\uff1a\") >= 0)"], [264, "                    HSSFFont font = workbook.createFont();"], [265, "                    font.setColor(HSSFFont.COLOR_RED);"], [266, "                    cellStyle.setFont(font);"], [267, "                    cellStyle.setFillForegroundColor(HSSFColor.LIGHT_YELLOW.index);"], [268, "                    sheet.setColumnWidth(i, 6000);"], [272, "                    HSSFFont font = workbook.createFont();"], [273, "                    // \u7c97\u4f53\u663e\u793a"], [274, "                    font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);"], [275, "                    // \u9009\u62e9\u9700\u8981\u7528\u5230\u7684\u5b57\u4f53\u683c\u5f0f"], [276, "                    cellStyle.setFont(font);"], [277, "                    cellStyle.setFillForegroundColor(HSSFColor.LIGHT_YELLOW.index);"], [278, "                    // \u8bbe\u7f6e\u5217\u5bbd"], [279, "                    sheet.setColumnWidth(i, 3766);"], [281, "                cellStyle.setFillPattern(HSSFCellStyle.SOLID_FOREGROUND);"], [282, "                cellStyle.setWrapText(true);"], [283, "                cell.setCellStyle(cellStyle);"], [284, ""], [285, "                // \u5199\u5165\u5217\u540d"], [286, "                cell.setCellValue(attr.name());"], [288, "                // \u5982\u679c\u8bbe\u7f6e\u4e86\u63d0\u793a\u4fe1\u606f\u5219\u9f20\u6807\u653e\u4e0a\u53bb\u63d0\u793a."], [289, "                if (StringUtils.isNotEmpty(attr.prompt()))"], [290, "                {"], [291, "                    // \u8fd9\u91cc\u9ed8\u8ba4\u8bbe\u4e862-101\u5217\u63d0\u793a."], [292, "                    setHSSFPrompt(sheet, \"\", attr.prompt(), 1, 100, i, i);"], [293, "                }"], [294, "                // \u5982\u679c\u8bbe\u7f6e\u4e86combo\u5c5e\u6027\u5219\u672c\u5217\u53ea\u80fd\u9009\u62e9\u4e0d\u80fd\u8f93\u5165"], [295, "                if (attr.combo().length > 0)"], [297, "                    // \u8fd9\u91cc\u9ed8\u8ba4\u8bbe\u4e862-101\u5217\u53ea\u80fd\u9009\u62e9\u4e0d\u80fd\u8f93\u5165."], [298, "                    setHSSFValidation(sheet, attr.combo(), 1, 100, i, i);"], [300, "            }"], [302, "            int startNo = index * sheetSize;"], [303, "            int endNo = Math.min(startNo + sheetSize, list.size());"], [304, "            // \u5199\u5165\u5404\u6761\u8bb0\u5f55,\u6bcf\u6761\u8bb0\u5f55\u5bf9\u5e94excel\u8868\u4e2d\u7684\u4e00\u884c"], [305, "            HSSFCellStyle cs = workbook.createCellStyle();"], [306, "            cs.setAlignment(HSSFCellStyle.ALIGN_CENTER);"], [307, "            cs.setVerticalAlignment(CellStyle.VERTICAL_CENTER);"], [308, "            for (int i = startNo; i < endNo; i++)"], [309, "            {"], [310, "                row = sheet.createRow(i + 1 - startNo);"], [311, "                // \u5f97\u5230\u5bfc\u51fa\u5bf9\u8c61."], [312, "                T vo = (T) list.get(i);"], [313, "                for (int j = 0; j < fields.size(); j++)"], [315, "                    // \u83b7\u5f97field."], [316, "                    Field field = fields.get(j);"], [317, "                    // \u8bbe\u7f6e\u5b9e\u4f53\u7c7b\u79c1\u6709\u5c5e\u6027\u53ef\u8bbf\u95ee"], [318, "                    field.setAccessible(true);"], [319, "                    Excel attr = field.getAnnotation(Excel.class);"], [320, "                    try"], [322, "                        // \u6839\u636eExcel\u4e2d\u8bbe\u7f6e\u60c5\u51b5\u51b3\u5b9a\u662f\u5426\u5bfc\u51fa,\u6709\u4e9b\u60c5\u51b5\u9700\u8981\u4fdd\u6301\u4e3a\u7a7a,\u5e0c\u671b\u7528\u6237\u586b\u5199\u8fd9\u4e00\u5217."], [323, "                        if (attr.isExport())"], [325, "                            // \u521b\u5efacell"], [326, "                            cell = row.createCell(j);"], [327, "                            cell.setCellStyle(cs);"], [328, "                            try"], [329, "                            {"], [330, "                                if (String.valueOf(field.get(vo)).length() > 10)"], [331, "                                {"], [332, "                                    throw new Exception(\"\u957f\u5ea6\u8d85\u8fc710\u4f4d\u5c31\u4e0d\u7528\u8f6c\u6570\u5b57\u4e86\");"], [333, "                                }"], [334, "                                // \u5982\u679c\u53ef\u4ee5\u8f6c\u6210\u6570\u5b57\u5219\u5bfc\u51fa\u4e3a\u6570\u5b57\u7c7b\u578b"], [335, "                                BigDecimal bc = new BigDecimal(String.valueOf(field.get(vo)));"], [336, "                                cell.setCellType(HSSFCell.CELL_TYPE_NUMERIC);"], [337, "                                cell.setCellValue(bc.doubleValue());"], [338, "                            }"], [339, "                            catch (Exception e)"], [341, "                                cell.setCellType(HSSFCell.CELL_TYPE_STRING);"], [342, "                                if (vo == null)"], [344, "                                    // \u5982\u679c\u6570\u636e\u5b58\u5728\u5c31\u586b\u5165,\u4e0d\u5b58\u5728\u586b\u5165\u7a7a\u683c."], [345, "                                    cell.setCellValue(\"\");"], [347, "                                else"], [349, "                                    // \u5982\u679c\u6570\u636e\u5b58\u5728\u5c31\u586b\u5165,\u4e0d\u5b58\u5728\u586b\u5165\u7a7a\u683c."], [350, "                                    cell.setCellValue(field.get(vo) == null ? \"\" : String.valueOf(field.get(vo)));"], [351, "                                }"], [355, "                    }"], [356, "                    catch (Exception e)"], [357, "                    {"], [358, "                        log.error(\"\u5bfc\u51faExcel\u5931\u8d25{}\", e.getMessage());"], [362, "        }"], [363, "        try"], [364, "        {"], [366, "            OutputStream out = new FileOutputStream(getfile() + filename);"], [368, "            out.close();"], [373, "            log.error(\"\u5173\u95edflush\u5931\u8d25{}\", e.getMessage());"]]}, "num_lines_added": 166, "num_lines_removed": 132}