{"hash": "02bf3215f2b17b8fe6719a515ecc3bbf5c3641b4", "message": "convert ZkRing to use WatchedInt for current and updating-to versions. additionally, both of these version nodes are now expected to be present at all times, including creation.", "file_num_lines": 209, "diff_parsed": {"added": [[40, "import com.rapleaf.hank.zookeeper.WatchedInt;"], [91, "  private final WatchedInt currentVersionNumber;"], [92, "  private final WatchedInt updatingToVersionNumber;"], [93, ""], [104, ""], [105, "    currentVersionNumber = new WatchedInt(zk, ringPath + CURRENT_VERSION_PATH_SEGMENT);"], [106, "    updatingToVersionNumber = new WatchedInt(zk, ringPath + UPDATING_TO_VERSION_PATH_SEGMENT);"], [153, "    return currentVersionNumber.get();"], [158, "    return updatingToVersionNumber.get();"], [164, "      currentVersionNumber.set(getUpdatingToVersionNumber());"], [165, "      updatingToVersionNumber.set(null);"], [208, "    zk.create(ringPath + CURRENT_VERSION_PATH_SEGMENT, null, Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);"], [227, "      updatingToVersionNumber.set(latestVersionNumber);"]], "deleted": [[146, "    try {"], [147, "      return zk.getIntOrNull(ringPath + CURRENT_VERSION_PATH_SEGMENT);"], [148, "    } catch (Exception e) {"], [149, "      throw new RuntimeException(e);"], [150, "    }"], [155, "    try {"], [156, "      return zk.getIntOrNull(ringPath + UPDATING_TO_VERSION_PATH_SEGMENT);"], [157, "    } catch (Exception e) {"], [158, "      throw new RuntimeException(e);"], [159, "    }"], [165, "      if (zk.exists(ringPath + CURRENT_VERSION_PATH_SEGMENT, false) != null) {"], [166, "        zk.setData(ringPath + CURRENT_VERSION_PATH_SEGMENT, getUpdatingToVersionNumber().toString().getBytes(), -1);"], [167, "      } else {"], [168, "        zk.create(ringPath + CURRENT_VERSION_PATH_SEGMENT, getUpdatingToVersionNumber().toString().getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);"], [169, "      }"], [170, "      zk.delete(ringPath + UPDATING_TO_VERSION_PATH_SEGMENT, -1);"], [231, "      zk.setOrCreate(ringPath + UPDATING_TO_VERSION_PATH_SEGMENT, latestVersionNumber, CreateMode.PERSISTENT);"]]}, "num_lines_added": 13, "num_lines_removed": 17}