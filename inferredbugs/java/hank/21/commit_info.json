{"hash": "f9e754c1795fa99e80e648993fedd2a551ceb77f", "message": "Implement WatchedEnum and use it to watch the state in ZkHost", "file_num_lines": 195, "diff_parsed": {"added": [[20, "import com.rapleaf.hank.coordinator.HostState;"], [24, "import com.rapleaf.hank.zookeeper.WatchedNodeListener;"], [40, "public class HostConnection implements WatchedNodeListener<HostState> {"], [75, "    onWatchedNodeChange(host.getState());"], [228, "  public void onWatchedNodeChange(HostState hostState) {"], [230, "      if (hostState != null && hostState == HostState.SERVING) {"], [231, "        // Reconnect"], [232, "        lock();"], [233, "        try {"], [234, "          disconnect();"], [235, "          try {"], [236, "            connect();"], [237, "          } catch (IOException e) {"], [238, "            LOG.error(\"Error connection to host.\", e);"], [239, "          }"], [240, "        } finally {"], [241, "          unlock();"], [242, "        }"], [243, "      } else {"], [244, "        // Disconnect and standby"], [245, "        lock();"], [246, "        try {"], [247, "          disconnect();"], [248, "          state = HostConnectionState.STANDBY;"], [249, "        } finally {"], [250, "          unlock();"]], "deleted": [[20, "import com.rapleaf.hank.coordinator.HostStateChangeListener;"], [39, "public class HostConnection implements HostStateChangeListener {"], [74, "    onHostStateChange(host);"], [227, "  public void onHostStateChange(Host host) {"], [229, "      try {"], [230, "        switch (host.getState()) {"], [231, "          case SERVING:"], [232, "            lock();"], [233, "            try {"], [234, "              disconnect();"], [235, "              connect();"], [236, "            } finally {"], [237, "              unlock();"], [238, "            }"], [239, "            break;"], [240, ""], [241, "          default:"], [242, "            lock();"], [243, "            try {"], [244, "              disconnect();"], [245, "              state = HostConnectionState.STANDBY;"], [246, "            } finally {"], [247, "              unlock();"], [248, "            }"], [250, "      } catch (IOException e) {"], [251, "        LOG.error(\"Exception while trying to get host state!\", e);"]]}, "num_lines_added": 26, "num_lines_removed": 26}