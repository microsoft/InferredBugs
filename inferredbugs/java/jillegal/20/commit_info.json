{"hash": "78830ddb47cb1e44d8701b5f722e706f08c5a694", "message": "jillegal impl for version 2.2-SNAPSHOT", "file_num_lines": 175, "diff_parsed": {"added": [[26, "\tprotected long arrayStartAddress;"], [48, "\t\t// Clear array content"], [49, "\t\tdirectMemoryService.setMemory(arrayIndexStartAddress, arrayIndexScale * length, (byte) 0);"], [51, "\t\tprimitiveArray = (A) directMemoryService.getObject(arrayStartAddress);"], [163, "\t\ttry {"], [164, "\t\t\tthis.elementType = elementType;"], [165, "\t\t\tthis.length = length;"], [166, "\t\t\tthis.directMemoryService = directMemoryService;"], [167, ""], [168, "\t\t\telementSize = JvmUtil.sizeOfType(elementType);"], [169, "\t\t\tarraySize = JvmUtil.sizeOfArray(elementType, length);"], [170, "\t\t\tallocationSize ="], [171, "\t\t\t\t\tarraySize + (length * elementSize) + JvmUtil.OBJECT_ADDRESS_SENSIVITY; // Extra memory for possible aligning"], [172, "\t\t\tallocationStartAddress = directMemoryService.allocateMemory(allocationSize);"], [173, "\t\t\tallocationEndAddress = allocationStartAddress + allocationSize;"], [174, ""], [175, "\t\t\tarrayStartAddress = allocationStartAddress;"], [176, "\t\t\tlong addressMod = arrayStartAddress % JvmUtil.OBJECT_ADDRESS_SENSIVITY;"], [177, "\t\t\tif (addressMod != 0) {"], [178, "\t\t\t\tarrayStartAddress += (JvmUtil.OBJECT_ADDRESS_SENSIVITY - addressMod);"], [179, "\t\t\t}"], [180, ""], [181, "\t\t\tsampleArray = (A) Array.newInstance(JvmUtil.primitiveTypeOf(elementType), 0);"], [182, ""], [183, "\t\t\tint arrayHeaderSize = JvmUtil.getArrayHeaderSize();"], [184, "\t\t\tarrayIndexScale = JvmUtil.arrayIndexScale(elementType);"], [185, "\t\t\tarrayIndexStartAddress = arrayStartAddress + JvmUtil.arrayBaseOffset(elementType);"], [186, ""], [187, "\t\t\t// Copy sample array header to object pool array header"], [188, "\t\t\tfor (int i = 0; i < arrayHeaderSize; i++) {"], [189, "\t\t\t\tdirectMemoryService.putByte(arrayStartAddress + i, directMemoryService.getByte(sampleArray, i));"], [190, "\t\t\t}"], [191, ""], [192, "\t\t\t// Set length of array object pool array"], [193, "\t\t\tJvmUtil.setArrayLength(arrayStartAddress, elementType, length);"], [194, ""], [195, "\t\t\tinit();"], [196, ""], [197, "\t\t\tmakeAvaiable();"], [198, "\t\t}"], [199, "\t\tcatch (IllegalArgumentException e) {"], [200, "\t\t\tthrow e;"], [201, "\t\t}"], [202, "\t\tcatch (Throwable t) {"], [203, "\t\t\tlogger.error(\"Error occured while initializing \\\"PrimitiveTypeArrayOffHeapPool\\\"\", t);"], [204, "\t\t\tthrow new IllegalStateException(t);"], [205, "\t\t}"]], "deleted": [[46, ""], [47, "\t\tint arrayHeaderSize = JvmUtil.getArrayHeaderSize();"], [48, "\t\tarrayIndexScale = JvmUtil.arrayIndexScale(elementType);"], [49, "\t\tarrayIndexStartAddress = allocationStartAddress + JvmUtil.arrayBaseOffset(elementType);"], [51, "\t\t// Copy sample array header to object pool array header"], [52, "\t\tfor (int i = 0; i < arrayHeaderSize; i++) {"], [53, "\t\t\tdirectMemoryService.putByte(allocationStartAddress + i, directMemoryService.getByte(sampleArray, i));"], [54, "\t\t}"], [56, "\t\t// Set length of array object pool array"], [57, "\t\tJvmUtil.setArrayLength(allocationStartAddress, elementType, length);"], [58, ""], [59, "\t\tthis.primitiveArray = (A) directMemoryService.getObject(allocationStartAddress);"], [171, "\t\tthis.elementType = elementType;"], [172, "\t\tthis.length = length;"], [173, "\t\tthis.directMemoryService = directMemoryService;"], [174, "\t\tthis.elementSize = JvmUtil.sizeOfType(elementType);"], [175, "\t\tthis.arraySize = JvmUtil.sizeOfArray(elementType, length);"], [176, "\t\tthis.allocationSize ="], [177, "\t\t\t\tarraySize + (length * elementSize) + JvmUtil.getAddressSize(); // Extra memory for possible aligning"], [178, "\t\tthis.allocationStartAddress = directMemoryService.allocateMemory(allocationSize);"], [179, "\t\tthis.allocationEndAddress = allocationStartAddress + allocationSize;"], [180, "\t\tthis.sampleArray = (A) Array.newInstance(JvmUtil.primitiveTypeOf(elementType), 0);"], [181, ""], [182, "\t\tinit();"], [183, "\t\tmakeAvaiable();"]]}, "num_lines_added": 47, "num_lines_removed": 25}