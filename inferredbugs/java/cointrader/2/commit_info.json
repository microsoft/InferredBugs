{"hash": "43fc684eb08fa75dd322991cfe04916011345397", "message": "PersistUtil cleanups COULD BE DANGEROUS \u2013 hope not :)", "file_num_lines": 331, "diff_parsed": {"added": [[28, "        EntityManager em = null;"], [29, "        boolean persited = true;"], [30, "        try {"], [31, "            em = createEntityManager();"], [32, "            PersistUtilHelper.beginTransaction();"], [33, ""], [35, "                for (EntityBase entity : entities) {"], [36, "                    // em.refresh(entity);"], [37, "                    // if (em.contains(entity))"], [38, "                    ///    em.merge(entity);"], [39, "                    // else"], [40, "                    em.persist(entity);"], [41, "                    PersistUtilHelper.commit();"], [44, "            } catch (Exception | Error e) {"], [45, "                persited = false;"], [46, "                e.printStackTrace();"], [47, "                if (PersistUtilHelper.isActive())"], [48, "                    PersistUtilHelper.rollback();"], [50, "        } finally {"], [51, "            if (persited) {"], [52, "                if( log.isDebugEnabled() ) {"], [53, "                    for( EntityBase entity : entities )"], [54, "                        log.debug(entity.getClass().getSimpleName() + \": \" +"], [55, "                                          entity.getId().toString() + \" saved to database\");"], [56, "                }"], [57, "            }"], [58, "            else {"], [59, "                for( EntityBase entity : entities )"], [60, "                    log.error(entity.getClass().getSimpleName() + \": \" +"], [61, "                                      entity.getId().toString() + \" not saved to database\");"], [62, "            }"], [63, "            if( em != null && em.isOpen())"], [64, "                PersistUtilHelper.closeEntityManager();"], [65, ""], [70, "        EntityManager em = null;"], [71, "        boolean persited = true;"], [72, "        try {"], [73, "            em = createEntityManager();"], [74, "            PersistUtilHelper.beginTransaction();"], [75, ""], [77, "                for (EntityBase entity : entities) {"], [78, "                    em.merge(entity);"], [79, "                    PersistUtilHelper.commit();"], [82, "            } catch (Exception | Error e) {"], [83, "                persited = false;"], [84, "                e.printStackTrace();"], [85, "                if (PersistUtilHelper.isActive())"], [86, "                    PersistUtilHelper.rollback();"], [88, "        } finally {"], [89, "            if (persited)"], [90, "                for (EntityBase entity : entities)"], [91, "                    log.debug(entity.getClass().getSimpleName() + \": \" + entity.getId().toString() + \" saved to database\");"], [92, "            else"], [93, "                for (EntityBase entity : entities)"], [94, "                    log.error(entity.getClass().getSimpleName() + \": \" + entity.getId().toString() + \" not saved to database\");"], [95, "            if (em != null && em.isOpen())"], [96, "                PersistUtilHelper.closeEntityManager();"], [97, ""]], "deleted": [[26, "    private static Object lock = new Object();"], [29, "        synchronized (lock) {"], [30, "            EntityManager em = null;"], [31, "            boolean persited = true;"], [33, "                em = createEntityManager();"], [34, "                PersistUtilHelper.beginTransaction();"], [35, ""], [36, "                try {"], [37, "                    for (EntityBase entity : entities) {"], [38, "                        // em.refresh(entity);"], [39, "                        // if (em.contains(entity))"], [40, "                        ///    em.merge(entity);"], [41, "                        // else"], [42, "                        em.persist(entity);"], [43, "                        PersistUtilHelper.commit();"], [44, "                    }"], [45, ""], [46, "                } catch (Exception | Error e) {"], [47, "                    persited = false;"], [48, "                    e.printStackTrace();"], [49, "                    if (PersistUtilHelper.isActive())"], [50, "                        PersistUtilHelper.rollback();"], [52, "            } finally {"], [53, "                if (persited)"], [54, "                    for (EntityBase entity : entities)"], [55, "                        log.debug(entity.getClass().getSimpleName() + \": \" + entity.getId().toString() + \" saved to database\");"], [56, "                else"], [57, "                    for (EntityBase entity : entities)"], [58, "                        log.error(entity.getClass().getSimpleName() + \": \" + entity.getId().toString() + \" not saved to database\");"], [59, "                if (em != null && em.isOpen())"], [60, "                    PersistUtilHelper.closeEntityManager();"], [67, "        synchronized (lock) {"], [68, "            EntityManager em = null;"], [69, "            boolean persited = true;"], [71, "                em = createEntityManager();"], [72, "                PersistUtilHelper.beginTransaction();"], [73, ""], [74, "                try {"], [75, "                    for (EntityBase entity : entities) {"], [76, "                        // em.find(entity.getClass(), entity.getId());"], [77, "                        // em."], [78, "                        // em.refresh(entity);"], [79, "                        //if (em.contains(entity))"], [80, "                        //   em.merge(entity);"], [81, "                        //else"], [82, "                        em.merge(entity);"], [83, "                        PersistUtilHelper.commit();"], [84, "                    }"], [85, ""], [86, "                } catch (Exception | Error e) {"], [87, "                    persited = false;"], [88, "                    e.printStackTrace();"], [89, "                    if (PersistUtilHelper.isActive())"], [90, "                        PersistUtilHelper.rollback();"], [92, "            } finally {"], [93, "                if (persited)"], [94, "                    for (EntityBase entity : entities)"], [95, "                        log.debug(entity.getClass().getSimpleName() + \": \" + entity.getId().toString() + \" saved to database\");"], [96, "                else"], [97, "                    for (EntityBase entity : entities)"], [98, "                        log.error(entity.getClass().getSimpleName() + \": \" + entity.getId().toString() + \" not saved to database\");"], [99, "                if (em != null && em.isOpen())"], [100, "                    PersistUtilHelper.closeEntityManager();"], [311, "        // return entityManagerFactory.createEntityManager();"], [395, "    //private static EntityManagerFactory entityManagerFactory;"]]}, "num_lines_added": 58, "num_lines_removed": 65}