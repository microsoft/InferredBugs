{"hash": "958eb7498112429aecb19785feff117080c01465", "message": "[for 4.6.0] Fix concurrent problem in ProducerManager.getAvaliableChannel; Fix problem that tx check may loss when channel is busy (#1627)", "file_num_lines": 96, "diff_parsed": {"added": [[22, "import java.util.Map;"], [23, ""], [78, "        Map<Channel, ClientChannelInfo> channelMap = producerManager.getGroupChannelTable().get(group);"], [89, "        Map<Channel, ClientChannelInfo> channelMap = producerManager.getGroupChannelTable().get(group);"], [106, "        Map<Channel, ClientChannelInfo> oldMap = producerManager.getGroupChannelTable().get(group);"], [109, "        assertThat(oldMap.size()).isEqualTo(0);"], [111, ""], [112, "    @Test"], [113, "    public void testGetAvaliableChannel() {"], [114, "        producerManager.registerProducer(group, clientInfo);"], [115, ""], [116, "        when(channel.isActive()).thenReturn(true);"], [117, "        when(channel.isWritable()).thenReturn(true);"], [118, "        Channel c = producerManager.getAvaliableChannel(group);"], [119, "        assertThat(c).isSameAs(channel);"], [120, ""], [121, "        when(channel.isWritable()).thenReturn(false);"], [122, "        c = producerManager.getAvaliableChannel(group);"], [123, "        assertThat(c).isSameAs(channel);"], [124, ""], [125, "        when(channel.isActive()).thenReturn(false);"], [126, "        c = producerManager.getAvaliableChannel(group);"], [127, "        assertThat(c).isNull();"], [128, "    }"], [129, ""]], "deleted": [[22, "import java.util.HashMap;"], [77, "        HashMap<Channel, ClientChannelInfo> channelMap = producerManager.getGroupChannelTable().get(group);"], [88, "        HashMap<Channel, ClientChannelInfo> channelMap = producerManager.getGroupChannelTable().get(group);"], [105, "        HashMap<Channel, ClientChannelInfo> oldMap = producerManager.getGroupChannelTable().get(group);"], [108, "        assertThat(oldMap.size()).isNotEqualTo(0);"]]}, "num_lines_added": 25, "num_lines_removed": 5}