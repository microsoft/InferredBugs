{"hash": "04d05638592d1b37d443fbd5e814c822197b833e", "message": "Fix for #535. Static files in jar", "file_num_lines": 160, "diff_parsed": {"added": [[2, " * Copyright 2016 - Per Wendel"], [20, "import java.io.InputStream;"], [40, "import spark.resource.JarResourceHandler;"], [53, "    private List<JarResourceHandler> jarResourceHandlers = null;"], [68, "        if (consumeWithFileResourceHandlers(httpRequest, httpResponse)) {"], [69, "            return true;"], [70, "        }"], [71, ""], [72, "        if (consumeWithJarResourceHandler(httpRequest, httpResponse)) {"], [73, "            return true;"], [74, "        }"], [75, ""], [76, "        return false;"], [77, "    }"], [78, ""], [79, ""], [80, "    private boolean consumeWithFileResourceHandlers(HttpServletRequest httpRequest,"], [81, "                                                    HttpServletResponse httpResponse) throws IOException {"], [83, ""], [85, ""], [87, ""], [97, ""], [99, "        return false;"], [100, "    }"], [101, ""], [102, "    private boolean consumeWithJarResourceHandler(HttpServletRequest httpRequest,"], [103, "                                                  HttpServletResponse httpResponse) throws IOException {"], [104, "        if (jarResourceHandlers != null) {"], [105, ""], [106, "            for (JarResourceHandler jarResourceHandler : jarResourceHandlers) {"], [107, "                InputStream stream = jarResourceHandler.getResource(httpRequest);"], [108, ""], [109, "                if (stream != null) {"], [110, "                    OutputStream wrappedOutputStream = GzipUtils.checkAndWrap(httpRequest, httpResponse, false);"], [111, "                    customHeaders.forEach(httpResponse::setHeader); //add all user-defined headers to response"], [112, ""], [113, "                    IOUtils.copy(stream, wrappedOutputStream);"], [114, ""], [115, "                    wrappedOutputStream.flush();"], [116, "                    wrappedOutputStream.close();"], [118, "                    return true;"], [119, "                }"], [120, "            }"], [121, "        }"], [129, ""], [134, ""], [135, "        if (jarResourceHandlers != null) {"], [136, "            jarResourceHandlers.clear();"], [137, "            jarResourceHandlers = null;"], [138, "        }"], [139, ""], [155, ""], [156, "                if (configureJarCase(folder, resource)) {"], [157, "                    return;"], [158, "                }"], [159, ""], [168, ""], [179, "    private boolean configureJarCase(String folder, ClassPathResource resource) throws IOException {"], [180, "        if (resource.getURL().getProtocol().equals(\"jar\")) {"], [181, ""], [182, "            InputStream stream = StaticFilesConfiguration.class.getResourceAsStream(folder);"], [183, ""], [184, "            if (stream != null) {"], [185, "                if (jarResourceHandlers == null) {"], [186, "                    jarResourceHandlers = new ArrayList<>();"], [187, "                }"], [188, ""], [189, "                // Add jar file resource handler"], [190, "                jarResourceHandlers.add(new JarResourceHandler(folder, \"index.html\"));"], [191, "                staticResourcesSet = true;"], [192, "                return true;"], [193, "            } else {"], [194, "                LOG.error(\"Static file configuration failed.\");"], [195, "            }"], [196, ""], [197, "        }"], [198, "        return false;"], [199, "    }"], [200, ""]], "deleted": [[2, " * Copyright 2015 - Per Wendel"]]}, "num_lines_added": 79, "num_lines_removed": 1}