{"hash": "0e0fcb99297d569a3cf1ccda4b7d25e44f73a41a", "message": "Fix the leader election issue when an invalid controller leader node with stale session was found.\n\nSince HelixManager refreshes the session Id only when new session event was processed, there could be a delay before the new session Id becomes visible to the election method. In these case, an invalid leader node might be created with a stale session Id. As a result, this invalid node prevents the other controllers (including the original controller with a new session Id now) from acquiring the leadership.\n\nThis change make leader check respect the ZkNode ephemeral owner Id instead of the content. Note that in this case, the node content will still contains the stale session Id, but leader check will return the correct result. The invalid node issue will be fixed as a next step. Basically, we need to discard the stale event when processing ZK events. This is not a blocking issue here.\n\nIn addition, added a DistControllerElection test case using real helix managers.", "file_num_lines": 872, "diff_parsed": {"added": [[819, "        String sessionId = Long.toHexString(leader.getRecord().getEphemeralOwner());"], [820, "        if (leaderName != null && leaderName.equals(_instanceName) && sessionId"]], "deleted": [[819, "        String sessionId = leader.getSessionId();"], [820, "        if (leaderName != null && leaderName.equals(_instanceName) && sessionId != null && sessionId"]]}, "num_lines_added": 2, "num_lines_removed": 2}