{"hash": "79f94cedae2dca5f57113bc80f7cd1af91b0ce31", "message": "[HELIX-618] Job hung if the target resource does not exist anymore at the time when it is scheduled, fixed it to mark job failed instead.", "file_num_lines": 280, "diff_parsed": {"added": [[80, "    // Check if workflow has been finished and mark it if it is."], [81, "    if (workflowCtx.getFinishTime() == WorkflowContext.UNFINISHED"], [82, "        && isWorkflowFinished(workflowCtx, workflowCfg)) {"], [83, "      workflowCtx.setFinishTime(currentTime);"], [84, "      TaskUtil.setWorkflowContext(_manager, workflow, workflowCtx);"], [88, "      LOG.info(\"Workflow \" + workflow + \" is finished.\");"], [163, ""], [164, "    int numPartitions = numIndependentTasks;"], [165, "    if (numPartitions == 0) {"], [166, "      IdealState targetIs ="], [167, "          admin.getResourceIdealState(_manager.getClusterName(), jobConfig.getTargetResource());"], [168, "      if (targetIs == null) {"], [169, "        LOG.warn(\"Target resource does not exist for job \" + jobResource);"], [170, "        // do not need to fail here, the job will be marked as failure immediately when job starts running."], [171, "      } else {"], [172, "        numPartitions = targetIs.getPartitionSet().size();"], [173, "      }"], [174, "    }"], [175, ""]], "deleted": [[80, "    // Check if workflow is completed and mark it if it is completed."], [81, "    if (workflowCtx.getFinishTime() == WorkflowContext.UNFINISHED) {"], [82, "      if (isWorkflowComplete(workflowCtx, workflowCfg)) {"], [83, "        workflowCtx.setWorkflowState(TaskState.COMPLETED);"], [84, "        workflowCtx.setFinishTime(currentTime);"], [85, "        TaskUtil.setWorkflowContext(_manager, workflow, workflowCtx);"], [86, "      }"], [90, "      LOG.info(\"Workflow \" + workflow + \" is completed.\");"], [165, "    int numPartitions = (numIndependentTasks > 0) ?"], [166, "        numIndependentTasks :"], [167, "        admin.getResourceIdealState(_manager.getClusterName(), jobConfig.getTargetResource())"], [168, "            .getPartitionSet().size();"]]}, "num_lines_added": 19, "num_lines_removed": 12}