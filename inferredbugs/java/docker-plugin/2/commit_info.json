{"hash": "2da60eace95674ef3d92475ba715fac7c3ad6577", "message": "fix build and push (#519)", "file_num_lines": 521, "diff_parsed": {"added": [[11, "import com.github.dockerjava.api.command.PushImageCmd;"], [45, "import org.apache.commons.lang.StringUtils;"], [50, "import org.kohsuke.accmod.AccessRestriction;"], [51, "import org.kohsuke.accmod.Restricted;"], [52, "import org.kohsuke.accmod.restrictions.NoExternalUse;"], [384, "            setRegistryAuthentication(imgCmd, registry);"], [739, "    }"], [742, "    // unfortunately there's no common interface for Registry related Docker-java commands"], [743, ""], [744, "    @Restricted(NoExternalUse.class)"], [745, "    public static void setRegistryAuthentication(PullImageCmd cmd, DockerRegistryEndpoint registry) {"], [746, "        if (registry != null && registry.getCredentialsId() != null) {"], [747, "            DockerRegistryToken token = registry.getToken(null);"], [748, "            AuthConfig auth = new AuthConfig();"], [749, "            if (StringUtils.isNotBlank(registry.getUrl())) {"], [750, "                    auth.withRegistryAddress(registry.getUrl());"], [751, "            }"], [752, "            auth.withEmail(token.getEmail())"], [753, "                .withRegistrytoken(token.getToken());"], [754, "            cmd.withAuthConfig(auth);"], [755, "        }"], [758, "    @Restricted(NoExternalUse.class)"], [759, "    public static void setRegistryAuthentication(PushImageCmd cmd, DockerRegistryEndpoint registry) {"], [760, "        if (registry != null && registry.getCredentialsId() != null) {"], [761, "            DockerRegistryToken token = registry.getToken(null);"], [762, "            AuthConfig auth = new AuthConfig();"], [763, "            if (StringUtils.isNotBlank(registry.getUrl())) {"], [764, "                auth.withRegistryAddress(registry.getUrl());"], [765, "            }"], [766, "            auth.withEmail(token.getEmail())"], [767, "                    .withRegistrytoken(token.getToken());"], [768, "            cmd.withAuthConfig(auth);"], [769, "        }"], [770, "    }"]], "deleted": [[379, "            if (registry == null) {"], [380, "                DockerRegistryToken token = registry.getToken(null);"], [381, "                AuthConfig auth = new AuthConfig()"], [382, "                        .withRegistryAddress(registry.getUrl())"], [383, "                        .withEmail(token.getEmail())"], [384, "                        .withRegistrytoken(token.getToken());"], [385, "                imgCmd.withAuthConfig(auth);"], [386, "            }"]]}, "num_lines_added": 34, "num_lines_removed": 8}