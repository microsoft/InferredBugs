{"hash": "2306aaf1947674c67469c87ed37b1e6dc7aade2f", "message": "\u4f18\u5316zookeeper\u5206\u5e03\u5f0f\u9501\u573a\u666f\u4ee3\u7801\uff0c\u4fee\u6539\u7ebf\u7a0b\u6c60\u914d\u7f6e", "file_num_lines": 49, "diff_parsed": {"added": [[12, "import java.util.HashMap;"], [13, "import java.util.Map;"], [22, "    private ThreadLocal<Map<Long, InterProcessMutex>> threadLock = new ThreadLocal<>();"], [26, "            if (threadLock.get() == null) {"], [27, "                Map<Long, InterProcessMutex> map = new HashMap();"], [28, "                map.put(seckillId,new InterProcessMutex(client,ROOT_LOCK_PATH+\"/\"+String.valueOf(seckillId)));"], [29, "                threadLock.set(map);"], [30, "            }else{"], [31, "                threadLock.get().get(seckillId).acquire(2L, TimeUnit.SECONDS);"], [42, "            threadLock.get().get(seckillId).release();"]], "deleted": [[12, "import java.util.concurrent.ConcurrentHashMap;"], [21, "    private ConcurrentHashMap<Long, InterProcessMutex> lockMap = new ConcurrentHashMap();"], [22, ""], [23, ""], [24, "    public static void main(String[] args) {"], [25, "//        RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 3);"], [26, "//        client = CuratorFrameworkFactory.newClient(PropertiesUtil.getProperty(\"zookeeper_ip\"), retryPolicy);"], [27, "//        client.start();"], [28, "//"], [29, "//        long seckillId = 1003L;"], [30, "//        lock = new InterProcessMutex(client, ROOT_LOCK_PATH + \"/\" + String.valueOf(seckillId));"], [31, "//        new ZookeeperLockUtil().lock(seckillId);"], [32, "//        Thread.sleep(10000);"], [33, "//        new ZookeeperLockUtil().releaseLock(seckillId);"], [34, "    }"], [38, "            if (lockMap.get(seckillId) == null) {"], [39, "                lockMap.put(seckillId, new InterProcessMutex(client, ROOT_LOCK_PATH+\"/\"+String.valueOf(seckillId)));"], [41, "            lockMap.get(seckillId).acquire(2L, TimeUnit.SECONDS);"], [51, "            lockMap.get(seckillId).release();"]]}, "num_lines_added": 10, "num_lines_removed": 19}