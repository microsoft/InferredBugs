{"hash": "d7b3ee98c36319e4b57d8e2cfeaf63b3a927f941", "message": "Suppress repeated attempts to query failed PDH (#1266)", "file_num_lines": 120, "diff_parsed": {"added": [[27, "import java.util.HashSet;"], [29, "import java.util.Set;"], [30, "import java.util.concurrent.locks.ReentrantLock;"], [42, "import oshi.annotation.concurrent.GuardedBy;"], [54, "    // Use a map to cache failed pdh queries"], [55, "    @GuardedBy(\"failedQueryCacheLock\")"], [56, "    private static final Set<String> failedQueryCache = new HashSet<>();"], [57, "    private static final ReentrantLock failedQueryCacheLock = new ReentrantLock();"], [58, ""], [91, "        // Check without locking for performance"], [92, "        if (!failedQueryCache.contains(perfObject)) {"], [93, "            failedQueryCacheLock.lock();"], [94, "            try {"], [95, "                // Double check lock"], [96, "                if (!failedQueryCache.contains(perfObject)) {"], [97, "                    Map<T, Long> valueMap = queryValuesFromPDH(propertyEnum, perfObject);"], [98, "                    if (!valueMap.isEmpty()) {"], [99, "                        return valueMap;"], [100, "                    }"], [101, "                    // If we are here, query failed"], [102, "                    LOG.warn(\"Disabling further attempts to query {}.\", perfObject);"], [103, "                    failedQueryCache.add(perfObject);"], [104, "                }"], [105, "            } finally {"], [106, "                failedQueryCacheLock.unlock();"], [107, "            }"], [109, "        return queryValuesFromWMI(propertyEnum, perfWmiClass);"]], "deleted": [[82, "        Map<T, Long> valueMap = queryValuesFromPDH(propertyEnum, perfObject);"], [83, "        if (valueMap.isEmpty()) {"], [84, "            return queryValuesFromWMI(propertyEnum, perfWmiClass);"], [86, "        return valueMap;"]]}, "num_lines_added": 27, "num_lines_removed": 4}