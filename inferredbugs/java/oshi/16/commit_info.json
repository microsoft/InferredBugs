{"hash": "ffd4be9ffea10a5eac30d6bbcea53a5ba2b7c82e", "message": "Switch OS X Serial # to IOKit registry (#158)\n\nFixes #156", "file_num_lines": 160, "diff_parsed": {"added": [[29, "import oshi.jna.platform.mac.CoreFoundation;"], [30, "import oshi.jna.platform.mac.CoreFoundation.CFStringRef;"], [31, "import oshi.jna.platform.mac.CoreFoundation.CFTypeRef;"], [32, "import oshi.jna.platform.mac.IOKit;"], [33, "import oshi.jna.platform.mac.IOKit.MachPort;"], [38, "import oshi.util.platform.mac.CfUtil;"], [199, "            int service = 0;"], [200, "            MachPort masterPort = new MachPort();"], [201, "            int result = IOKit.INSTANCE.IOMasterPort(0, masterPort);"], [202, "            if (result != 0) {"], [203, "                LOG.error(String.format(\"Error: IOMasterPort() = %08x\", result));"], [205, "            } else {"], [206, "                service = IOKit.INSTANCE.IOServiceGetMatchingService(masterPort.getValue(),"], [207, "                        IOKit.INSTANCE.IOServiceMatching(\"IOPlatformExpertDevice\"));"], [208, "                if (service == 0) {"], [209, "                    this.cpuSerialNumber = \"unknown\";"], [210, "                } else {"], [211, "                    // Fetch the serial number"], [212, "                    CFTypeRef serialNumberAsCFString = IOKit.INSTANCE.IORegistryEntryCreateCFProperty(service,"], [213, "                            CFStringRef.toCFString(\"IOPlatformSerialNumber\"),"], [214, "                            CoreFoundation.INSTANCE.CFAllocatorGetDefault(), 0);"], [215, "                    IOKit.INSTANCE.IOObjectRelease(service);"], [216, "                    this.cpuSerialNumber = CfUtil.cfPointerToString(serialNumberAsCFString.getPointer());"], [217, "                }"]], "deleted": [[20, "import java.util.ArrayList;"], [21, ""], [34, "import oshi.util.ExecutingCommand;"], [196, "            ArrayList<String> hwInfo = ExecutingCommand.runNative(\"system_profiler SPHardwareDataType\");"], [197, "            // Mavericks and later"], [198, "            for (String checkLine : hwInfo) {"], [199, "                if (checkLine.contains(\"Serial Number (system)\")) {"], [200, "                    String[] snSplit = checkLine.split(\"\\\\s+\");"], [201, "                    this.cpuSerialNumber = snSplit[snSplit.length - 1];"], [202, "                    break;"], [203, "                }"], [204, "            }"], [205, "            // Panther and later"], [206, "            if (this.cpuSerialNumber == null) {"], [207, "                for (String checkLine : hwInfo) {"], [208, "                    if (checkLine.contains(\"r (system)\")) {"], [209, "                        String[] snSplit = checkLine.split(\"\\\\s+\");"], [210, "                        this.cpuSerialNumber = snSplit[snSplit.length - 1];"], [211, "                        break;"], [212, "                    }"], [213, "                }"], [214, "            }"], [215, "            if (this.cpuSerialNumber == null) {"]]}, "num_lines_added": 24, "num_lines_removed": 23}