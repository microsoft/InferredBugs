{"hash": "6f35e31f7f850f6e95e171ffd124d9c83f17365e", "message": "[SSHD-132] NativeSshFile does not close RandomAccessFile on IOException\n\ngit-svn-id: https://svn.apache.org/repos/asf/mina/sshd/trunk@1340544 13f79535-47bb-0310-9956-ffa450edef68", "file_num_lines": 334, "diff_parsed": {"added": [[36, "import org.apache.sshd.server.SshFile;"], [37, "import org.slf4j.Logger;"], [38, "import org.slf4j.LoggerFactory;"], [39, ""], [287, "        try {"], [288, "            tempFile.setLength(0);"], [289, "        } finally {"], [290, "            tempFile.close();"], [291, "        }"], [376, "        // move to the appropriate offset and create output stream"], [378, "        try {"], [379, "            raf.setLength(offset);"], [380, "            raf.seek(offset);"], [381, ""], [382, "            // The IBM jre needs to have both the stream and the random access file"], [383, "            // objects closed to actually close the file"], [384, "            return new FileOutputStream(raf.getFD()) {"], [385, "                public void close() throws IOException {"], [386, "                    super.close();"], [387, "                    raf.close();"], [388, "                }"], [389, "            };"], [390, "        } catch (IOException e) {"], [391, "            raf.close();"], [392, "            throw e;"], [393, "        }"], [408, "        try {"], [409, "            raf.seek(offset);"], [410, ""], [411, "            // The IBM jre needs to have both the stream and the random access file"], [412, "            // objects closed to actually close the file"], [413, "            return new FileInputStream(raf.getFD()) {"], [414, "                public void close() throws IOException {"], [415, "                    super.close();"], [416, "                    raf.close();"], [417, "                }"], [418, "            };"], [419, "        } catch (IOException e) {"], [420, "            raf.close();"], [421, "            throw e;"], [422, "        }"]], "deleted": [[22, "import org.apache.sshd.server.SshFile;"], [23, "import org.slf4j.Logger;"], [24, "import org.slf4j.LoggerFactory;"], [25, ""], [287, "        tempFile.setLength(0);"], [288, "        tempFile.close();"], [373, "        // create output stream"], [375, "        raf.setLength(offset);"], [376, "        raf.seek(offset);"], [377, ""], [378, "        // The IBM jre needs to have both the stream and the random access file"], [379, "        // objects closed to actually close the file"], [380, "        return new FileOutputStream(raf.getFD()) {"], [381, "            public void close() throws IOException {"], [382, "                super.close();"], [383, "                raf.close();"], [384, "            }"], [385, "        };"], [400, "        raf.seek(offset);"], [401, ""], [402, "        // The IBM jre needs to have both the stream and the random access file"], [403, "        // objects closed to actually close the file"], [404, "        return new FileInputStream(raf.getFD()) {"], [405, "            public void close() throws IOException {"], [406, "                super.close();"], [407, "                raf.close();"], [408, "            }"], [409, "        };"]]}, "num_lines_added": 41, "num_lines_removed": 28}