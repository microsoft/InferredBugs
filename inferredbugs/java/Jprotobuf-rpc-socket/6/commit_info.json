{"hash": "667f44166962c596871a63c3244fed81740eb584", "message": "fix on failed on concurrent error of reinit loadbalance", "file_num_lines": 186, "diff_parsed": {"added": [[42, "import com.baidu.jprotobuf.pbrpc.client.ha.lb.strategy.NamingServiceLoadBalanceStrategyFactory;"], [43, "import com.baidu.jprotobuf.pbrpc.client.ha.lb.strategy.RRNamingServiceLoadBalanceStrategyFactory;"], [59, "    private NamingServiceLoadBalanceStrategyFactory loadBalanceStrategyFactory;"], [100, "            NamingServiceLoadBalanceStrategyFactory loadBalanceStrategyFactory, FailOverInterceptor failOverInterceptor) {"], [104, "        this.loadBalanceStrategyFactory = loadBalanceStrategyFactory;"], [174, "        if (loadBalanceStrategyFactory == null) {"], [175, "            loadBalanceStrategyFactory = new RRNamingServiceLoadBalanceStrategyFactory();"], [177, "        lbProxyBean.setLoadBalanceStrategy(loadBalanceStrategyFactory.create(service, namingService));"], [255, ""]], "deleted": [[42, "import com.baidu.jprotobuf.pbrpc.client.ha.lb.strategy.NamingServiceLoadBalanceStrategy;"], [43, "import com.baidu.jprotobuf.pbrpc.client.ha.lb.strategy.RoundRobinLoadBalanceStrategy;"], [59, "    private NamingServiceLoadBalanceStrategy loadBalanceStrategy;"], [100, "            NamingServiceLoadBalanceStrategy loadBalanceStrategy, FailOverInterceptor failOverInterceptor) {"], [104, "        this.loadBalanceStrategy = loadBalanceStrategy;"], [174, "        if (loadBalanceStrategy == null) {"], [175, "            loadBalanceStrategy = new RoundRobinLoadBalanceStrategy(service, namingService);"], [177, "        lbProxyBean.setLoadBalanceStrategy(loadBalanceStrategy);"], [253, "        // reinit naming service"], [254, "        loadBalanceStrategy.doReInit(service, new NamingService() {"], [255, ""], [256, "            @Override"], [257, "            public Map<String, List<InetSocketAddress>> list(Set<String> serviceSignatures) throws Exception {"], [258, "                Map<String, List<InetSocketAddress>> ret = new HashMap<String, List<InetSocketAddress>>();"], [259, "                ret.put(service, list);"], [260, "                return ret;"], [261, "            }"], [262, ""], [263, "        });"], [264, ""]]}, "num_lines_added": 9, "num_lines_removed": 20}