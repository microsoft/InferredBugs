{"hash": "c62960f5ef199f3cc19839130a286e236913e591", "message": "Start to manage loop in a PPTX.", "file_num_lines": 94, "diff_parsed": {"added": [[9, "import fr.opensagres.xdocreport.core.utils.StringUtils;"], [12, "import fr.opensagres.xdocreport.template.formatter.FieldsMetadata;"], [13, "import fr.opensagres.xdocreport.template.formatter.IDocumentFormatter;"], [17, "\tprivate final PPTXSlideDocument document;"], [18, "\tprivate final List<ARBufferedRegion> arBufferedRegions;"], [20, "\tpublic APBufferedRegion(PPTXSlideDocument document, BufferedElement parent,"], [21, "\t\t\tString uri, String localName, String name, Attributes attributes) {"], [23, "\t\tthis.document = document;"], [24, "\t\tthis.arBufferedRegions = new ArrayList<ARBufferedRegion>();"], [57, "\t\t\t\tupdate(toRemove, fullContent, lastAR);"], [61, "\t\tupdate(toRemove, fullContent, lastAR);"], [62, "\t\tsuper.removeAll(toRemove);"], [63, ""], [64, "\t}"], [65, ""], [66, "\tprivate void update(Collection<BufferedElement> toRemove,"], [67, "\t\t\tStringBuilder fullContent, ARBufferedRegion lastAR) {"], [69, "\t\t\tString content = fullContent.toString();"], [70, "\t\t\tString itemNameList = getItemNameList(content);"], [71, "\t\t\tlastAR.setTContent(itemNameList != null ? itemNameList : content);"], [78, "\tprivate String getItemNameList(String content) {"], [79, "\t\tIDocumentFormatter formatter = document.getFormatter();"], [80, "\t\tFieldsMetadata fieldsMetadata = document.getFieldsMetadata();"], [81, "\t\tif (formatter != null && fieldsMetadata != null) {"], [82, ""], [83, "\t\t\tCollection<String> fieldsAsList = fieldsMetadata.getFieldsAsList();"], [84, "\t\t\tfor (final String fieldName : fieldsAsList) {"], [85, "\t\t\t\tif (content.contains(fieldName)) {"], [86, "\t\t\t\t\tString itemNameList = formatter.extractItemNameList("], [87, "\t\t\t\t\t\t\tcontent, fieldName, true);"], [88, "\t\t\t\t\tif (StringUtils.isNotEmpty(itemNameList)) {"], [89, "\t\t\t\t\t\tsetStartLoopDirective(formatter"], [90, "\t\t\t\t\t\t\t\t.getStartLoopDirective(itemNameList));"], [91, "\t\t\t\t\t\tsetEndLoopDirective(formatter"], [92, "\t\t\t\t\t\t\t\t.getEndLoopDirective(itemNameList));"], [93, ""], [94, "\t\t\t\t\t\treturn formatter.formatAsFieldItemList(content,"], [95, "\t\t\t\t\t\t\t\tfieldName, true);"], [96, "\t\t\t\t\t}"], [97, "\t\t\t\t}"], [98, "\t\t\t}"], [99, "\t\t}"], [100, "\t\treturn null;"], [101, "\t}"], [102, ""], [103, "\tprivate void setEndLoopDirective(String endLoopDirective) {"], [104, "\t\tthis.endTagElement.setAfter(endLoopDirective);"], [105, "\t}"], [106, ""], [107, "\tprivate void setStartLoopDirective(String startLoopDirective) {"], [108, "\t\tthis.startTagElement.setBefore(startLoopDirective);"], [109, "\t}"], [110, ""]], "deleted": [[14, "\tprivate List<ARBufferedRegion> arBufferedRegions = new ArrayList<ARBufferedRegion>();"], [16, "\tpublic APBufferedRegion(BufferedElement parent, String uri,"], [17, "\t\t\tString localName, String name, Attributes attributes) {"], [32, ""], [52, "\t\t\t\tif (fullContent.length() > 0) {"], [53, "\t\t\t\t\tlastAR.setTContent(fullContent.toString());"], [54, "\t\t\t\t\tfullContent.setLength(0);"], [55, "\t\t\t\t\ttoRemove.remove(lastAR);"], [56, "\t\t\t\t}"], [61, "\t\t\tlastAR.setTContent(fullContent.toString());"], [65, "\t\tsuper.removeAll(toRemove);"]]}, "num_lines_added": 53, "num_lines_removed": 11}