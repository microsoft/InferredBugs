{"hash": "e8f27bb5ad2851a113ac4ace706a2e92622a2fda", "message": "This allows for headers and footers to be inherited from the previous\nsections, see http://officeopenxml.com/WPSectionHeaderReference.php. It\nalso allows for docx documents that do not specify types for sections to\nwork such as those created from Java.", "file_num_lines": 251, "diff_parsed": {"added": [[27, "import java.util.Collections;"], [72, "    private Map<Integer, Object> headers;"], [73, ""], [74, "    private Map<Integer, Object> footers;"], [75, ""], [89, "        headers = Collections.EMPTY_MAP;"], [90, "        footers = Collections.EMPTY_MAP;"], [206, "        boolean titlePage = XWPFUtils.isCTOnOff( sectPr.getTitlePg() );"], [207, "        Map<Integer, Object> previousHeaders = headers;"], [208, "        Map<Integer, Object> previousFooters = footers;"], [209, "        headers = new HashMap<Integer, Object>();"], [210, "        footers = new HashMap<Integer, Object>();"], [211, "        for ( CTHdrFtrRef reference : sectPr.getHeaderReferenceList() )"], [213, "            STHdrFtr type = reference.xgetType();"], [214, "            int typeValue = type == null ? STHdrFtr.INT_DEFAULT : type.enumValue().intValue();"], [215, "            if ( typeValue != STHdrFtr.INT_FIRST || titlePage )"], [217, "                masterPage.setType( typeValue );"], [218, "                documentHandler.visitHeaderRef( reference, sectPr, masterPage );"], [219, "                masterPage.setType( typeValue );"], [220, "                headers.put( typeValue, masterPage.getHeader() );"], [223, "        for ( CTHdrFtrRef reference : sectPr.getFooterReferenceList() )"], [225, "            STHdrFtr type = reference.xgetType();"], [226, "            int typeValue = type == null ? STHdrFtr.INT_DEFAULT : type.enumValue().intValue();"], [227, "            if ( typeValue != STHdrFtr.INT_FIRST || titlePage )"], [229, "                masterPage.setType( typeValue );"], [230, "                documentHandler.visitFooterRef( reference, sectPr, masterPage );"], [231, "                masterPage.setType( typeValue );"], [232, "                footers.put( typeValue, masterPage.getFooter() );"], [235, "        if ( titlePage )"], [236, "        {"], [237, "            inheritHeader( masterPage, STHdrFtr.INT_FIRST, previousHeaders );"], [238, "            inheritFooter( masterPage, STHdrFtr.INT_FIRST, previousFooters );"], [239, "        }"], [240, "        if ( evenAndOddHeaders )"], [241, "        {"], [242, "            inheritHeader( masterPage, STHdrFtr.INT_EVEN, previousHeaders );"], [243, "            inheritFooter( masterPage, STHdrFtr.INT_EVEN, previousFooters );"], [244, "        }"], [245, "        inheritHeader( masterPage, STHdrFtr.INT_DEFAULT, previousHeaders );"], [246, "        inheritFooter( masterPage, STHdrFtr.INT_DEFAULT, previousFooters );"], [248, "    }"], [249, ""], [250, "    private void inheritHeader( IXWPFMasterPage<Object> aMasterPage, int aType, Map<Integer, Object> aPreviousHeaders )"], [251, "    {"], [252, "        if ( !headers.containsKey( aType ) )"], [253, "        {"], [254, "            Object header = aPreviousHeaders.get( aType );"], [255, "            if ( header != null )"], [256, "            {"], [257, "                aMasterPage.setType( aType );"], [258, "                aMasterPage.setHeader( header );"], [259, "                headers.put( aType, header );"], [260, "            }"], [261, "        }"], [262, "    }"], [264, "    private void inheritFooter( IXWPFMasterPage<Object> aMasterPage, int aType, Map<Integer, Object> aPreviousFooters )"], [265, "    {"], [266, "        if ( !footers.containsKey( aType ) )"], [267, "        {"], [268, "            Object footer = aPreviousFooters.get( aType );"], [269, "            if ( footer != null )"], [270, "            {"], [271, "                aMasterPage.setType( aType );"], [272, "                aMasterPage.setFooter( footer );"], [273, "                footers.put( aType, footer );"], [274, "            }"], [275, "        }"], [322, "     *"]], "deleted": [[27, "import java.util.Collection;"], [183, ""], [201, "        boolean ignoreFirstHeaderFooter = !XWPFUtils.isCTOnOff( sectPr.getTitlePg() );"], [202, ""], [203, "        Collection<CTHdrFtrRef> headersRef = sectPr.getHeaderReferenceList();"], [204, "        Collection<CTHdrFtrRef> footersRef = sectPr.getFooterReferenceList();"], [205, ""], [206, "        boolean firstHeaderFooter = false;"], [207, "        for ( CTHdrFtrRef headerRef : headersRef )"], [209, "            STHdrFtr type = headerRef.xgetType();"], [210, "            firstHeaderFooter = ( type != null && type.enumValue() == STHdrFtr.FIRST );"], [211, "            if ( !firstHeaderFooter || ( firstHeaderFooter && !ignoreFirstHeaderFooter ) )"], [213, "                masterPage.setType( type.enumValue().intValue() );"], [214, "                documentHandler.visitHeaderRef( headerRef, sectPr, masterPage );"], [217, ""], [218, "        for ( CTHdrFtrRef footerRef : footersRef )"], [220, "            STHdrFtr type = footerRef.xgetType();"], [221, "            firstHeaderFooter = ( type != null && type.enumValue() == STHdrFtr.FIRST );"], [222, "            if ( !firstHeaderFooter || ( firstHeaderFooter && !ignoreFirstHeaderFooter ) )"], [224, "                masterPage.setType( type.enumValue().intValue() );"], [225, "                documentHandler.visitFooterRef( footerRef, sectPr, masterPage );"], [271, ""], [277, "     *"]]}, "num_lines_added": 68, "num_lines_removed": 23}