{"hash": "2c7dfd2a97513ec530d8d708f7df4fabdb824d36", "message": "Migration Fix\n\ngit-svn-id: http://hazelcast.googlecode.com/svn/trunk@906 3f8e66b6-ca9d-11dd-a2b5-e5f827957e07", "file_num_lines": 415, "diff_parsed": {"added": [[195, "                    concurrentMapManager.doBlockInfo(block);"], [239, "                        ConcurrentMapManager.BlockOwners allBlockOwners = new ConcurrentMapManager.BlockOwners();"], [241, "                            allBlockOwners.addBlock(block);"], [243, "                        dataAllBlocks = ThreadContext.get().toData(allBlockOwners);"], [368, "    void migrateBlock(final Block blockInfo) {"], [369, "        if (!concurrentMapManager.isBlockInfoValid(blockInfo)) {"], [372, "        if (!thisAddress.equals(blockInfo.getOwner())) {"], [375, "        if (!blockInfo.isMigrating()) {"], [378, "        if (blockInfo.getOwner().equals(blockInfo.getMigrationAddress())) {"], [381, "        Block blockReal = blocks[blockInfo.getBlockId()];"], [383, "            if (!blockInfo.getMigrationAddress().equals(blockReal.getMigrationAddress())) {"], [384, "                logger.log(Level.WARNING, blockReal + \". Already migrating blockInfo is migrating again to \" + blockInfo);"], [385, "            } else {"], [386, "                logger.log(Level.WARNING, blockInfo + \" migration unknown \" + blockReal);"], [390, "        blockReal.setOwner(blockInfo.getOwner());"], [391, "        blockReal.setMigrationAddress(blockInfo.getMigrationAddress());"], [392, "        logger.log(Level.FINEST, \"migrate blockInfo \" + blockInfo);"], [399, "        blockMigrating = blockInfo;"], [413, "                    if (rec.getBlockId() == blockInfo.getBlockId()) {"], [436, "                    logger.log(Level.FINEST, \"migrate blockInfo \" + blockInfo + \" await \");"], [440, "                            Block blockReal = blocks[blockInfo.getBlockId()];"], [441, "                            logger.log(Level.FINEST, \"migrate completing [\" + blockInfo + \"] realBlock \" + blockReal);"], [444, "                            logger.log(Level.FINEST, \"migrate complete [\" + blockInfo.getMigrationAddress() + \"] now realBlock \" + blockReal);"], [447, "                                    concurrentMapManager.sendBlockInfo(new Block(blockReal), member.getAddress());"]], "deleted": [[195, "                    migrateBlock(block);"], [239, "                        ConcurrentMapManager.Blocks allBlocks = new ConcurrentMapManager.Blocks();"], [241, "                            allBlocks.addBlock(block);"], [243, "                        dataAllBlocks = ThreadContext.get().toData(allBlocks);"], [368, "    void migrateBlock(final Block block) {"], [369, "        if (!concurrentMapManager.isBlockInfoValid(block)) {"], [372, "        if (!thisAddress.equals(block.getOwner())) {"], [375, "        if (block.getMigrationAddress() == null) {"], [378, "        if (block.getOwner().equals(block.getMigrationAddress())) {"], [381, "        Block blockReal = blocks[block.getBlockId()];"], [383, "            if (!block.getOwner().equals(blockReal.getOwner()) || !block.getMigrationAddress().equals(blockReal.getMigrationAddress())) {"], [384, "                logger.log(Level.WARNING, blockReal + \". Already migrating block is migrating again to \" + block);"], [388, "        blockReal.setOwner(block.getOwner());"], [389, "        blockReal.setMigrationAddress(block.getMigrationAddress());"], [390, "        logger.log(Level.FINEST, \"migrate block \" + block);"], [397, "        blockMigrating = block;"], [411, "                    if (rec.getBlockId() == block.getBlockId()) {"], [434, "                    logger.log(Level.FINEST, \"migrate block \" + block + \" await \");"], [438, "                            Block blockReal = blocks[block.getBlockId()];"], [439, "                            logger.log(Level.FINEST, \"migrate completing [\" + block+ \"] realBlock \" + blockReal);"], [442, "                            logger.log(Level.FINEST, \"migrate complete [\" + block.getMigrationAddress() + \"] now realBlock \" + blockReal);"], [445, "                                    concurrentMapManager.sendBlockInfo(blockReal, member.getAddress());"]]}, "num_lines_added": 24, "num_lines_removed": 22}