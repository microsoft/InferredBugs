{"hash": "6deb198e2cc6137bd38cf2d1962793bb018d5033", "message": "Fix #526", "file_num_lines": 794, "diff_parsed": {"added": [[159, "        json.put(\"increaseTerm\", false);"], [161, "        onPublish(datum, peers.local(), false);"], [193, "    public static void doSignalPublish(String key, String value, boolean locked) throws Exception {"], [198, "            params.put(\"locked\", locked);"], [211, "        if (locked) {"], [235, "            json.put(\"increaseTerm\", true);"], [237, "            onPublish(datum, peers.local(), true);"], [325, "    public static void onPublish(JSONObject json, boolean increaseTerm) throws Exception {"], [328, "        onPublish(datum, source, increaseTerm);"], [331, "    public static void onPublish(Datum datum, RaftPeer source, boolean increaseTerm) throws Exception {"], [370, "        if (increaseTerm) {"]], "deleted": [[142, "    /**"], [143, "     * will return success once local writes success instead of the majority,"], [144, "     * therefore is unsafe"], [145, "     *"], [146, "     * @param key"], [147, "     * @param value"], [148, "     * @throws Exception"], [149, "     */"], [150, "    public static void unsafePublish(String key, String value) throws Exception {"], [151, "        OPERATE_LOCK.lock();"], [152, ""], [153, "        try {"], [154, "            if (!RaftCore.isLeader()) {"], [155, "                JSONObject params = new JSONObject();"], [156, "                params.put(\"key\", key);"], [157, "                params.put(\"value\", value);"], [158, ""], [159, "                Map<String, String> parameters = new HashMap<>(1);"], [160, "                parameters.put(\"key\", key);"], [161, "                RaftProxy.proxyPostLarge(API_UNSF_PUB, params.toJSONString(), parameters);"], [162, ""], [163, "                if (!RaftCore.isLeader()) {"], [164, "                    throw new IllegalStateException(\"I'm not leader, can not handle update/delete operation\");"], [165, "                }"], [166, "            }"], [167, ""], [168, "            Datum datum = new Datum();"], [169, "            datum.key = key;"], [170, "            datum.value = value;"], [171, "            datum.timestamp.set(RaftCore.getDatum(key).timestamp.incrementAndGet());"], [172, ""], [173, "            RaftPeer local = peers.local();"], [174, ""], [175, "            onPublish(datum, local);"], [176, "        } finally {"], [177, "            OPERATE_LOCK.unlock();"], [178, "        }"], [179, "    }"], [198, "        onPublish(datum, peers.local());"], [230, "    public static void doSignalPublish(String key, String value) throws Exception {"], [247, "        if (key.startsWith(UtilsAndCommons.DOMAINS_DATA_ID)) {"], [272, "            onPublish(datum, peers.local());"], [360, "    public static void onPublish(JSONObject json) throws Exception {"], [363, "        onPublish(datum, source);"], [366, "    public static void onPublish(Datum datum, RaftPeer source) throws Exception {"], [405, "        if (datum.key.startsWith(UtilsAndCommons.DOMAINS_DATA_ID)) {"]]}, "num_lines_added": 11, "num_lines_removed": 46}