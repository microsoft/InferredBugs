{"hash": "f3bda7e2f4c831db5b163de38c63e782561807e9", "message": "\u57fa\u91d1\u6301\u80a1", "file_num_lines": 113, "diff_parsed": {"added": [[6, "import com.mongodb.client.result.UpdateResult;"], [24, "import org.springframework.data.mongodb.core.query.Update;"], [55, "        Integer dateNumber = Integer.valueOf(TradingDateUtil.minusDate(0, 0, 4, \"yyyyMMdd\"));"], [81, "        this.pageUrl = String.format(\"https://stock.xueqiu.com/v5/stock/f10/cn/org_holding/detail.json?symbol=%s&extend=true\", fcode);"], [107, "        if(json.getJSONObject(\"data\").containsKey(\"chg_date\")) {"], [108, "            String report = json.getJSONObject(\"data\").getString(\"chg_date\");"], [109, "            JSONArray founds = json.getJSONObject(\"data\").getJSONArray(\"fund_items\");"], [110, "            List<StockFundHolder> rows = new ArrayList<>();"], [111, "            for (int i = 1; i < founds.size(); i++) {"], [112, "                rows.add(new StockFundHolder("], [113, "                        currentCodeInfo.getCode(), report,"], [114, "                        founds.getJSONObject(i).getString(\"org_name_or_fund_name\"),"], [115, "                        founds.getJSONObject(i).getDouble(\"to_float_shares_ratio\"),"], [116, "                        founds.getJSONObject(i).getDouble(\"held_num\")"], [117, "                ));"], [118, "            }"], [119, "            MyMongoTemplate myMongoTemplate = SpringContextUtil.getBean(MyMongoTemplate.class);"], [120, "            long dels = myMongoTemplate.remove(StockFundHolder.class, Criteria.where(\"code\").is(currentCodeInfo.getCode()));"], [121, "            log.info(\"delete StockFundHolder {}\", dels);"], [122, "            int addnum = myMongoTemplate.save(rows, StockFundHolder.class).getInsertedCount();"], [123, "            log.info(\"add StockFundHolder {}\", addnum);"], [124, "        }else{"], [125, "            log.error(\"{}\u65e0\u57fa\u91d1\u6301\u80a1\u6570\u636e!\",currentCodeInfo.getCode());"], [127, "        UpdateResult updateResult= getMongoTemp().upsert("], [128, "                new Query(Criteria.where(\"_id\").is(currentCodeInfo.getCode())),"], [129, "                new Update().set(\"fundHolderDate\",Integer.valueOf(TradingDateUtil.getDateYYYYMMdd())),\"stock_code_info\");"], [130, "        log.info(JSON.toJSONString(updateResult));"]], "deleted": [[53, "        Integer dateNumber = Integer.valueOf(TradingDateUtil.minusDate(0, 0, 3, \"yyyyMMdd\"));"], [79, "        this.pageUrl = String.format(\"https://stock.xueqiu.com/v5/stock/quote.json?symbol=%s&extend=detail\", fcode);"], [105, "        String report = json.getJSONObject(\"data\").getString(\"chg_date\");"], [106, "        JSONArray founds = json.getJSONObject(\"data\").getJSONArray(\"fund_items\");"], [107, "        List<StockFundHolder> rows = new ArrayList<>();"], [108, "        for (int i = 1; i < founds.size(); i++) {"], [109, "            rows.add(new StockFundHolder("], [110, "                    currentCodeInfo.getCode(), report,"], [111, "                    founds.getJSONObject(i).getString(\"org_name_or_fund_name\"),"], [112, "                    founds.getJSONObject(i).getDouble(\"to_float_shares_ratio\"),"], [113, "                    founds.getJSONObject(i).getDouble(\"held_num\")"], [114, "            ));"], [116, "        MyMongoTemplate myMongoTemplate = SpringContextUtil.getBean(MyMongoTemplate.class);"], [117, "        long dels = myMongoTemplate.remove(StockFundHolder.class, Criteria.where(\"code\").is(currentCodeInfo.getCode()));"], [118, "        log.info(\"delete StockFundHolder {}\", dels);"], [119, "        int addnum = myMongoTemplate.save(rows, StockFundHolder.class).getInsertedCount();"], [120, "        log.info(\"add StockFundHolder {}\", addnum);"]]}, "num_lines_added": 27, "num_lines_removed": 17}