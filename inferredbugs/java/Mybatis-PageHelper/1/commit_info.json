{"hash": "3854d61eaeec918a644cab0bdc54d7db745a0552", "message": "\u66f4\u65b0\u5904\u7406\u81ea\u52a8\u9009\u62e9\u65b9\u8a00\u7f13\u5b58\u65b9\u5f0f\u3002", "file_num_lines": 202, "diff_parsed": {"added": [[56, "    //\u81ea\u52a8\u83b7\u53d6dialect,\u5982\u679c\u6ca1\u6709setProperties\u6216setSqlUtilConfig\uff0c\u4e5f\u53ef\u4ee5\u6b63\u5e38\u8fdb\u884c"], [57, "    private boolean autoDialect = true;"], [61, "    private Map<DataSource, SqlUtil> dataSourceSqlUtilMap = new ConcurrentHashMap<DataSource, SqlUtil>();"], [244, "            SqlUtil sqlUtil = getSqlUtil(invocation);"], [245, "            return sqlUtil.processPage(invocation);"], [250, "            return sqlUtil.processPage(invocation);"], [276, "        MappedStatement ms = (MappedStatement) invocation.getArgs()[0];"], [277, "        //\u6539\u4e3a\u5bf9dataSource\u505a\u7f13\u5b58"], [278, "        DataSource dataSource = ms.getConfiguration().getEnvironment().getDataSource();"], [279, "        if (dataSourceSqlUtilMap.containsKey(dataSource)) {"], [280, "            return dataSourceSqlUtilMap.get(dataSource);"], [285, "            if (dataSourceSqlUtilMap.containsKey(dataSource)) {"], [286, "                return dataSourceSqlUtilMap.get(dataSource);"], [288, "            String url = dataSource.getConnection().getMetaData().getURL();"], [289, "            if (StringUtil.isEmpty(url)) {"], [290, "                throw new RuntimeException(\"\u65e0\u6cd5\u81ea\u52a8\u83b7\u53d6jdbcUrl\uff0c\u8bf7\u5728\u5206\u9875\u63d2\u4ef6\u4e2d\u914d\u7f6edialect\u53c2\u6570!\");"], [291, "            }"], [292, "            String dialect = Dialect.fromJdbcUrl(url);"], [293, "            if (dialect == null) {"], [294, "                throw new RuntimeException(\"\u65e0\u6cd5\u81ea\u52a8\u83b7\u53d6\u6570\u636e\u5e93\u7c7b\u578b\uff0c\u8bf7\u901a\u8fc7dialect\u53c2\u6570\u6307\u5b9a!\");"], [295, "            }"], [296, "            SqlUtil sqlUtil = new SqlUtil(dialect);"], [302, "            dataSourceSqlUtilMap.put(dataSource, sqlUtil);"], [303, "            return sqlUtil;"], [304, "        } catch (SQLException e) {"], [305, "            throw new RuntimeException(e);"]], "deleted": [[56, "    //\u81ea\u52a8\u83b7\u53d6dialect"], [57, "    private boolean autoDialect;"], [61, "    private Map<String, SqlUtil> dialectSqlUtilMap = new ConcurrentHashMap<String, SqlUtil>();"], [243, "        SqlUtil sqlUtil;"], [245, "            sqlUtil = getSqlUtil(invocation);"], [250, "            sqlUtil = this.sqlUtil;"], [252, "        return sqlUtil.processPage(invocation);"], [277, "        String url;"], [278, "        try {"], [279, "            MappedStatement ms = (MappedStatement) invocation.getArgs()[0];"], [280, "            //TODO \u8fd9\u91cc\u80fd\u5426\u5bf9dataSource\u548cdialect\u505a\u6620\u5c04\uff0c\u6216\u8005\u80fd\u5426\u786e\u5b9a\u6240\u6709\u7684DataSource\u90fd\u6709url\u5c5e\u6027?"], [281, "            DataSource dataSource = ms.getConfiguration().getEnvironment().getDataSource();"], [282, "            url = dataSource.getConnection().getMetaData().getURL();"], [283, "        } catch (SQLException e) {"], [284, "            throw new RuntimeException(\"\u5206\u9875\u63d2\u4ef6\u521d\u59cb\u5316\u5f02\u5e38:\" + e.getMessage());"], [285, "        }"], [286, "        if (StringUtil.isEmpty(url)) {"], [287, "            throw new RuntimeException(\"\u65e0\u6cd5\u81ea\u52a8\u83b7\u53d6jdbcUrl\uff0c\u8bf7\u5728\u5206\u9875\u63d2\u4ef6\u4e2d\u914d\u7f6edialect\u53c2\u6570!\");"], [288, "        }"], [289, "        String dialect = Dialect.fromJdbcUrl(url);"], [290, "        if (dialect == null) {"], [291, "            throw new RuntimeException(\"\u65e0\u6cd5\u81ea\u52a8\u83b7\u53d6\u6570\u636e\u5e93\u7c7b\u578b\uff0c\u8bf7\u901a\u8fc7dialect\u53c2\u6570\u6307\u5b9a!\");"], [292, "        }"], [293, "        if (dialectSqlUtilMap.containsKey(dialect)) {"], [294, "            return dialectSqlUtilMap.get(dialect);"], [297, "        SqlUtil sqlUtil = null;"], [300, "            if (dialectSqlUtilMap.containsKey(dialect)) {"], [301, "                return dialectSqlUtilMap.get(dialect);"], [303, "            sqlUtil = new SqlUtil(dialect);"], [309, "            dialectSqlUtilMap.put(dialect, sqlUtil);"], [313, "        return sqlUtil;"]]}, "num_lines_added": 26, "num_lines_removed": 31}