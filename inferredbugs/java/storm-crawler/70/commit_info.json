{"hash": "399cdac2125c39ef9be26586a2ca2609f92b0988", "message": "CharsetIdentification crashes on binary content,fixes #747", "file_num_lines": 139, "diff_parsed": {"added": [[89, "        try (BOMInputStream bomIn = new BOMInputStream("], [90, "                new ByteArrayInputStream(byteData))) {"], [145, ""], [146, "        try {"], [147, "            Document doc = Parser.htmlParser().parseInput(html, \"dummy\");"], [148, ""], [149, "            // look for <meta http-equiv=\"Content-Type\""], [150, "            // content=\"text/html;charset=gb2312\"> or HTML5 <meta"], [151, "            // charset=\"gb2312\">"], [152, "            Elements metaElements = doc"], [153, "                    .select(\"meta[http-equiv=content-type], meta[charset]\");"], [154, "            for (Element meta : metaElements) {"], [155, "                if (meta.hasAttr(\"http-equiv\"))"], [156, "                    foundCharset = getCharsetFromContentType(meta"], [157, "                            .attr(\"content\"));"], [158, "                if (foundCharset == null && meta.hasAttr(\"charset\"))"], [159, "                    foundCharset = meta.attr(\"charset\");"], [160, "                if (foundCharset != null)"], [161, "                    return foundCharset;"], [162, "            }"], [163, "        } catch (Exception e) {"], [164, "            foundCharset = null;"]], "deleted": [[89, "        BOMInputStream bomIn = new BOMInputStream(new ByteArrayInputStream("], [90, "                byteData));"], [91, "        try {"], [145, "        Document doc = Parser.htmlParser().parseInput(html, \"dummy\");"], [146, ""], [147, "        // look for <meta http-equiv=\"Content-Type\""], [148, "        // content=\"text/html;charset=gb2312\"> or HTML5 <meta charset=\"gb2312\">"], [149, "        Elements metaElements = doc"], [150, "                .select(\"meta[http-equiv=content-type], meta[charset]\");"], [152, "        for (Element meta : metaElements) {"], [153, "            if (meta.hasAttr(\"http-equiv\"))"], [154, "                foundCharset = getCharsetFromContentType(meta.attr(\"content\"));"], [155, "            if (foundCharset == null && meta.hasAttr(\"charset\"))"], [156, "                foundCharset = meta.attr(\"charset\");"], [157, "            if (foundCharset != null)"], [158, "                return foundCharset;"]]}, "num_lines_added": 22, "num_lines_removed": 16}