{"hash": "f9668a0dc39aa71251d61d5174e02a4d15219302", "message": "LangId normalises and returns value found via extraction, fixes #733", "file_num_lines": 86, "diff_parsed": {"added": [[22, "import java.util.Locale;"], [28, "import com.digitalpebble.stormcrawler.Metadata;"], [48, " * \"name\": \"LanguageID\", \"params\": { \"key\": \"lang\" , \"minProb\": 0.99 ,"], [49, " * \"extracted\": \"parse.lang\"} } ```"], [51, " * in the parse filter config. Any value found in the metadata under the key"], [52, " * specified by _extracted_ will be normalised and stored in the metadata,"], [53, " * otherwise the languages above the probability will be used."], [65, "    private String extractedKeyName = \"parse.lang\";"], [92, "        node = filterParams.get(\"extracted\");"], [94, "            extractedKeyName = node.asText(\"parse.lang\");"], [103, "        // in which case we normalise its value and use it"], [104, "        Metadata m = parse.get(url).getMetadata();"], [105, "        String extractedValue = m.getFirstValue(extractedKeyName);"], [106, "        if (StringUtils.isNotBlank(extractedValue) && extractedValue.length() > 1) {"], [107, "            extractedValue = extractedValue.substring(0, 2).toLowerCase("], [108, "                    Locale.ENGLISH);"], [109, "            LOG.info(\"Lang: {} extracted from page for {}\", extractedValue, url);"], [110, "            m.setValue(mdKey, extractedValue);"], [111, "            return;"]], "deleted": [[46, " * \"name\": \"LanguageID\", \"params\": { \"key\": \"lang\" , \"minProb\": 0.99} }"], [48, " * in the parse filter config. ```"], [60, "    private String mdSkip = null;"], [87, "        node = filterParams.get(\"md.skip\");"], [89, "            mdSkip = node.asText();"], [98, "        // in which case we might want to skip"], [99, "        if (mdSkip != null) {"], [100, "            String existingVal = parse.get(url).getMetadata()"], [101, "                    .getFirstValue(mdSkip);"], [102, "            if (StringUtils.isNotBlank(existingVal)) {"], [103, "                return;"], [104, "            }"]]}, "num_lines_added": 19, "num_lines_removed": 12}