{"hash": "74d4740c41283895b24df089676071385066d065", "message": "spout.reset.fetchdate.after based on time when query was set to NOW,fixes #648", "file_num_lines": 174, "diff_parsed": {"added": [[22, "import java.time.Instant;"], [84, "        if (queryDate == null) {"], [85, "            queryDate = new Date();"], [86, "            lastTimeResetToNOW = Instant.now();"], [96, "                queryDate.getTime());"], [213, "        // reset the value for next fetch date if the previous one is too old"], [214, "        if (resetFetchDateAfterNSecs != -1) {"], [215, "            Instant changeNeededOn = Instant.ofEpochMilli(lastTimeResetToNOW"], [216, "                    .toEpochMilli() + (resetFetchDateAfterNSecs * 1000));"], [217, "            if (Instant.now().isAfter(changeNeededOn)) {"], [218, "                LOG.info(\"lastDate reset based on resetFetchDateAfterNSecs {}\","], [219, "                        resetFetchDateAfterNSecs);"], [220, "                queryDate = null;"], [221, "                lastStartOffset = 0;"], [222, "            }"], [223, "        }"], [224, ""], [227, "            queryDate = null;"]], "deleted": [[22, "import java.util.Calendar;"], [84, "        if (lastDate == null) {"], [85, "            lastDate = new Date();"], [95, "                lastDate.getTime());"], [171, "        // reset the value for next fetch date if the previous one is too old"], [172, "        if (resetFetchDateAfterNSecs != -1) {"], [173, "            Calendar diffCal = Calendar.getInstance();"], [174, "            diffCal.setTime(lastDate);"], [175, "            diffCal.add(Calendar.SECOND, resetFetchDateAfterNSecs);"], [176, "            // compare to now"], [177, "            if (diffCal.before(Calendar.getInstance())) {"], [178, "                LOG.info("], [179, "                        \"{} lastDate set to null based on resetFetchDateAfterNSecs {}\","], [180, "                        logIdprefix, resetFetchDateAfterNSecs);"], [181, "                lastDate = null;"], [182, "                lastStartOffset = 0;"], [183, "            }"], [184, "        }"], [185, ""], [229, "            lastDate = null;"]]}, "num_lines_added": 18, "num_lines_removed": 20}