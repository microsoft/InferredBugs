{"hash": "8343a1110c9796214336e25d1dbb9c9661b5e973", "message": "CAP file can now also be URL.\n\ngit-svn-id: https://gpj.svn.sourceforge.net/svnroot/gpj/gpj@15 d4cd07e3-b52b-4d75-8224-5724e8189783", "file_num_lines": 255, "diff_parsed": {"added": [[33, "import java.util.Iterator;"], [35, "import java.util.Map;"], [37, "import java.util.zip.ZipInputStream;"], [59, "    public CapFile(InputStream in) throws IOException {"], [60, "        this(in, null);"], [63, "    public CapFile(InputStream in, String packageName) throws IOException {"], [64, "        ZipInputStream zip = new ZipInputStream(in);"], [65, "        Map<String, byte[]> entries = getEntries(zip);"], [69, "            Iterator<? extends String> it = entries.keySet().iterator();"], [71, "            while (it.hasNext()) {"], [72, "                String s = it.next();"], [85, "            byte[] contents = entries.get(fullName);"], [86, "            capComponents.put(name, contents);"], [98, "                byte[] contents = entries.get(fullName);"], [99, "                if(contents == null) break;"], [145, "    private Map<String,byte[]> getEntries(ZipInputStream in) throws IOException {"], [146, "        Map<String,byte[]> result = new HashMap<String, byte[]>();"], [147, "        while(true) {"], [148, "            ZipEntry entry = in.getNextEntry();"], [149, "            if(entry == null) {"], [150, "                break;"], [151, "            }"], [152, "            byte[] contents = new byte[(int)entry.getSize()];"], [153, "            for(int i = 0; i<contents.length; i++) {"], [154, "                contents[i] = (byte)in.read();"], [155, "            }"], [156, "            result.put(entry.getName(),contents);"], [157, "        }"], [158, "        return result;"], [159, "    }"], [160, ""], [240, "                blocks = splitArray(currentComponent, blockSize);"]], "deleted": [[32, "import java.util.Enumeration;"], [36, "import java.util.zip.ZipFile;"], [58, "    public CapFile(String fileName) throws IOException {"], [59, "        this(fileName, null);"], [62, "    public CapFile(String fileName, String packageName) throws IOException {"], [63, "        ZipFile zip = new ZipFile(fileName);"], [67, "            Enumeration<? extends ZipEntry> e = zip.entries();"], [69, "            while (e.hasMoreElements()) {"], [70, "                String s = e.nextElement().getName();"], [83, "            ZipEntry z = zip.getEntry(fullName);"], [84, "            if (z != null) {"], [85, "                int size = (int) z.getSize();"], [86, "                InputStream i = zip.getInputStream(z);"], [87, "                byte[] contents = new byte[size];"], [88, "                int index = 0;"], [89, "                int ch = i.read();"], [90, "                while (ch != -1) {"], [91, "                    contents[index++] = (byte) ch;"], [92, "                    ch = i.read();"], [93, "                }"], [94, "                capComponents.put(name, contents);"], [95, "            }"], [107, "                ZipEntry z = zip.getEntry(fullName);"], [108, "                if (z == null)"], [109, "                    break;"], [110, "                byte[] contents = new byte[(int) z.getSize()];"], [111, "                zip.getInputStream(z).read(contents);"], [236, "                blocks.addAll(splitArray(currentComponent, blockSize));"]]}, "num_lines_added": 32, "num_lines_removed": 28}