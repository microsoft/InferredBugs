{"hash": "52398872926c8c125f862172567bca7756ea6696", "message": "vjtop\u7684\u5185\u5b58\u4f7f\u7528\u4fe1\u606f\uff0c\u5206\u5f00\u663e\u793acommitted \u548c max #87", "file_num_lines": 310, "diff_parsed": {"added": [[4, "import java.lang.management.BufferPoolMXBean;"], [91, "\tpublic Usage eden;"], [92, "\tpublic Usage sur;"], [93, "\tpublic Usage old;"], [94, ""], [95, "\tpublic Usage perm;"], [96, "\tpublic Usage codeCache;"], [97, "\tpublic Usage ccs;"], [98, ""], [99, "\tpublic Usage direct;"], [100, "\tpublic Usage map;"], [101, ""], [160, "\t\tif (perfDataSupport) {"], [161, "\t\t\tvmArgs = (String) perfData.findCounter(\"java.rt.vmArgs\").getValue();"], [162, "\t\t} else {"], [163, "\t\t\tvmArgs = Utils.join(jmxClient.getRuntimeMXBean().getInputArguments(), \" \");"], [164, "\t\t}"], [171, "\t\tpermGenName = jvmMajorVersion >= 8 ? \"metaspace\" : \"perm\";"], [274, "\t\teden = new Usage(memoryPoolManager.getEdenMemoryPool().getUsage());"], [277, "\t\told = new Usage(memoryPoolManager.getOldMemoryPool().getUsage());"], [282, "\t\t\tsur = new Usage(survivorMemoryPool.getUsage());"], [283, "\t\t} else {"], [284, "\t\t\tsur = new Usage();"], [288, "\t\tperm = new Usage(memoryPoolManager.getPermMemoryPool().getUsage());"], [294, "\t\t\t\tccs = new Usage(compressedClassSpaceMemoryPool.getUsage());"], [299, "\t\tcodeCache = new Usage(memoryPoolManager.getCodeCacheMemoryPool().getUsage());"], [302, "\t\tdirect = new Usage(jmxClient.getBufferPoolManager().getDirectBufferPool());"], [305, "\t\tmap = new Usage(jmxClient.getBufferPoolManager().getMappedBufferPool());"], [393, ""], [394, "\tpublic class Usage {"], [395, "\t\tpublic long used = -1;"], [396, "\t\tpublic long committed = -1;"], [397, "\t\tpublic long max = -1;"], [398, ""], [399, "\t\tpublic Usage() {"], [400, ""], [401, "\t\t}"], [402, ""], [403, "\t\tpublic Usage(MemoryUsage jmxUsage) {"], [404, "\t\t\tthis.used = jmxUsage.getUsed();"], [405, "\t\t\tthis.committed = jmxUsage.getCommitted();"], [406, "\t\t\tthis.max = jmxUsage.getMax();"], [407, "\t\t}"], [408, ""], [409, "\t\tpublic Usage(BufferPoolMXBean bufferPoolUsage) {"], [410, "\t\t\tthis.used = bufferPoolUsage.getMemoryUsed();"], [411, "\t\t\tthis.max = bufferPoolUsage.getTotalCapacity();"], [412, "\t\t}"], [413, "\t}"]], "deleted": [[90, "\tpublic long edenUsedBytes;"], [91, "\tpublic long edenMaxBytes;"], [92, "\tpublic long surUsedBytes;"], [93, "\tpublic long surMaxBytes;"], [94, "\tpublic long oldUsedBytes;"], [95, "\tpublic long oldMaxBytes;"], [96, "\tpublic long permUsedBytes;"], [97, "\tpublic long permMaxBytes;"], [98, "\tpublic long codeCacheUsedBytes;"], [99, "\tpublic long codeCacheMaxBytes;"], [100, "\tpublic long ccsUsedBytes;"], [101, "\tpublic long ccsMaxBytes;"], [102, ""], [103, "\tpublic long directUsedBytes;"], [104, "\tpublic long directMaxBytes;"], [105, "\tpublic long mapUsedBytes;"], [106, "\tpublic long mapMaxBytes;"], [165, "\t\tvmArgs = Utils.join(jmxClient.getRuntimeMXBean().getInputArguments(), \" \");"], [172, "\t\tpermGenName = jmxClient.getMemoryPoolManager().getPermMemoryPool().getName().toLowerCase();"], [275, "\t\tedenUsedBytes = memoryPoolManager.getEdenMemoryPool().getUsage().getUsed();"], [276, "\t\tedenMaxBytes = getMemoryPoolMaxOrCommited(memoryPoolManager.getEdenMemoryPool());"], [279, "\t\toldUsedBytes = memoryPoolManager.getOldMemoryPool().getUsage().getUsed();"], [280, "\t\toldMaxBytes = getMemoryPoolMaxOrCommited(memoryPoolManager.getOldMemoryPool());"], [285, "\t\t\tsurUsedBytes = survivorMemoryPool.getUsage().getUsed();"], [286, "\t\t\tsurMaxBytes = getMemoryPoolMaxOrCommited(survivorMemoryPool);"], [290, "\t\tpermUsedBytes = memoryPoolManager.getPermMemoryPool().getUsage().getUsed();"], [291, "\t\tpermMaxBytes = getMemoryPoolMaxOrCommited(memoryPoolManager.getPermMemoryPool());"], [297, "\t\t\t\tccsUsedBytes = compressedClassSpaceMemoryPool.getUsage().getUsed();"], [298, "\t\t\t\tccsMaxBytes = getMemoryPoolMaxOrCommited(compressedClassSpaceMemoryPool);"], [303, "\t\tcodeCacheUsedBytes = memoryPoolManager.getCodeCacheMemoryPool().getUsage().getUsed();"], [304, "\t\tcodeCacheMaxBytes = getMemoryPoolMaxOrCommited(memoryPoolManager.getCodeCacheMemoryPool());"], [307, "\t\tdirectUsedBytes = jmxClient.getBufferPoolManager().getDirectBufferPool().getMemoryUsed();"], [308, "\t\tdirectMaxBytes = jmxClient.getBufferPoolManager().getDirectBufferPool().getTotalCapacity();"], [311, "\t\tmapUsedBytes = jmxClient.getBufferPoolManager().getMappedBufferPool().getMemoryUsed();"], [312, "\t\tmapMaxBytes = jmxClient.getBufferPoolManager().getMappedBufferPool().getTotalCapacity();"], [384, "\tprivate long getMemoryPoolMaxOrCommited(MemoryPoolMXBean memoryPool) {"], [385, "\t\tMemoryUsage usage = memoryPool.getUsage();"], [386, "\t\tlong max = usage.getMax();"], [387, "\t\tmax = max < 0 ? usage.getCommitted() : max;"], [388, "\t\treturn max;"], [389, "\t}"]]}, "num_lines_added": 49, "num_lines_removed": 41}