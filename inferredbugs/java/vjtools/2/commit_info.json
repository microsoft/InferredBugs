{"hash": "d29c2ffa5dd1b0c32325ccabcedfe6a66896a468", "message": "#21 \u91cd\u6784\u4ee3\u7801\uff0c\u4f18\u5316\u4ea4\u4e92\u4f53\u9a8c\uff0c", "file_num_lines": 90, "diff_parsed": {"added": [[4, "import java.io.IOException;"], [6, "import java.io.PrintStream;"], [10, "/**"], [11, " * \u4e0e\u7528\u6237\u4ea4\u4e92\u52a8\u6001\u7684\u63a7\u5236\u5668"], [12, " */"], [13, "public class InteractiveTask implements Runnable {"], [14, "\tprivate VJTop app;"], [15, "\tprivate BufferedReader reader;"], [16, "\tprivate PrintStream tty;"], [18, "\tpublic InteractiveTask(VJTop app) {"], [19, "\t\tthis.app = app;"], [20, "\t\treader = new BufferedReader(new InputStreamReader(System.in));"], [21, "\t\ttty = System.err;"], [27, "\t\t\t\tString command = reader.readLine().trim().toLowerCase();"], [29, "\t\t\t\t\tprintStacktrace();"], [31, "\t\t\t\t\tchangeDisplayMode();"], [33, "\t\t\t\t\tapp.exit();"], [35, "\t\t\t\t} else if (command.equalsIgnoreCase(\"h\") || command.equalsIgnoreCase(\"help\")) {"], [36, "\t\t\t\t\tprintHelp();"], [39, "\t\t\t\t\ttty.println(\"Unkown command: \" + command);"], [40, "\t\t\t\t\tprintHelp();"], [43, "\t\t\t\ttty.print(\" Input command (h for help):\");"], [45, "\t\t\t\te.printStackTrace(tty);"], [49, ""], [50, "\tprivate void printStacktrace() throws IOException {"], [51, "\t\tapp.needMoreInput = true;"], [52, "\t\ttty.print(\" Input TID for stack:\");"], [53, "\t\tString pidStr = reader.readLine();"], [54, "\t\ttry {"], [55, "\t\t\tlong pid = Long.parseLong(pidStr);"], [56, "\t\t\tapp.view.printStack(pid);"], [57, "\t\t} catch (NumberFormatException e) {"], [58, "\t\t\ttty.println(\" Wrong number format for pid\");"], [59, "\t\t} finally {"], [60, "\t\t\tapp.needMoreInput = false;"], [61, "\t\t}"], [62, "\t}"], [63, ""], [64, "\tprivate void changeDisplayMode() throws IOException {"], [65, "\t\tapp.needMoreInput = true;"], [66, "\t\ttty.print("], [67, "\t\t\t\t\" Input number of Display Mode(1.cpu, 2.syscpu 3.total cpu 4.total syscpu 5.memory 6.total memory): \");"], [68, "\t\tString mode = reader.readLine().trim().toLowerCase();"], [69, "\t\tswitch (mode) {"], [70, "\t\t\tcase \"1\":"], [71, "\t\t\t\tapp.view.mode = DetailMode.cpu;"], [72, "\t\t\t\tbreak;"], [73, "\t\t\tcase \"2\":"], [74, "\t\t\t\tapp.view.mode = DetailMode.syscpu;"], [75, "\t\t\t\tbreak;"], [76, "\t\t\tcase \"3\":"], [77, "\t\t\t\tapp.view.mode = DetailMode.totalcpu;"], [78, "\t\t\t\tbreak;"], [79, "\t\t\tcase \"4\":"], [80, "\t\t\t\tapp.view.mode = DetailMode.totalsyscpu;"], [81, "\t\t\t\tbreak;"], [82, "\t\t\tcase \"5\":"], [83, "\t\t\t\tapp.view.mode = DetailMode.memory;"], [84, "\t\t\t\tbreak;"], [85, "\t\t\tcase \"6\":"], [86, "\t\t\t\tapp.view.mode = DetailMode.totalmemory;"], [87, "\t\t\t\tbreak;"], [88, "\t\t\tdefault:"], [89, "\t\t\t\tSystem.err.println(\" Wrong option for display mode(1-6)\");"], [90, "\t\t\t\tbreak;"], [91, "\t\t}"], [92, "\t\ttty.println(\" Display mode changed to \" + app.view.mode + \" for next flush\");"], [93, "\t\tapp.needMoreInput = false;"], [94, "\t}"], [95, ""], [96, "\tprivate void printHelp() {"], [97, "\t\ttty.println(\" t : print stack trace for the thread you choose\");"], [98, "\t\ttty.println(\" d : change threads display mode and ordering\");"], [99, "\t\ttty.println(\" q : quit\");"], [100, "\t\ttty.println(\" h : print help\");"], [101, "\t}"]], "deleted": [[8, "final class InteractiveTask implements Runnable {"], [9, "\tprivate VMDetailView view;"], [10, "\tprivate VJTop vjtop;"], [11, "\tprivate Thread mainThread;"], [13, "\tpublic InteractiveTask(VMDetailView view, VJTop vjtop, Thread mainThread) {"], [14, "\t\tthis.view = view;"], [15, "\t\tthis.vjtop = vjtop;"], [16, "\t\tthis.mainThread = mainThread;"], [22, "\t\t\t\tString command = new BufferedReader(new InputStreamReader(System.in)).readLine().trim();"], [24, "\t\t\t\t\tvjtop.setNeedForFurtherInput(true);"], [25, "\t\t\t\t\tSystem.err.print(\" Input TID for stack:\");"], [26, "\t\t\t\t\tString pidStr = new BufferedReader(new InputStreamReader(System.in)).readLine();"], [27, "\t\t\t\t\ttry {"], [28, "\t\t\t\t\t\tlong pid = Long.parseLong(pidStr);"], [29, "\t\t\t\t\t\tview.printStack(pid);"], [30, "\t\t\t\t\t} catch (NumberFormatException e) {"], [31, "\t\t\t\t\t\tSystem.err.println(\" Wrong number format\");"], [32, "\t\t\t\t\t}"], [33, "\t\t\t\t\t//block the flush to let user see the result"], [34, "\t\t\t\t\tUtils.sleep(10000);"], [35, "\t\t\t\t\tvjtop.setNeedForFurtherInput(false);"], [37, "\t\t\t\t\tvjtop.setNeedForFurtherInput(true);"], [38, "\t\t\t\t\tSystem.err.print("], [39, "\t\t\t\t\t\t\t\" Input number of Display Mode(1.cpu, 2.syscpu 3.total cpu 4.total syscpu 5.memory 6.total memory): \");"], [40, "\t\t\t\t\tString mode = new BufferedReader(new InputStreamReader(System.in)).readLine();"], [41, "\t\t\t\t\tswitch (mode) {"], [42, "\t\t\t\t\t\tcase \"1\":"], [43, "\t\t\t\t\t\t\tview.setMode(DetailMode.cpu);"], [44, "\t\t\t\t\t\t\tbreak;"], [45, "\t\t\t\t\t\tcase \"2\":"], [46, "\t\t\t\t\t\t\tview.setMode(DetailMode.syscpu);"], [47, "\t\t\t\t\t\t\tbreak;"], [48, "\t\t\t\t\t\tcase \"3\":"], [49, "\t\t\t\t\t\t\tview.setMode(DetailMode.totalcpu);"], [50, "\t\t\t\t\t\t\tbreak;"], [51, "\t\t\t\t\t\tcase \"4\":"], [52, "\t\t\t\t\t\t\tview.setMode(DetailMode.totalsyscpu);"], [53, "\t\t\t\t\t\t\tbreak;"], [54, "\t\t\t\t\t\tcase \"5\":"], [55, "\t\t\t\t\t\t\tview.setMode(DetailMode.memory);"], [56, "\t\t\t\t\t\t\tbreak;"], [57, "\t\t\t\t\t\tcase \"6\":"], [58, "\t\t\t\t\t\t\tview.setMode(DetailMode.totalmemory);"], [59, "\t\t\t\t\t\t\tbreak;"], [60, "\t\t\t\t\t\tdefault:"], [61, "\t\t\t\t\t\t\tSystem.err.println(\" Wrong option for display mode\");"], [62, "\t\t\t\t\t\t\tbreak;"], [63, "\t\t\t\t\t}"], [64, "\t\t\t\t\tSystem.err.println(\" Display mode changed to \" + view.getMode() + \" for next flush\");"], [65, "\t\t\t\t\tvjtop.setNeedForFurtherInput(false);"], [67, "\t\t\t\t\tview.exit();"], [68, "\t\t\t\t\tmainThread.interrupt();"], [69, "\t\t\t\t\tSystem.err.println(\" Quit.\");"], [71, "\t\t\t\t} else if (command.equals(\"h\")) {"], [72, "\t\t\t\t\tSystem.err.println(\" t : print stack trace for the thread you choose\");"], [73, "\t\t\t\t\tSystem.err.println(\" d : change threads display mode and ordering\");"], [74, "\t\t\t\t\tSystem.err.println(\" q : quit\");"], [75, "\t\t\t\t\tSystem.err.println(\" h : print help\");"], [78, "\t\t\t\t\tSystem.err.println(\"Unkown command: \" + command);"], [81, "\t\t\t\tview.waitForCommand();"], [83, ""]]}, "num_lines_added": 76, "num_lines_removed": 61}