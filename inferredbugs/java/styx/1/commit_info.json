{"hash": "d59b7a737f5bd93740189f8a8a64289e3cbba6f5", "message": "Remove activeStates from BigtableStorage (#3)", "file_num_lines": 210, "diff_parsed": {"added": [], "deleted": [[24, "import com.google.common.collect.ImmutableMap;"], [41, "import org.apache.hadoop.hbase.client.Delete;"], [75, "  public static final TableName ACTIVE_STATES_TABLE_NAME = TableName.valueOf(\"active_states\");"], [81, "  public static final byte[] STATE_CF = Bytes.toBytes(\"state\");"], [82, "  public static final byte[] STATE_QUALIFIER = Bytes.toBytes(\"state\");"], [112, "  Map<WorkflowInstance, Long> readActiveWorkflowInstances() throws IOException {"], [113, "    final Table activeStatesTable = connection.getTable(ACTIVE_STATES_TABLE_NAME);"], [114, "    final ImmutableMap.Builder<WorkflowInstance, Long> map = ImmutableMap.builder();"], [115, ""], [116, "    for (Result result : activeStatesTable.getScanner(STATE_CF, STATE_QUALIFIER)) {"], [117, "      final WorkflowInstance workflowInstance ="], [118, "          WorkflowInstance.parseKey(Bytes.toString(result.getRow()));"], [119, "      final long counter = Long.parseLong(Bytes.toString(result.value()));"], [120, ""], [121, "      map.put(workflowInstance, counter);"], [122, "    }"], [123, ""], [124, "    return map.build();"], [125, "  }"], [126, ""], [144, ""], [145, "  void writeActiveState(WorkflowInstance workflowInstance, long counter) throws IOException {"], [146, "    storeWithRetries(() -> {"], [147, "      final Table activeStatesTable = connection.getTable(ACTIVE_STATES_TABLE_NAME);"], [148, ""], [149, "      final byte[] counterValue = Bytes.toBytes(Long.toString(counter));"], [150, "      final byte[] key = Bytes.toBytes(workflowInstance.toKey());"], [151, "      final Put put = new Put(key)"], [152, "          .addColumn(STATE_CF, STATE_QUALIFIER, counterValue);"], [153, ""], [154, "      activeStatesTable.put(put);"], [155, "    });"], [156, "  }"], [157, ""], [158, "  void deleteActiveState(WorkflowInstance workflowInstance) throws IOException {"], [159, "    storeWithRetries(() -> {"], [160, "      final Table activeStatesTable = connection.getTable(ACTIVE_STATES_TABLE_NAME);"], [161, "      final byte[] key = Bytes.toBytes(workflowInstance.toKey());"], [162, "      final Delete delete = new Delete(key);"], [163, ""], [164, "      activeStatesTable.delete(delete);"], [165, "    });"], [166, "  }"], [167, ""]]}, "num_lines_added": 0, "num_lines_removed": 44}