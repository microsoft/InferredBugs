{"hash": "4566a0e14a59eb812dcb59b9c6ac58c3cb900dc5", "message": "Remove migration code for database and table modification", "file_num_lines": 318, "diff_parsed": {"added": [[50, "        this.createTableIfMissing();"], [378, "            preparedStatement = connection.prepareStatement(\"SELECT name FROM sqlite_master WHERE type='table' AND name='repo';\");"], [381, "            String value = Values.EMPTYSTRING;"], [386, "            if (Singleton.getHelpers().isNullEmptyOrWhitespace(value)) {"], [387, "                preparedStatement = connection.prepareStatement(\"CREATE TABLE IF NOT EXISTS \\\"repo\\\" (\\\"name\\\" VARCHAR PRIMARY KEY  NOT NULL ,\\\"scm\\\" VARCHAR,\\\"url\\\" VARCHAR,\\\"username\\\" VARCHAR,\\\"password\\\" VARCHAR, \\\"source\\\", \\\"branch\\\" VARCHAR, data text);\");"], [392, "            this.logger.severe(String.format(\"5ec972ce::error in class %s exception %s searchcode was to create the api key table, so api calls will fail\", ex.getClass(), ex.getMessage()));"]], "deleted": [[370, ""], [371, "    // Schema Migrations below"], [372, "    public void addSourceToTable() {"], [373, "        Connection connection;"], [374, "        PreparedStatement preparedStatement = null;"], [375, "        ResultSet resultSet = null;"], [376, ""], [377, "        try {"], [378, "            connection = this.dbConfig.getConnection();"], [379, "            preparedStatement = connection.prepareStatement(\"PRAGMA table_info(repo);\");"], [380, ""], [381, "            boolean shouldAlter = true;"], [382, ""], [383, "            resultSet = preparedStatement.executeQuery();"], [384, "            String value;"], [385, ""], [386, "            while (resultSet.next()) {"], [387, "                value = resultSet.getString(\"name\");"], [388, ""], [389, "                if (\"source\".equals(value)) {"], [390, "                    shouldAlter = false;"], [391, "                }"], [392, "            }"], [393, ""], [394, "            if (shouldAlter) {"], [395, "                List<String> commands = Arrays.asList("], [396, "                        \"ALTER TABLE \\\"repo\\\" RENAME TO \\\"oXHFcGcd04oXHFcGcd04_repo\\\"\","], [397, "                        \"CREATE TABLE \\\"repo\\\" (\\\"name\\\" VARCHAR PRIMARY KEY  NOT NULL ,\\\"scm\\\" VARCHAR,\\\"url\\\" VARCHAR,\\\"username\\\" VARCHAR,\\\"password\\\" VARCHAR, \\\"source\\\" VARCHAR)\","], [398, "                        \"INSERT INTO \\\"repo\\\" SELECT \\\"name\\\",\\\"scm\\\",\\\"url\\\",\\\"username\\\",\\\"password\\\", \\\"\\\" FROM \\\"main\\\".\\\"oXHFcGcd04oXHFcGcd04_repo\\\"\","], [399, "                        \"DROP TABLE \\\"oXHFcGcd04oXHFcGcd04_repo\\\"\");"], [400, ""], [401, "                for (String command: commands) {"], [402, "                    preparedStatement = connection.prepareStatement(command);"], [403, "                    preparedStatement.execute();"], [404, "                }"], [405, "            }"], [406, "        }"], [407, "        catch (SQLException ex) {"], [408, "            this.logger.severe(String.format(\"2b05675f::error in class %s exception %s\", ex.getClass(), ex.getMessage()));"], [409, "        }"], [410, "        finally {"], [411, "            this.helpers.closeQuietly(resultSet);"], [412, "            this.helpers.closeQuietly(preparedStatement);"], [413, "        }"], [414, "    }"], [415, ""], [416, "    public void addBranchToTable() {"], [417, "        Connection connection;"], [418, "        PreparedStatement preparedStatement = null;"], [419, "        ResultSet resultSet = null;"], [420, ""], [421, "        try {"], [422, "            connection = this.dbConfig.getConnection();"], [423, "            preparedStatement = connection.prepareStatement(\"PRAGMA table_info(repo);\");"], [424, ""], [425, "            boolean shouldAlter = true;"], [426, ""], [427, "            resultSet = preparedStatement.executeQuery();"], [428, "            String value;"], [429, ""], [430, "            while (resultSet.next()) {"], [431, "                value = resultSet.getString(\"name\");"], [432, ""], [433, "                if (\"branch\".equals(value)) {"], [434, "                    shouldAlter = false;"], [435, "                }"], [436, "            }"], [437, ""], [438, "            // Python to generate random table name"], [439, "            // ''.join(random.choice(string.ascii_uppercase + string.digits + string.ascii_lowercase) for _ in range(20))"], [440, "            if (shouldAlter) {"], [441, "                List<String> commands = Arrays.asList("], [442, "                        \"ALTER TABLE \\\"repo\\\" RENAME TO \\\"y6L0VN5j9eQSg65hWtJJ_repo\\\"\","], [443, "                        \"CREATE TABLE \\\"repo\\\" (\\\"name\\\" VARCHAR PRIMARY KEY  NOT NULL ,\\\"scm\\\" VARCHAR,\\\"url\\\" VARCHAR,\\\"username\\\" VARCHAR,\\\"password\\\" VARCHAR, \\\"source\\\", \\\"branch\\\" VARCHAR)\","], [444, "                        \"INSERT INTO \\\"repo\\\" SELECT \\\"name\\\",\\\"scm\\\",\\\"url\\\",\\\"username\\\",\\\"password\\\", \\\"\\\", \\\"master\\\" FROM \\\"main\\\".\\\"y6L0VN5j9eQSg65hWtJJ_repo\\\"\","], [445, "                        \"DROP TABLE \\\"y6L0VN5j9eQSg65hWtJJ_repo\\\"\");"], [446, ""], [447, "                for (String command: commands) {"], [448, "                    preparedStatement = connection.prepareStatement(command);"], [449, "                    preparedStatement.execute();"], [450, "                }"], [451, "            }"], [452, "        }"], [453, "        catch (SQLException ex) {"], [454, "            this.logger.severe(String.format(\"41baae9d::error in class %s exception %s\", ex.getClass(), ex.getMessage()));"], [455, "        }"], [456, "        finally {"], [457, "            this.helpers.closeQuietly(resultSet);"], [458, "            this.helpers.closeQuietly(preparedStatement);"], [459, "        }"], [460, "    }"], [461, ""], [463, ""], [470, "            preparedStatement = connection.prepareStatement(\"CREATE TABLE IF NOT EXISTS \\\"repo\\\" (\\\"name\\\" VARCHAR PRIMARY KEY  NOT NULL ,\\\"scm\\\" VARCHAR,\\\"url\\\" VARCHAR,\\\"username\\\" VARCHAR,\\\"password\\\" VARCHAR, \\\"source\\\", \\\"branch\\\" VARCHAR, data text);\");"], [471, "            preparedStatement.execute();"], [472, "        }"], [473, "        catch (SQLException ex) {"], [474, "            this.logger.severe(String.format(\"5ec972ce::error in class %s exception %s\", ex.getClass(), ex.getMessage()));"], [475, "        }"], [476, "        finally {"], [477, "            this.helpers.closeQuietly(resultSet);"], [478, "            this.helpers.closeQuietly(preparedStatement);"], [479, "        }"], [480, "    }"], [481, ""], [482, "    public void addDataToTable() {"], [483, "        Connection connection;"], [484, "        PreparedStatement preparedStatement = null;"], [485, "        ResultSet resultSet = null;"], [486, ""], [487, "        try {"], [488, "            connection = this.dbConfig.getConnection();"], [489, "            preparedStatement = connection.prepareStatement(\"PRAGMA table_info(repo);\");"], [490, ""], [491, "            boolean shouldAlter = true;"], [494, "            String value;"], [495, ""], [498, ""], [499, "                if (\"data\".equals(value)) {"], [500, "                    shouldAlter = false;"], [501, "                }"], [504, "            if (shouldAlter) {"], [505, "                preparedStatement = connection.prepareStatement(\"ALTER TABLE repo ADD COLUMN data text;\");"], [510, "            this.logger.severe(String.format(\"f26a7acd::error in class %s exception %s\", ex.getClass(), ex.getMessage()));"]]}, "num_lines_added": 6, "num_lines_removed": 124}