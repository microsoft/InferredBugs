{"hash": "c1790765059bd28dae461a9ad98c97b6452dadd8", "message": "Remove cache from repo in dao layer", "file_num_lines": 337, "diff_parsed": {"added": [[47, "        List<RepoResult> repoResults = new ArrayList<>();"], [49, "        Connection connection = null;"], [50, "        PreparedStatement preparedStatement = null;"], [51, "        ResultSet resultSet = null;"], [54, "            connection = this.dbConfig.getConnection();"], [55, "            preparedStatement = connection.prepareStatement(\"select rowid,name,scm,url,username,password,source,branch from repo order by rowid desc;\");"], [57, "            resultSet = preparedStatement.executeQuery();"], [59, "            while (resultSet.next()) {"], [60, "                int rowId = resultSet.getInt(\"rowid\");"], [61, "                String repoName = resultSet.getString(\"name\");"], [62, "                String repoScm = resultSet.getString(\"scm\");"], [63, "                String repoUrl = resultSet.getString(\"url\");"], [64, "                String repoUsername = resultSet.getString(\"username\");"], [65, "                String repoPassword = resultSet.getString(\"password\");"], [66, "                String repoSource = resultSet.getString(\"source\");"], [67, "                String repoBranch = resultSet.getString(\"branch\");"], [72, "            preparedStatement.close();"], [73, "            connection.close();"], [79, "            Helpers.closeQuietly(resultSet);"], [80, "            Helpers.closeQuietly(preparedStatement);"], [81, "            Helpers.closeQuietly(connection);"], [160, "        int totalCount = 0;"], [162, "        Connection connection = null;"], [163, "        PreparedStatement preparedStatement = null;"], [164, "        ResultSet resultSet = null;"], [167, "            connection = this.dbConfig.getConnection();"], [168, "            preparedStatement = connection.prepareStatement(\"select count(rowid) as totalcount from repo;\");"], [170, "            resultSet = preparedStatement.executeQuery();"], [172, "            while (resultSet.next()) {"], [173, "                totalCount = resultSet.getInt(\"totalcount\");"], [180, "            Helpers.closeQuietly(resultSet);"], [181, "            Helpers.closeQuietly(preparedStatement);"], [182, "            Helpers.closeQuietly(connection);"], [185, "        return totalCount;"], [193, "        RepoResult result = null;"], [195, "        Connection connection = null;"], [196, "        PreparedStatement preparedStatement = null;"], [197, "        ResultSet resultSet = null;"], [200, "            connection = this.dbConfig.getConnection();"], [201, "            preparedStatement = connection.prepareStatement(\"select rowid,name,scm,url,username,password,source,branch from repo where name=?;\");"], [203, "            preparedStatement.setString(1, repositoryName);"], [204, "            resultSet = preparedStatement.executeQuery();"], [206, "            while (resultSet.next()) {"], [207, "                int rowId = resultSet.getInt(\"rowid\");"], [208, "                String repoName = resultSet.getString(\"name\");"], [209, "                String repoScm = resultSet.getString(\"scm\");"], [210, "                String repoUrl = resultSet.getString(\"url\");"], [211, "                String repoUsername = resultSet.getString(\"username\");"], [212, "                String repoPassword = resultSet.getString(\"password\");"], [213, "                String repoSource = resultSet.getString(\"source\");"], [214, "                String repoBranch = resultSet.getString(\"branch\");"], [223, "            Helpers.closeQuietly(resultSet);"], [224, "            Helpers.closeQuietly(preparedStatement);"], [225, "            Helpers.closeQuietly(connection);"], [236, "        Connection connection = null;"], [237, "        PreparedStatement preparedStatement = null;"], [238, "        ResultSet resultSet = null;"], [243, "            connection = this.dbConfig.getConnection();"], [244, "            preparedStatement = connection.prepareStatement(\"select rowid,name,scm,url,username,password,source,branch from repo where url=?;\");"], [246, "            preparedStatement.setString(1, repositoryUrl);"], [248, "            resultSet = preparedStatement.executeQuery();"], [250, "            while (resultSet.next()) {"], [251, "                int rowId = resultSet.getInt(\"rowid\");"], [252, "                String repoName = resultSet.getString(\"name\");"], [253, "                String repoScm = resultSet.getString(\"scm\");"], [254, "                String repoUrl = resultSet.getString(\"url\");"], [255, "                String repoUsername = resultSet.getString(\"username\");"], [256, "                String repoPassword = resultSet.getString(\"password\");"], [257, "                String repoSource = resultSet.getString(\"source\");"], [258, "                String repoBranch = resultSet.getString(\"branch\");"], [267, "            Helpers.closeQuietly(resultSet);"], [268, "            Helpers.closeQuietly(preparedStatement);"], [269, "            Helpers.closeQuietly(connection);"], [276, "        Connection connection = null;"], [277, "        PreparedStatement preparedStatement = null;"], [278, "        ResultSet resultSet = null;"], [281, "            connection = this.dbConfig.getConnection();"], [282, "            preparedStatement = connection.prepareStatement(\"delete from repo where name=?;\");"], [284, "            preparedStatement.setString(1, repositoryName);"], [286, "            preparedStatement.execute();"], [292, "            Helpers.closeQuietly(resultSet);"], [293, "            Helpers.closeQuietly(preparedStatement);"], [294, "            Helpers.closeQuietly(connection);"]], "deleted": [[47, "        List<RepoResult> repoResults = (ArrayList<RepoResult>)this.genericCache.get(this.repoAllRepoCacheKey);"], [48, "        if (this.genericCache.containsKey(this.repoAllRepoCacheKey)) {"], [49, "            return repoResults;"], [50, "        }"], [51, ""], [52, "        Connection conn = null;"], [53, "        PreparedStatement stmt = null;"], [54, "        ResultSet rs = null;"], [56, "        repoResults = new ArrayList<>();"], [59, "            conn = this.dbConfig.getConnection();"], [60, "            stmt = conn.prepareStatement(\"select rowid,name,scm,url,username,password,source,branch from repo order by rowid desc;\");"], [62, "            rs = stmt.executeQuery();"], [64, "            while (rs.next()) {"], [65, "                int rowId = rs.getInt(\"rowid\");"], [66, "                String repoName = rs.getString(\"name\");"], [67, "                String repoScm = rs.getString(\"scm\");"], [68, "                String repoUrl = rs.getString(\"url\");"], [69, "                String repoUsername = rs.getString(\"username\");"], [70, "                String repoPassword = rs.getString(\"password\");"], [71, "                String repoSource = rs.getString(\"source\");"], [72, "                String repoBranch = rs.getString(\"branch\");"], [77, "            stmt.close();"], [78, "            conn.close();"], [84, "            Helpers.closeQuietly(rs);"], [85, "            Helpers.closeQuietly(stmt);"], [86, "            Helpers.closeQuietly(conn);"], [89, "        this.genericCache.put(this.repoAllRepoCacheKey, repoResults);"], [166, "        Integer totalcount = (Integer)this.genericCache.get(this.repoCountCacheKey);"], [167, "        if (totalcount != null) {"], [168, "            return totalcount;"], [169, "        }"], [171, "        Connection conn = null;"], [172, "        PreparedStatement stmt = null;"], [173, "        ResultSet rs = null;"], [175, "        totalcount = 0;"], [177, "            conn = this.dbConfig.getConnection();"], [178, "            stmt = conn.prepareStatement(\"select count(rowid) as totalcount from repo;\");"], [180, "            rs = stmt.executeQuery();"], [182, "            while (rs.next()) {"], [183, "                totalcount = rs.getInt(\"totalcount\");"], [190, "            Helpers.closeQuietly(rs);"], [191, "            Helpers.closeQuietly(stmt);"], [192, "            Helpers.closeQuietly(conn);"], [195, "        this.genericCache.put(this.repoCountCacheKey, totalcount);"], [196, "        return totalcount;"], [204, "        RepoResult result = this.cache.get(repositoryName);"], [205, "        if (result != null) {"], [206, "            return result;"], [207, "        }"], [209, "        Connection conn = null;"], [210, "        PreparedStatement stmt = null;"], [211, "        ResultSet rs = null;"], [214, "            conn = this.dbConfig.getConnection();"], [215, "            stmt = conn.prepareStatement(\"select rowid,name,scm,url,username,password,source,branch from repo where name=?;\");"], [217, "            stmt.setString(1, repositoryName);"], [219, "            rs = stmt.executeQuery();"], [220, ""], [221, "            while (rs.next()) {"], [222, "                int rowId = rs.getInt(\"rowid\");"], [223, "                String repoName = rs.getString(\"name\");"], [224, "                String repoScm = rs.getString(\"scm\");"], [225, "                String repoUrl = rs.getString(\"url\");"], [226, "                String repoUsername = rs.getString(\"username\");"], [227, "                String repoPassword = rs.getString(\"password\");"], [228, "                String repoSource = rs.getString(\"source\");"], [229, "                String repoBranch = rs.getString(\"branch\");"], [238, "            Helpers.closeQuietly(rs);"], [239, "            Helpers.closeQuietly(stmt);"], [240, "            Helpers.closeQuietly(conn);"], [241, "        }"], [242, ""], [243, "        if (result != null) {"], [244, "            this.cache.put(repositoryName, result);"], [255, "        Connection conn = null;"], [256, "        PreparedStatement stmt = null;"], [257, "        ResultSet rs = null;"], [262, "            conn = this.dbConfig.getConnection();"], [263, "            stmt = conn.prepareStatement(\"select rowid,name,scm,url,username,password,source,branch from repo where url=?;\");"], [265, "            stmt.setString(1, repositoryUrl);"], [267, "            rs = stmt.executeQuery();"], [269, "            while (rs.next()) {"], [270, "                int rowId = rs.getInt(\"rowid\");"], [271, "                String repoName = rs.getString(\"name\");"], [272, "                String repoScm = rs.getString(\"scm\");"], [273, "                String repoUrl = rs.getString(\"url\");"], [274, "                String repoUsername = rs.getString(\"username\");"], [275, "                String repoPassword = rs.getString(\"password\");"], [276, "                String repoSource = rs.getString(\"source\");"], [277, "                String repoBranch = rs.getString(\"branch\");"], [286, "            Helpers.closeQuietly(rs);"], [287, "            Helpers.closeQuietly(stmt);"], [288, "            Helpers.closeQuietly(conn);"], [295, "        Connection conn = null;"], [296, "        PreparedStatement stmt = null;"], [297, "        ResultSet rs = null;"], [300, "            conn = this.dbConfig.getConnection();"], [301, "            stmt = conn.prepareStatement(\"delete from repo where name=?;\");"], [302, ""], [303, "            stmt.setString(1, repositoryName);"], [305, "            stmt.execute();"], [307, "            this.cache.remove(repositoryName);"], [308, "            this.genericCache.remove(this.repoCountCacheKey);"], [309, "            this.genericCache.remove(this.repoAllRepoCacheKey);"], [315, "            Helpers.closeQuietly(rs);"], [316, "            Helpers.closeQuietly(stmt);"], [317, "            Helpers.closeQuietly(conn);"]]}, "num_lines_added": 83, "num_lines_removed": 106}