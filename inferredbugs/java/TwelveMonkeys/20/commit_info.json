{"hash": "eda2cd76db725510f6f6b0c60c2f68362ce98bae", "message": "#574 Fix for possible OOME in Exif metadata.", "file_num_lines": 1138, "diff_parsed": {"added": [[33, "import java.awt.*;"], [34, "import java.awt.color.ColorSpace;"], [35, "import java.awt.color.ICC_ColorSpace;"], [36, "import java.awt.color.ICC_Profile;"], [37, "import java.awt.image.*;"], [38, "import java.io.DataInput;"], [39, "import java.io.DataInputStream;"], [40, "import java.io.EOFException;"], [41, "import java.io.File;"], [42, "import java.io.IOException;"], [43, "import java.io.InputStream;"], [44, "import java.io.SequenceInputStream;"], [45, "import java.util.ArrayList;"], [46, "import java.util.Arrays;"], [47, "import java.util.Collections;"], [48, "import java.util.Iterator;"], [49, "import java.util.List;"], [50, ""], [51, "import javax.imageio.IIOException;"], [52, "import javax.imageio.ImageIO;"], [53, "import javax.imageio.ImageReadParam;"], [54, "import javax.imageio.ImageReader;"], [55, "import javax.imageio.ImageTypeSpecifier;"], [56, "import javax.imageio.event.IIOReadUpdateListener;"], [57, "import javax.imageio.event.IIOReadWarningListener;"], [58, "import javax.imageio.metadata.IIOMetadata;"], [59, "import javax.imageio.metadata.IIOMetadataFormatImpl;"], [60, "import javax.imageio.metadata.IIOMetadataNode;"], [61, "import javax.imageio.spi.ImageReaderSpi;"], [62, "import javax.imageio.stream.ImageInputStream;"], [63, ""], [912, "            int offset = exif.identifier.length() + 2; // Incl. pad"], [914, "            if (exif.data.length <= offset) {"], [918, "                // TODO: Consider returning ByteArrayImageInputStream from Segment.data()"], [919, "                try (ImageInputStream stream = new ByteArrayImageInputStream(exif.data, offset, exif.data.length - offset)) {"], [920, "                    return (CompoundDirectory) new TIFFReader().read(stream);"], [921, "                }"]], "deleted": [[52, "import javax.imageio.*;"], [53, "import javax.imageio.event.IIOReadUpdateListener;"], [54, "import javax.imageio.event.IIOReadWarningListener;"], [55, "import javax.imageio.metadata.IIOMetadata;"], [56, "import javax.imageio.metadata.IIOMetadataFormatImpl;"], [57, "import javax.imageio.metadata.IIOMetadataNode;"], [58, "import javax.imageio.spi.ImageReaderSpi;"], [59, "import javax.imageio.stream.ImageInputStream;"], [60, "import javax.imageio.stream.MemoryCacheImageInputStream;"], [61, "import java.awt.*;"], [62, "import java.awt.color.ColorSpace;"], [63, "import java.awt.color.ICC_ColorSpace;"], [64, "import java.awt.color.ICC_Profile;"], [65, "import java.awt.image.*;"], [66, "import java.io.*;"], [67, "import java.util.List;"], [68, "import java.util.*;"], [69, ""], [899, "            InputStream data = exif.data();"], [901, "            if (data.read() == -1) { // Read pad"], [905, "                ImageInputStream stream = new MemoryCacheImageInputStream(data);"], [906, "                return (CompoundDirectory) new TIFFReader().read(stream);"], [907, ""], [908, "                // TODO: Directory offset of thumbnail is wrong/relative to container stream, causing trouble for the TIFFReader..."]]}, "num_lines_added": 37, "num_lines_removed": 24}