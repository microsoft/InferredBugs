{"hash": "5a6bb67ea1fdc6c00012d17cb375fbe8a03ad466", "message": "fix multi redis version support bug", "file_num_lines": 44, "diff_parsed": {"added": [[14, "\tprotected Server server;"], [17, ""], [26, "\t\t\tjedis = new Jedis(server.getHost(), Integer.parseInt(server.getPort()));"], [28, "\t\t\tcommand();"], [35, ""], [36, "\tprotected abstract void command() ;"]], "deleted": [[4, "import java.util.ArrayList;"], [5, "import java.util.HashMap;"], [6, "import java.util.List;"], [7, "import java.util.Map;"], [18, "\tprivate Server server;"], [19, "\tprivate List<JedisCommand> commands = new ArrayList<JedisCommand>();"], [20, "\tprivate Map<String, RedisVersion> serverVersion = new HashMap<String, RedisVersion>();"], [23, ""], [32, "\t\t\tjedis = new Jedis(server.getHost(), Integer.parseInt(server"], [33, "\t\t\t\t\t.getPort()));"], [34, "\t\t\tif (commands.size() > 0) {"], [35, "\t\t\t\tRedisVersion version;"], [36, "\t\t\t\tif (serverVersion.containsKey(String.valueOf(id))) {"], [37, "\t\t\t\t\tversion = serverVersion.get(String.valueOf(id));"], [38, "\t\t\t\t} else {"], [39, "\t\t\t\t\tversion = getRedisVersion();"], [40, "\t\t\t\t\tserverVersion.put(String.valueOf(id), version);"], [41, "\t\t\t\t}"], [43, "\t\t\t\tgetCommand(version).command();"], [44, "\t\t\t} else"], [45, "\t\t\t\tcommand();"], [52, ""], [53, "\tpublic abstract void command();"], [72, ""], [73, "\tprivate RedisVersion getRedisVersion() {"], [74, "\t\tString version = jedis.info(\"redis_version\");"], [75, "\t\tif (version.startsWith(\"3.0\"))"], [76, "\t\t\treturn RedisVersion.REDIS_3_0;"], [77, "\t\telse if (version.startsWith(\"2.8\"))"], [78, "\t\t\treturn RedisVersion.REDIS_2_8;"], [79, "\t\telse if (version.startsWith(\"2.6\"))"], [80, "\t\t\treturn RedisVersion.REDIS_2_6;"], [81, "\t\telse if (version.startsWith(\"2.4\"))"], [82, "\t\t\treturn RedisVersion.REDIS_2_4;"], [83, "\t\telse if (version.startsWith(\"2.2\"))"], [84, "\t\t\treturn RedisVersion.REDIS_2_2;"], [85, "\t\telse if (version.startsWith(\"2.0\"))"], [86, "\t\t\treturn RedisVersion.REDIS_2_0;"], [87, "\t\telse"], [88, "\t\t\treturn RedisVersion.REDIS_1_0;"], [89, "\t}"], [90, ""], [91, "\tprivate JedisCommand getCommand(RedisVersion version) {"], [92, ""], [93, "\t\tfor (int i = commands.size(); i > 0; i--) {"], [94, "\t\t\tJedisCommand command = commands.get(i);"], [95, "\t\t\tif (command.getVersion().getVersion() <= version.getVersion())"], [96, "\t\t\t\treturn command;"], [97, "\t\t}"], [98, "\t\treturn null;"], [99, "\t}"]]}, "num_lines_added": 6, "num_lines_removed": 51}