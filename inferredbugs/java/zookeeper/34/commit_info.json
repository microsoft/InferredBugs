{"hash": "8d2ae28491342663d9290114b8ecb182d6aa903e", "message": "ZOOKEEPER-453. Worker is not removed in QuorumCnxManager upon crash. (flavio via mahadev)\n\ngit-svn-id: https://svn.apache.org/repos/asf/hadoop/zookeeper/trunk@789943 13f79535-47bb-0310-9956-ffa450edef68", "file_num_lines": 357, "diff_parsed": {"added": [[158, "        \t} else {"], [159, "        \t    LOG.error(\"Cannot open channel to server \"  + sid);"], [206, "                /*"], [207, "                 * This replica might still believe that the connection to sid"], [208, "                 * is up, so we have to shut down the workers before trying to"], [209, "                 * open a new connection."], [210, "                 */"], [212, "                if(sw != null)"], [213, "                    sw.finish();"], [214, ""], [215, "                /*"], [216, "                 * Now we start a new connection"], [217, "                 */"], [218, "                LOG.debug(\"Create new connection to server: \" + sid);"], [312, "                LOG.debug(\"Opening channel to server \"  + sid);"], [320, "        } else {"], [321, "            LOG.error(\"There is a connection for server \" + sid);"], [430, "        volatile boolean running = true;"], [444, "        synchronized boolean finish() {"], [491, "                    finish();"], [492, "                    recvWorker.finish();"], [493, "                    recvWorker = null;"], [495, "                    ArrayBlockingQueue<ByteBuffer> bq = queueSendMap.get(sid);"], [496, "                    if(bq != null){"], [497, "                        if (bq.size() == 0) {"], [498, "                            boolean ret = bq.offer(b);"], [499, "                            if (!ret) {"], [500, "                                // to appease findbugs"], [501, "                                LOG.error(\"Not able to add to a quue of size 0\");"], [503, "                        }"], [504, "                    } else LOG.error(\"No queue for server \" + sid);"], [518, "        volatile boolean running = true;"], [525, "        synchronized boolean finish() {"]], "deleted": [[205, ""], [206, "                LOG.info(\"Create new connection to server: \" + sid);"], [415, "        boolean running = true;"], [429, "        boolean finish() {"], [476, "                    running = false;"], [477, "                    synchronized (senderWorkerMap) {"], [478, "                        recvWorker.finish();"], [479, "                        recvWorker = null;"], [481, "                        senderWorkerMap.remove(sid);"], [482, "                        ArrayBlockingQueue<ByteBuffer> bq = queueSendMap.get(sid);"], [483, "                        if(bq != null){"], [484, "                            if (bq.size() == 0) {"], [485, "                                boolean ret = bq.offer(b);"], [486, "                                if (!ret) {"], [487, "                                    // to appease findbugs"], [488, "                                    LOG.error(\"Not able to add to a quue of size 0\");"], [489, "                                }"], [491, "                        } else LOG.error(\"No queue for server \" + sid);"], [492, "                    }"], [506, "        boolean running = true;"], [513, "        boolean finish() {"], [558, ""]]}, "num_lines_added": 33, "num_lines_removed": 22}