{"hash": "ff0f0053d436445fc22b7f160572c32058b51eed", "message": "refactoring\n\nintroduced new POJO EventLogEntry to simplify handling, Adapted Lucene\nService\n\nIssue #521", "file_num_lines": 415, "diff_parsed": {"added": [[72, "import org.imixs.workflow.engine.EventLogEntry;"], [463, "\t\tList<EventLogEntry> events = eventLogService.findEvents(count + 1,"], [466, "\t\tif (events != null && events.size() > 0) {"], [470, "\t\t\t\tfor (EventLogEntry eventLogEntry : events) {"], [471, "\t\t\t\t\tTerm term = new Term(\"$uniqueid\", eventLogEntry.getUniqueID());"], [472, "\t\t\t\t\t// lookup the Document Entity..."], [474, "\t\t\t\t\t\t\t.find(org.imixs.workflow.engine.jpa.Document.class, eventLogEntry.getUniqueID());"], [478, "\t\t\t\t\tif (doc != null && EVENTLOG_TOPIC_ADD.equals(eventLogEntry.getTopic())) {"], [485, "\t\t\t\t\t\t\tlogger.finest(\"......lucene add/update workitem '\" + doc.getId() + \"' to index in \""], [491, "\t\t\t\t\t\tlogger.finest(\"......lucene remove workitem '\" + term + \"' from index in \""], [496, "\t\t\t\t\tlastEventDate = eventLogEntry.getModified().getTime();"], [497, "\t\t\t\t\teventLogService.removeEvent(eventLogEntry);"], [534, "\t\tlogger.fine(\"...flushEventLog - \" + events.size() + \" events in \" + (System.currentTimeMillis() - l)"]], "deleted": [[462, "\t\tList<org.imixs.workflow.engine.jpa.Document> documentList = eventLogService.findEvents(count + 1,"], [465, "\t\tif (documentList != null && documentList.size() > 0) {"], [469, "\t\t\t\tfor (org.imixs.workflow.engine.jpa.Document eventLogEntry : documentList) {"], [470, "\t\t\t\t\tString topic = null;"], [471, "\t\t\t\t\tString id = eventLogEntry.getId();"], [472, "\t\t\t\t\t// cut prafix..."], [473, "\t\t\t\t\tif (id.startsWith(EVENTLOG_TOPIC_ADD)) {"], [474, "\t\t\t\t\t\tid = id.substring(EVENTLOG_TOPIC_ADD.length() + 1);"], [475, "\t\t\t\t\t\ttopic = EVENTLOG_TOPIC_ADD;"], [476, "\t\t\t\t\t}"], [477, "\t\t\t\t\tif (id.startsWith(EVENTLOG_TOPIC_REMOVE)) {"], [478, "\t\t\t\t\t\tid = id.substring(EVENTLOG_TOPIC_REMOVE.length() + 1);"], [479, "\t\t\t\t\t\ttopic = EVENTLOG_TOPIC_REMOVE;"], [480, "\t\t\t\t\t}"], [481, "\t\t\t\t\t// lookup the workitem..."], [483, "\t\t\t\t\t\t\t.find(org.imixs.workflow.engine.jpa.Document.class, id);"], [484, "\t\t\t\t\tTerm term = new Term(\"$uniqueid\", id);"], [488, "\t\t\t\t\tif (doc != null && EVENTLOG_TOPIC_ADD.equals(topic)) {"], [495, "\t\t\t\t\t\t\tlogger.finest(\"......lucene add/update workitem '\" + id + \"' to index in \""], [501, "\t\t\t\t\t\tlogger.finest(\"......lucene remove workitem '\" + id + \"' from index in \""], [506, "\t\t\t\t\tlastEventDate = eventLogEntry.getCreated().getTime();"], [507, "\t\t\t\t\tmanager.remove(eventLogEntry);"], [544, "\t\tlogger.fine(\"...flushEventLog - \" + documentList.size() + \" events in \" + (System.currentTimeMillis() - l)"]]}, "num_lines_added": 13, "num_lines_removed": 23}