{"hash": "d4776eeaf038bf9a2bf0aba39b15663308e45778", "message": "Clean up subtitle stream interfaces.", "file_num_lines": 1600, "diff_parsed": {"added": [[106, "    private static SubDvd subDVD;"], [108, "    private static SupDvd supDVD;"], [110, "    private static SubtitleStream subtitleStream;"], [331, "        progressMax = subtitleStream.getFrameCount();"], [370, "            int rgbSrc[] = subtitleStream.getPalette().getRGB(subtitleStream.getPrimaryColorIndex());"], [413, "            trgPal = SubDvd.decodePalette(subVobTrg, trgPallete);"], [419, "            DvdSubtitleStream substreamDvd;"], [422, "                substreamDvd = subDVD;"], [424, "                substreamDvd = supDVD;"], [427, "            alpha = substreamDvd.getFrameAlpha(index);"], [428, "            palFrame = substreamDvd.getFramePalette(index);"], [465, "        // close existing subtitleStream"], [466, "        if (subtitleStream != null) {"], [467, "            subtitleStream.close();"], [474, "            subtitleStream = supBD;"], [479, "            subtitleStream = supHD;"], [485, "        subtitleStream.decode(0);"], [489, "        int maxLum = subtitleStream.getPalette().getY()[subtitleStream.getPrimaryColorIndex()] & 0xff;"], [501, "        if (subtitleStream == supBD) {"], [525, "        // close existing subtitleStream"], [526, "        if (subtitleStream != null) {"], [527, "            subtitleStream.close();"], [532, "        subtitleStream = supXml;"], [537, "        subtitleStream.decode(0);"], [541, "        int maxLum = subtitleStream.getPalette().getY()[subtitleStream.getPrimaryColorIndex()] & 0xff;"], [597, "        // close existing subtitleStream"], [598, "        if (subtitleStream != null) {"], [599, "            subtitleStream.close();"], [602, "        DvdSubtitleStream substreamDvd;"], [615, "            subDVD = new SubDvd(fnS, fnI);"], [616, "            subtitleStream = subDVD;"], [618, "            substreamDvd = subDVD;"], [623, "            supDVD = new SupDvd(fnS, fnI);"], [624, "            subtitleStream = supDVD;"], [626, "            substreamDvd = supDVD;"], [630, "        subtitleStream.decode(0);"], [632, "        defaultSourceDVDPalette = substreamDvd.getSrcPalette();"], [636, "        int primColIdx = subtitleStream.getPrimaryColorIndex();"], [637, "        int yMax = subtitleStream.getPalette().getY()[primColIdx] & 0xff;"], [644, "                int y = subtitleStream.getPalette().getY()[i] & 0xff;"], [645, "                int a = subtitleStream.getPalette().getAlpha(i);"], [657, "        configuration.setLanguageIdx(substreamDvd.getLanguageIdx());"], [660, "        int h = subtitleStream.getSubPicture(0).height; //subtitleStream.getBitmap().getHeight();"], [769, "        SubPicture picSrc = subtitleStream.getSubPicture(index);"], [850, "        subPictures = new SubPicture[subtitleStream.getFrameCount()];"], [871, "            picSrc = subtitleStream.getSubPicture(i);"], [1026, "            picSrc = subtitleStream.getSubPicture(i);"], [1169, "        int startOfs = (int) subtitleStream.getStartOffset(index);"], [1170, "        SubPicture subPic = subtitleStream.getSubPicture(index);"], [1172, "        printX(\"Decoding frame \"+displayNum+\"/\"+displayMax+((subtitleStream == supXml)?\"\\n\":(\" at offset \"+ToolBox.toHexLeftZeroPadded(startOfs,8)+\"\\n\")));"], [1175, "            subtitleStream.decode(index);"], [1233, "                        tBm = subtitleStream.getBitmap(); // no conversion"], [1235, "                        tBm = subtitleStream.getBitmap().getBitmapWithNormalizedPalette(subtitleStream.getPalette().getAlpha(), configuration.getAlphaThreshold(), subtitleStream.getPalette().getY(), configuration.getLuminanceThreshold()); // reduce palette"], [1242, "                            tBm = subtitleStream.getBitmap().scaleFilter(trgWidth, trgHeight, subtitleStream.getPalette(), f);"], [1244, "                            tBm = subtitleStream.getBitmap().scaleBilinear(trgWidth, trgHeight, subtitleStream.getPalette());"], [1249, "                            tBm = subtitleStream.getBitmap().scaleFilterLm(trgWidth, trgHeight, subtitleStream.getPalette(), configuration.getAlphaThreshold(), configuration.getLuminanceThreshold(), f);"], [1251, "                            tBm = subtitleStream.getBitmap().scaleBilinearLm(trgWidth, trgHeight, subtitleStream.getPalette(), configuration.getAlphaThreshold(), configuration.getLuminanceThreshold());"], [1257, "                tPal = subtitleStream.getPalette();"], [1259, "                    tBm = subtitleStream.getBitmap(); // no scaling, no conversion"], [1265, "                            tBm = subtitleStream.getBitmap().scaleFilter(trgWidth, trgHeight, subtitleStream.getPalette(), f);"], [1267, "                            tBm = subtitleStream.getBitmap().scaleBilinear(trgWidth, trgHeight, subtitleStream.getPalette());"], [1274, "                            pb = subtitleStream.getBitmap().scaleFilter(trgWidth, trgHeight, subtitleStream.getPalette(), f, dither);"], [1276, "                            pb = subtitleStream.getBitmap().scaleBilinear(trgWidth, trgHeight, subtitleStream.getPalette(), dither);"], [1346, "            for (int i=0; i < subtitleStream.getFrameCount(); i++) {"], [1359, "                        byte buf[] = SubDvd.createSubFrame(subVobTrg, trgBitmap);"], [1366, "                        byte buf[] = SupDvd.createSupFrame(subVobTrg, trgBitmap);"], [1424, "            SubDvd.writeIdx(fname, subPictures[0], ofs, ts, trgPallete);"], [1438, "            SupDvd.writeIFO(fname, subPictures[0], trgPallete);"], [1477, "        progressMax = subtitleStream.getFrameCount();"], [1894, "            return subtitleStream.getImage();"], [1906, "            subtitleStream.decode(idx);"], [1907, "            return subtitleStream.getImage();"], [2023, "        return subtitleStream == null ? 0 : subtitleStream.getFrameCount();"], [2031, "        return subtitleStream == null ? 0 : subtitleStream.getForcedFrameCount();"], [2058, "        SubPicture pic = subtitleStream.getSubPicture(index);"], [2121, "            return subtitleStream.getSubPicture(index);"], [2318, "        DvdSubtitleStream substreamDvd = null;"], [2320, "            substreamDvd = subDVD;"], [2322, "            substreamDvd = supDVD;"], [2325, "        substreamDvd.setSrcPalette(currentSourceDVDPalette);"], [2334, "        DvdSubtitleStream substreamDvd = null;"], [2337, "            substreamDvd = subDVD;"], [2339, "            substreamDvd = supDVD;"], [2342, "        if (substreamDvd != null) {"], [2343, "            return substreamDvd.getFramePalette(index);"], [2355, "        DvdSubtitleStream substreamDvd = null;"], [2358, "            substreamDvd = subDVD;"], [2360, "            substreamDvd = supDVD;"], [2363, "        if (substreamDvd != null) {"], [2364, "            return substreamDvd.getFrameAlpha(index);"], [2376, "        DvdSubtitleStream substreamDvd = null;"], [2379, "            substreamDvd = subDVD;"], [2381, "            substreamDvd = supDVD;"], [2384, "        if (substreamDvd != null) {"], [2385, "            return substreamDvd.getOriginalFramePalette(index);"], [2397, "        DvdSubtitleStream substreamDvd = null;"], [2400, "            substreamDvd = subDVD;"], [2402, "            substreamDvd = supDVD;"], [2405, "        if (substreamDvd != null) {"], [2406, "            return substreamDvd.getOriginalFrameAlpha(index);"]], "deleted": [[106, "    private static SubDVD subDVD;"], [108, "    private static SupDVD supDVD;"], [110, "    private static Substream substream;"], [331, "        progressMax = substream.getNumFrames();"], [370, "            int rgbSrc[] = substream.getPalette().getRGB(substream.getPrimaryColorIndex());"], [413, "            trgPal = SubDVD.decodePalette(subVobTrg, trgPallete);"], [419, "            SubstreamDVD substreamDVD;"], [422, "                substreamDVD = subDVD;"], [424, "                substreamDVD = supDVD;"], [427, "            alpha = substreamDVD.getFrameAlpha(index);"], [428, "            palFrame = substreamDVD.getFramePal(index);"], [465, "        // close existing substream"], [466, "        if (substream != null) {"], [467, "            substream.close();"], [474, "            substream = supBD;"], [479, "            substream = supHD;"], [485, "        substream.decode(0);"], [489, "        int maxLum = substream.getPalette().getY()[substream.getPrimaryColorIndex()] & 0xff;"], [501, "        if (substream == supBD) {"], [525, "        // close existing substream"], [526, "        if (substream != null) {"], [527, "            substream.close();"], [532, "        substream = supXml;"], [537, "        substream.decode(0);"], [541, "        int maxLum = substream.getPalette().getY()[substream.getPrimaryColorIndex()] & 0xff;"], [597, "        // close existing substream"], [598, "        if (substream != null) {"], [599, "            substream.close();"], [602, "        SubstreamDVD substreamDVD;"], [615, "            subDVD = new SubDVD(fnS, fnI);"], [616, "            substream = subDVD;"], [618, "            substreamDVD = subDVD;"], [623, "            supDVD = new SupDVD(fnS, fnI);"], [624, "            substream = supDVD;"], [626, "            substreamDVD = supDVD;"], [630, "        substream.decode(0);"], [632, "        defaultSourceDVDPalette = substreamDVD.getSrcPalette();"], [636, "        int primColIdx = substream.getPrimaryColorIndex();"], [637, "        int yMax = substream.getPalette().getY()[primColIdx] & 0xff;"], [644, "                int y = substream.getPalette().getY()[i] & 0xff;"], [645, "                int a = substream.getPalette().getAlpha(i);"], [657, "        configuration.setLanguageIdx(substreamDVD.getLanguageIdx());"], [660, "        int h = substream.getSubPicture(0).height; //substream.getBitmap().getHeight();"], [769, "        SubPicture picSrc = substream.getSubPicture(index);"], [850, "        subPictures = new SubPicture[substream.getNumFrames()];"], [871, "            picSrc = substream.getSubPicture(i);"], [1026, "            picSrc = substream.getSubPicture(i);"], [1169, "        int startOfs = (int)substream.getStartOffset(index);"], [1170, "        SubPicture subPic = substream.getSubPicture(index);"], [1172, "        printX(\"Decoding frame \"+displayNum+\"/\"+displayMax+((substream == supXml)?\"\\n\":(\" at offset \"+ToolBox.toHexLeftZeroPadded(startOfs,8)+\"\\n\")));"], [1175, "            substream.decode(index);"], [1233, "                        tBm = substream.getBitmap(); // no conversion"], [1235, "                        tBm = substream.getBitmap().getBitmapWithNormalizedPalette(substream.getPalette().getAlpha(), configuration.getAlphaThreshold(), substream.getPalette().getY(), configuration.getLuminanceThreshold()); // reduce palette"], [1242, "                            tBm = substream.getBitmap().scaleFilter(trgWidth, trgHeight, substream.getPalette(), f);"], [1244, "                            tBm = substream.getBitmap().scaleBilinear(trgWidth, trgHeight, substream.getPalette());"], [1249, "                            tBm = substream.getBitmap().scaleFilterLm(trgWidth, trgHeight, substream.getPalette(), configuration.getAlphaThreshold(), configuration.getLuminanceThreshold(), f);"], [1251, "                            tBm = substream.getBitmap().scaleBilinearLm(trgWidth, trgHeight, substream.getPalette(), configuration.getAlphaThreshold(), configuration.getLuminanceThreshold());"], [1257, "                tPal = substream.getPalette();"], [1259, "                    tBm = substream.getBitmap(); // no scaling, no conversion"], [1265, "                            tBm = substream.getBitmap().scaleFilter(trgWidth, trgHeight, substream.getPalette(), f);"], [1267, "                            tBm = substream.getBitmap().scaleBilinear(trgWidth, trgHeight, substream.getPalette());"], [1274, "                            pb = substream.getBitmap().scaleFilter(trgWidth, trgHeight, substream.getPalette(), f, dither);"], [1276, "                            pb = substream.getBitmap().scaleBilinear(trgWidth, trgHeight, substream.getPalette(), dither);"], [1346, "            for (int i=0; i < substream.getNumFrames(); i++) {"], [1359, "                        byte buf[] = SubDVD.createSubFrame(subVobTrg, trgBitmap);"], [1366, "                        byte buf[] = SupDVD.createSupFrame(subVobTrg, trgBitmap);"], [1424, "            SubDVD.writeIdx(fname, subPictures[0], ofs, ts, trgPallete);"], [1438, "            SupDVD.writeIFO(fname, subPictures[0], trgPallete);"], [1477, "        progressMax = substream.getNumFrames();"], [1894, "            return substream.getImage();"], [1906, "            substream.decode(idx);"], [1907, "            return substream.getImage();"], [2023, "        return substream == null ? 0 : substream.getNumFrames();"], [2031, "        return substream == null ? 0 : substream.getNumForcedFrames();"], [2058, "        SubPicture pic = substream.getSubPicture(index);"], [2121, "            return substream.getSubPicture(index);"], [2318, "        SubstreamDVD substreamDVD = null;"], [2320, "            substreamDVD = subDVD;"], [2322, "            substreamDVD = supDVD;"], [2325, "        substreamDVD.setSrcPalette(currentSourceDVDPalette);"], [2334, "        SubstreamDVD substreamDVD = null;"], [2337, "            substreamDVD = subDVD;"], [2339, "            substreamDVD = supDVD;"], [2342, "        if (substreamDVD != null) {"], [2343, "            return substreamDVD.getFramePal(index);"], [2355, "        SubstreamDVD substreamDVD = null;"], [2358, "            substreamDVD = subDVD;"], [2360, "            substreamDVD = supDVD;"], [2363, "        if (substreamDVD != null) {"], [2364, "            return substreamDVD.getFrameAlpha(index);"], [2376, "        SubstreamDVD substreamDVD = null;"], [2379, "            substreamDVD = subDVD;"], [2381, "            substreamDVD = supDVD;"], [2384, "        if (substreamDVD != null) {"], [2385, "            return substreamDVD.getOriginalFramePal(index);"], [2397, "        SubstreamDVD substreamDVD = null;"], [2400, "            substreamDVD = subDVD;"], [2402, "            substreamDVD = supDVD;"], [2405, "        if (substreamDVD != null) {"], [2406, "            return substreamDVD.getOriginalFrameAlpha(index);"]]}, "num_lines_added": 100, "num_lines_removed": 100}