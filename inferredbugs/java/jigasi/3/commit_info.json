{"hash": "a5eaa357012692b6c9df56874758c098bda12561", "message": "make enabling gateways configurable (#119)\n\n* implements config options for enabling SIP and transcription", "file_num_lines": 427, "diff_parsed": {"added": [[325, ""], [326, "        // We have to check if we can update anything here (stats),"], [327, "        // cause session was just created and  might not have joined the jvb"], [328, "        // room, which means there is no change in participant count yet"], [329, "        if(session.isInTheRoom())"], [330, "        {"], [331, "            updatePresenceStatusForXmppProviders();"], [332, "        }"], [361, "            updatePresenceStatusForXmppProvider(osgiContext.getService(ref));"], [372, "     * @param activeSessions the active session count"], [376, "        int participantsCount,"], [377, "        int activeSessions)"], [401, "                    activeSessions));"], [425, "        SipGateway sipGateway= ServiceUtils.getService("], [427, "        TranscriptionGateway transcriptionGateway = ServiceUtils.getService("], [428, "            osgiContext, TranscriptionGateway.class);"], [429, ""], [430, "        List<AbstractGatewaySession> sessions = new ArrayList<>();"], [431, "        if(sipGateway != null)"], [432, "        {"], [433, "           sessions.addAll(sipGateway.getActiveSessions());"], [434, "        }"], [435, "        if(transcriptionGateway != null)"], [436, "        {"], [437, "            sessions.addAll(transcriptionGateway.getActiveSessions());"], [438, "        }"], [440, "        int sesCount = 0;"], [441, "        int participantCount = 0;"], [442, ""], [443, "        for(AbstractGatewaySession ses : sessions)"], [445, "            ChatRoom room = ses.getJvbChatRoom();"], [446, "            if(room != null)"], [447, "            {"], [448, "                participantCount += ses.getJvbChatRoom().getMembersCount();"], [449, "                sesCount++;"], [450, "            }"], [451, "            else"], [452, "            {"], [453, "                logger.warn(\"non-active session in active session list\");"], [454, "            }"], [457, "        updatePresenceStatusForXmppProvider(pps, participantCount, sesCount);"], [485, ""], [486, "                if(session[0] != null)"], [487, "                    setDialResponseAndRegisterHangUpHandler(resultIQ,"], [488, "                        session[0]);"], [489, ""]], "deleted": [[325, "        // we are not updating anything here (stats), cause session was just"], [326, "        // created and we haven't joined the jvb room so there is no change"], [327, "        // in participant count and the conference is actually not started yet"], [328, "        // till we join"], [350, "        SipGateway gateway = ServiceUtils.getService("], [351, "            osgiContext, SipGateway.class);"], [352, ""], [353, "        int participants = 0;"], [354, "        for(SipGatewaySession ses : gateway.getActiveSessions())"], [355, "        {"], [356, "            participants += ses.getJvbChatRoom().getMembersCount();"], [357, "        }"], [358, ""], [366, "            updatePresenceStatusForXmppProvider("], [367, "                gateway, osgiContext.getService(ref), participants);"], [376, "     * @param gateway the <tt>SipGateway</tt> instance we serve."], [381, "        SipGateway gateway,"], [383, "        int participantsCount)"], [407, "                    gateway.getActiveSessions().size()));"], [431, "        SipGateway gateway = ServiceUtils.getService("], [434, "        int participants = 0;"], [435, "        for(SipGatewaySession ses : gateway.getActiveSessions())"], [437, "            participants += ses.getJvbChatRoom().getMembersCount();"], [440, "        updatePresenceStatusForXmppProvider(gateway, pps, participants);"], [468, "                setDialResponseAndRegisterHangUpHandler(resultIQ, session[0]);"]]}, "num_lines_added": 46, "num_lines_removed": 25}