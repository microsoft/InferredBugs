{"hash": "dcd57fccb2360c5bc78388c02d9e0c24128c92fb", "message": "Use freebsd-version -u to detect userspace version (#126)", "file_num_lines": 60, "diff_parsed": {"added": [[40, "import java.lang.Runtime;"], [41, "import java.io.InputStreamReader;"], [42, "import java.io.BufferedReader;"], [43, "import java.text.NumberFormat;"], [44, "import java.text.ParsePosition;"], [45, ""], [47, "    private final int freebsdVersion;"], [48, ""], [51, ""], [52, "        int parsed_version = 0;"], [53, ""], [54, "        // FreeBSD 12 introduces a new stat structure. Until jffi gets dlvsym() support"], [55, "        // to allow us to link explicitly to supported versions of functions, detect"], [56, "        // the current userspace version and cross our fingers."], [57, "        try {"], [58, "            Process p = Runtime.getRuntime().exec(\"/bin/freebsd-version -u\");"], [59, "            String version = new BufferedReader(new InputStreamReader(p.getInputStream())).readLine();"], [60, ""], [61, "            if (p.waitFor() == 0 && version != null) {"], [62, "                NumberFormat fmt = NumberFormat.getIntegerInstance();"], [63, "                fmt.setGroupingUsed(false);"], [64, ""], [65, "                parsed_version = fmt.parse(version, new ParsePosition(0)).intValue();"], [66, "            }"], [67, "        } catch (Exception e) { }"], [68, ""], [69, "        freebsdVersion = parsed_version;"], [71, ""], [73, "        if (freebsdVersion >= 12) {"]], "deleted": [[44, ""], [46, "        if (System.getProperty(\"os.version\").compareTo(\"12.0\") > 0) {"]]}, "num_lines_added": 29, "num_lines_removed": 2}