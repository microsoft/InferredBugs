{"hash": "494d0fed21a0b939ee61058fdee621f794aea2b8", "message": "Plugable ExtensionStorage in ExtensionAnnotationProcessor (via processor options and system properties)", "file_num_lines": 157, "diff_parsed": {"added": [[31, "import java.lang.reflect.Constructor;"], [45, "    private static final String STORAGE_CLASS_NAME = \"pf4j.storageClassName\";"], [46, ""], [56, "        storage = createStorage();"], [72, "    @Override"], [73, "    public Set<String> getSupportedOptions() {"], [74, "        Set<String> options = new HashSet<>();"], [75, "        options.add(STORAGE_CLASS_NAME);"], [76, ""], [77, "        return options;"], [78, "    }"], [79, ""], [80, "    @Override"], [207, "    private ExtensionStorage createStorage() {"], [208, "        ExtensionStorage storage = null;"], [209, ""], [210, "        // search in processing options"], [211, "        String storageClassName = processingEnv.getOptions().get(STORAGE_CLASS_NAME);"], [212, "        if (storageClassName == null) {"], [213, "            // search in system properties"], [214, "            storageClassName = System.getProperty(STORAGE_CLASS_NAME);"], [215, "        }"], [217, "        if (storageClassName != null) {"], [218, "            // use reflection to create the storage instance"], [219, "            try {"], [220, "                Class storageClass = getClass().getClassLoader().loadClass(storageClassName);"], [221, "                Constructor constructor = storageClass.getConstructor(ExtensionAnnotationProcessor.class);"], [222, "                storage = (ExtensionStorage) constructor.newInstance(this);"], [223, "            } catch (Exception e) {"], [224, "                error(e.getMessage());"], [225, "            }"], [226, "        }"], [227, ""], [228, "        if (storage == null) {"], [229, "            // default storage"], [230, "            storage = new LegacyExtensionStorage(this);"], [231, "        }"], [232, ""], [233, "        return storage;"], [234, "    }"], [235, ""], [236, "}"]], "deleted": [[53, "        storage = new LegacyExtensionStorage(this);"], [54, "//        storage = new ServiceProviderExtensionStorage(this);"], [70, "\t@Override"], [197, "}"]]}, "num_lines_added": 42, "num_lines_removed": 4}