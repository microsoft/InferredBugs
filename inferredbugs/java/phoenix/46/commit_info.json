{"hash": "3bd426f10337b6e109ab7394bd4a4023039fd0e8", "message": "modify index state based on client version to support old clients", "file_num_lines": 4049, "diff_parsed": {"added": [[1412, ""], [1596, "    private PTable modifyIndexStateForOldClient(int clientVersion, PTable table)"], [1597, "            throws SQLException {"], [1598, "        if (table == null) {"], [1599, "            return table;"], [1600, "        }"], [1601, "        // PHOENIX-5073 Sets the index state based on the client version in case of old clients."], [1602, "        // If client is not yet up to 4.12, then translate PENDING_ACTIVE to ACTIVE (as would have"], [1603, "        // been the value in those versions) since the client won't have this index state in its"], [1604, "        // enum."], [1605, "        if (table.getIndexState() == PIndexState.PENDING_ACTIVE"], [1606, "                && clientVersion < MetaDataProtocol.MIN_PENDING_ACTIVE_INDEX) {"], [1607, "            table ="], [1608, "                    PTableImpl.builderWithColumns(table, PTableImpl.getColumnsToClone(table))"], [1609, "                            .setState(PIndexState.ACTIVE).build();"], [1610, "        }"], [1611, "        // If client is not yet up to 4.14, then translate PENDING_DISABLE to DISABLE"], [1612, "        // since the client won't have this index state in its enum."], [1613, "        if (table.getIndexState() == PIndexState.PENDING_DISABLE"], [1614, "                && clientVersion < MetaDataProtocol.MIN_PENDING_DISABLE_INDEX) {"], [1615, "            // note: for older clients, we have to rely on the rebuilder to transition"], [1616, "            // PENDING_DISABLE -> DISABLE"], [1617, "            table ="], [1618, "                    PTableImpl.builderWithColumns(table, PTableImpl.getColumnsToClone(table))"], [1619, "                            .setState(PIndexState.DISABLE).build();"], [1620, "        }"], [1621, "        return table;"], [1622, "    }"], [1623, ""], [3716, "            table = modifyIndexStateForOldClient(clientVersion, table);"]], "deleted": [[1412, "        // If client is not yet up to 4.12, then translate PENDING_ACTIVE to ACTIVE (as would have been"], [1413, "        // the value in those versions) since the client won't have this index state in its enum."], [1414, "        if (indexState == PIndexState.PENDING_ACTIVE && clientVersion < MetaDataProtocol.MIN_PENDING_ACTIVE_INDEX) {"], [1415, "            indexState = PIndexState.ACTIVE;"], [1416, "        }"], [1417, "        // If client is not yet up to 4.14, then translate PENDING_DISABLE to DISABLE"], [1418, "        // since the client won't have this index state in its enum."], [1419, "        if (indexState == PIndexState.PENDING_DISABLE && clientVersion < MetaDataProtocol.MIN_PENDING_DISABLE_INDEX) {"], [1420, "            // note: for older clients, we have to rely on the rebuilder to transition PENDING_DISABLE -> DISABLE"], [1421, "            indexState = PIndexState.DISABLE;"], [1422, "        }"]]}, "num_lines_added": 30, "num_lines_removed": 11}