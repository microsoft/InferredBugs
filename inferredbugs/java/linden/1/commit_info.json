{"hash": "4b192379f5b48cc2821c03955592d4ec7fe7664d", "message": "Keep expired index in case some urgent accident", "file_num_lines": 250, "diff_parsed": {"added": [[53, "  private static final String EXPIRED_INDEX_NAME_PREFIX = \"expired_\";"], [55, "  private static final int MAX_EXPIRED_INDEX_NUM = 3;"], [58, "  private String currentIndexVersion;"], [76, "      currentIndexVersion = currentIndexName.substring(CURRENT_INDEX_NAME_PREFIX.length());"], [91, "      currentIndexVersion = currentIndexName.substring(CURRENT_INDEX_NAME_PREFIX.length());"], [98, "      FileNameUtils.sortByNameDesc(files);"], [175, "    String nextIndexVersion = indexName.substring(NEXT_INDEX_NAME_PREFIX.length());"], [176, "    if (!currentIndexVersion.equals(nextIndexVersion)) {"], [193, "        String lastIndexVersion = currentIndexVersion;"], [196, "        currentIndexVersion = nextIndexVersion;"], [204, "        destDir = FilenameUtils.concat(baseIndexDir, EXPIRED_INDEX_NAME_PREFIX + lastIndexVersion);"], [205, "        FileUtils.moveDirectory(new File(dir), new File(destDir));"], [206, "        LOGGER.info(\"Expire index: \" + lastIndexName);"], [207, ""], [208, "        File[] files = getIndexDirectories(EXPIRED_INDEX_NAME_PREFIX);"], [209, "        if (files != null && files.length > MAX_EXPIRED_INDEX_NUM) {"], [210, "          File oldestExpiredIndexDir = files[files.length - 1];"], [211, "          FileUtils.deleteQuietly(oldestExpiredIndexDir);"], [212, "          LOGGER.info(\"Delete expired index: \" + oldestExpiredIndexDir.getName());"], [213, "        }"], [258, "        if (!indexName.substring(NEXT_INDEX_NAME_PREFIX.length()).equals(currentIndexVersion)) {"]], "deleted": [[56, "  private String currentIndexTimeStamp;"], [74, "      currentIndexTimeStamp = currentIndexName.substring(CURRENT_INDEX_NAME_PREFIX.length());"], [89, "      currentIndexTimeStamp = currentIndexName.substring(CURRENT_INDEX_NAME_PREFIX.length());"], [96, "      FileNameUtils.sort(files, -1);"], [173, "    String nextIndexTimeStamp = indexName.substring(NEXT_INDEX_NAME_PREFIX.length());"], [174, "    if (!currentIndexTimeStamp.equals(nextIndexTimeStamp)) {"], [193, "        currentIndexTimeStamp = nextIndexTimeStamp;"], [201, "        FileUtils.deleteQuietly(new File(dir));"], [202, "        LOGGER.info(\"Expire and delete index: \" + lastIndexName);"], [247, "        if (!indexName.substring(NEXT_INDEX_NAME_PREFIX.length()).equals(currentIndexTimeStamp)) {"]]}, "num_lines_added": 21, "num_lines_removed": 10}