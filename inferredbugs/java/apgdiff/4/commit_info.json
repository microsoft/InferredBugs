{"hash": "2a7943870c925bdee721426abd85de3a8c3e6461", "message": "partially implemented support for ALTER TABLE view_name for ALTER COLUMN and OWNER TO, also added ignoring of CREATE RULE for now", "file_num_lines": 175, "diff_parsed": {"added": [[6, "import cz.startnet.utils.pgdiff.schema.PgSchema;"], [8, "import cz.startnet.utils.pgdiff.schema.PgView;"], [39, "        final String schemaName ="], [40, "                ParserUtils.getSchemaName(tableName, database);"], [41, "        final PgSchema schema = database.getSchema(schemaName);"], [42, "        final String objectName = ParserUtils.getObjectName(tableName);"], [44, "        final PgTable table = schema.getTable(objectName);"], [45, ""], [46, "        if (table == null) {"], [47, "            final PgView view = schema.getView(objectName);"], [48, ""], [49, "            if (view != null) {"], [50, "                parseView(parser, view);"], [51, "                return;"], [52, "            }"], [53, "        }"], [221, ""], [222, "    /**"], [223, "     * Parses ALTER TABLE view."], [224, "     *"], [225, "     * @param parser"], [226, "     * @param view"], [227, "     */"], [228, "    private static void parseView(final Parser parser, final PgView view) {"], [229, "        while (!parser.expectOptional(\";\")) {"], [230, "            if (parser.expectOptional(\"ALTER\")) {"], [231, "                parser.expectOptional(\"COLUMN\");"], [232, ""], [233, "                final String columnName ="], [234, "                        ParserUtils.getObjectName(parser.parseIdentifier());"], [235, ""], [236, "                if (parser.expectOptional(\"SET\", \"DEFAULT\")) {"], [237, "                    final String expression = parser.getExpression();"], [238, "                    view.addColumnDefaultValue(columnName, columnName);"], [239, "                } else if (parser.expectOptional(\"DROP\", \"DEFAULT\")) {"], [240, "                    view.removeColumnDefaultValue(columnName);"], [241, "                } else {"], [242, "                    parser.throwUnsupportedCommand();"], [243, "                }"], [244, "            } else if (parser.expectOptional(\"OWNER\", \"TO\")) {"], [245, "                // we do not support OWNER TO so just consume the rest"], [246, "                parser.getExpression();"], [247, "            } else {"], [248, "                parser.throwUnsupportedCommand();"], [249, "            }"], [250, "        }"], [251, "    }"]], "deleted": [[38, "        final PgTable table = database.getSchema("], [39, "                ParserUtils.getSchemaName(tableName, database)).getTable("], [40, "                ParserUtils.getObjectName(tableName));"]]}, "num_lines_added": 47, "num_lines_removed": 3}