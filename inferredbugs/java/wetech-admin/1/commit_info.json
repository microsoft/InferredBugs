{"hash": "111a77e50258a185ec876c82ffe85622349003ff", "message": "Modified code according to alibaba coding guideline.", "file_num_lines": 84, "diff_parsed": {"added": [[206, "        return \"0:0:0:0:0:0:0:1\".equals(ip) ? \"127.0.0.1\" : ip;"]], "deleted": [[180, "     * \u6839\u636e\u670d\u52a1\u5668\u8bf7\u6c42\u4fe1\u606f\u66ff\u6362URL\u4e2d\u7684\u5360\u4f4d\u7b26<br>"], [181, "     * \u5982: getServerURL(\"http://{ServerName}:{ServerPort}/xxx/\")<br>"], [182, "     * \u8fd4\u56de http://127.0.0.1:8080/xxx/"], [183, "     *"], [184, "     * @author \u8d75\u5349\u534e"], [185, "     * @param url \u66ff\u6362\u524d\u7684URL"], [186, "     * @return \u66ff\u6362\u540e\u7684URL"], [187, "     */"], [188, "    public String getServerURL(String url) {"], [189, "        if (url == null) {"], [190, "            return url;"], [191, "        }"], [192, "        url = url.trim();"], [193, "        if (url.indexOf(\"{\") < 0 || url.indexOf(\"}\") < 0) {"], [194, "            return url;"], [195, "        }"], [196, "        // \u83b7\u53d6\u670d\u52a1\u5668\u8bf7\u6c42\u4fe1\u606f"], [197, "        HttpServletRequest request = getRequest();"], [198, "        String scheme = request.getScheme();"], [199, "        String host = request.getServerName();"], [200, "        String port = String.valueOf(request.getServerPort());"], [201, "        // ContextPath\u662f\u4ee5/\u659c\u6760\u5f00\u5934\u7684, substring(1)\u53bb\u6389\u659c\u6760"], [202, "        String ctx = request.getContextPath();"], [203, "        if (ctx != null && ctx.length() > 0) {"], [204, "            ctx = request.getContextPath().substring(1);"], [205, "        }"], [206, "        // \u5360\u4f4d\u7b26\u6b63\u5219\u8868\u8fbe\u5f0f"], [207, "        Pattern pScheme = Pattern.compile(\"\\\\{[Ss]cheme\\\\}\");"], [208, "        Pattern pHost = Pattern.compile(\"\\\\{[Ss]erverName\\\\}\");"], [209, "        Pattern pPort = Pattern.compile(\"\\\\{[Ss]erverPort\\\\}\");"], [210, "        Pattern pCtx = Pattern.compile(\"\\\\{[Cc]ontextPath\\\\}\");"], [211, "        // \u66ff\u6362\u5360\u4f4d\u7b26"], [212, "        url = pScheme.matcher(url).replaceFirst(scheme);"], [213, "        url = pHost.matcher(url).replaceFirst(host);"], [214, "        url = pPort.matcher(url).replaceFirst(port);"], [215, "        url = pCtx.matcher(url).replaceFirst(ctx);"], [216, "        return Pattern.compile(\"(?<!:)//\").matcher(url).replaceAll(\"/\");"], [217, "    }"], [218, ""], [219, "    /**"], [246, "        return ip.equals(\"0:0:0:0:0:0:0:1\") ? \"127.0.0.1\" : ip;"]]}, "num_lines_added": 1, "num_lines_removed": 41}