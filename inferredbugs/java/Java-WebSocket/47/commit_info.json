{"hash": "dbad4a276d6d8e1537b58f7c0256e24765db1b3e", "message": "tweaked WebsocketServer.stop to perform a graceful shutdown", "file_num_lines": 480, "diff_parsed": {"added": [[198, "\t *            Specifies how many milliseconds the overall close handshaking may take altogether before the connections are closed without proper close handshaking.<br>"], [204, "\tpublic void stop( int timeout ) throws InterruptedException {"], [226, "\t\t\t\t\tif( socketsToClose.size() > 0 )"], [227, "\t\t\t\t\t\tselectorthread.join( timeout );// isclosed will tell the selectorthread to go down after the last connection was closed"], [228, "\t\t\t\t\tselectorthread.interrupt();// in case the selectorthread did not terminate in time we send the interrupt"], [393, "\t\t} finally {"], [394, "\t\t\tif( decoders != null ) {"], [395, "\t\t\t\tfor( WebSocketWorker w : decoders ) {"], [396, "\t\t\t\t\tw.interrupt();"], [397, "\t\t\t\t}"], [398, "\t\t\t}"], [399, "\t\t\tif( server != null ) {"], [400, "\t\t\t\ttry {"], [401, "\t\t\t\t\tserver.close();"], [402, "\t\t\t\t} catch ( IOException e ) {"], [403, "\t\t\t\t\tonError( null, e );"], [404, "\t\t\t\t}"], [405, "\t\t\t}"], [537, "\t\tboolean removed;"], [539, "\t\t\tremoved = this.connections.remove( ws );"], [540, "\t\t\tassert ( removed );"], [542, "\t\tif( isclosed.get() && connections.size() == 0 ) {"], [543, "\t\t\tselectorthread.interrupt();"], [544, "\t\t}"], [545, "\t\treturn removed;"], [554, "\t\tif( !isclosed.get() ) {"]], "deleted": [[198, "\t *            Specifies how many milliseconds shall pass between initiating the close handshakes with the connected clients and closing the servers socket channel."], [204, "\tpublic void stop( int timeout ) throws IOException , InterruptedException {"], [226, "\t\t\t\t\tselectorthread.interrupt();"], [230, "\t\t\tif( decoders != null ) {"], [231, "\t\t\t\tfor( WebSocketWorker w : decoders ) {"], [232, "\t\t\t\t\tw.interrupt();"], [233, "\t\t\t\t}"], [234, "\t\t\t}"], [235, "\t\t\tif( server != null ) {"], [236, "\t\t\t\tserver.close();"], [237, "\t\t\t}"], [240, ""], [532, "\t\t\treturn this.connections.remove( ws );"], [535, ""], [543, "\t\tif( isclosed.get() ) {"]]}, "num_lines_added": 26, "num_lines_removed": 15}