{"hash": "917a6ac9631b92ce695e7802359ebf2facb7d71c", "message": "Move Citation calculation to version\n\nUpdate display of citations", "file_num_lines": 167, "diff_parsed": {"added": [[207, "        return version.getCitation(isOnlineVersion);"], [208, "    }"]], "deleted": [[207, ""], [208, ""], [209, "        String str = \"\";"], [210, ""], [211, "        boolean includeAffiliation = false;"], [212, "        String authors = version.getAuthorsStr(includeAffiliation);"], [213, "        if (!StringUtil.isEmpty(authors)) {"], [214, "            str += authors;"], [215, "        }"], [216, ""], [217, "        if (this.getPublicationDate() == null || StringUtil.isEmpty(this.getPublicationDate().toString())) {"], [218, "            //if not released use current year"], [219, "            if (!StringUtil.isEmpty(str)) {"], [220, "                str += \", \";"], [221, "            }"], [222, "            str +=  new SimpleDateFormat(\"yyyy\").format(new Timestamp(new Date().getTime())) ;"], [223, "        } else  {"], [224, "            if (!StringUtil.isEmpty(str)) {"], [225, "                str += \", \";"], [226, "            }"], [227, "            str += new SimpleDateFormat(\"yyyy\").format(new Timestamp(this.getPublicationDate().getTime()));"], [228, "        }"], [229, ""], [230, "        if ( version.getTitle() != null ) {"], [231, "            if (!StringUtil.isEmpty(version.getTitle())) {"], [232, "                if (!StringUtil.isEmpty(str)) {"], [233, "                    str += \", \";"], [234, "                }"], [235, "                str += \"\\\"\" + version.getTitle() + \"\\\"\";"], [236, "            }"], [237, "        }"], [238, "        if (!StringUtil.isEmpty(this.getIdentifier())) {"], [239, "            if (!StringUtil.isEmpty(str)) {"], [240, "                str += \", \";"], [241, "            }"], [242, "            if (isOnlineVersion) {"], [243, "                str += \"<a href=\\\"\" + this.getPersistentURL() + \"\\\">\" + this.getIdentifier() + \"</a>\";"], [244, "            } else {"], [245, "                str += this.getPersistentURL();"], [246, "            }"], [247, "        }"], [248, ""], [249, "        //Get root dataverse name for Citation"], [250, "        Dataverse root = this.getOwner();"], [251, "        while (root.getOwner() != null) {"], [252, "            root = root.getOwner();"], [253, "        }"], [254, "        String rootDataverseName = root.getName();"], [255, "        if (!StringUtil.isEmpty(rootDataverseName)) {"], [256, "            if (!StringUtil.isEmpty(str)) {"], [257, "                str += \", \";"], [258, "            }"], [259, "            str += \" \" + rootDataverseName + \" \";"], [260, "        }"], [261, ""], [262, "        if (version.getVersionNumber() != null) {"], [263, "            if (!StringUtil.isEmpty(str)) {"], [264, "                str += \", \";"], [265, "            }"], [266, "            str += \" V\" + version.getVersionNumber();"], [267, "            str += \" [Version]\";"], [268, "        }"], [269, "        /*UNF is not calculated yet"], [270, "         if (!StringUtil.isEmpty(getUNF())) {"], [271, "         if (!StringUtil.isEmpty(str)) {"], [272, "         str += \" \";"], [273, "         }"], [274, "         str += getUNF();"], [275, "         }"], [276, "         String distributorNames = getDistributorNames();"], [277, "         if (distributorNames.trim().length() > 0) {"], [278, "         str += \" \" + distributorNames;"], [279, "         str += \" [Distributor]\";"], [280, "         }*/"], [281, "        return str;"], [282, "    }"], [283, ""], [284, ""]]}, "num_lines_added": 2, "num_lines_removed": 78}