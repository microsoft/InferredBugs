{"hash": "b3494bcec3f99d72e13bbf9c13e237a78e50c2a4", "message": "Bug fix 3015838: Web crawler problem with UTF-8 BOM encoding\nNew feature 3015939: Cluster collapsing", "file_num_lines": 72, "diff_parsed": {"added": [[4, " * Copyright (C) 2008-2010 Emmanuel Keller / Jaeksoft"], [54, "\tprotected abstract void collapse(ResultScoreDoc[] fetchedDocs,"], [55, "\t\t\tint fetchLength);"], [56, ""], [68, "\t\tcollapse(fetchedDocs, fetchLength);"], [78, "\t/**"], [79, "\t * @param collapsedDocCount"], [80, "\t *            the collapsedDocCount to set"], [81, "\t */"], [82, "\tpublic void setCollapsedDocCount(int collapsedDocCount) {"], [83, "\t\tthis.collapsedDocCount = collapsedDocCount;"], [84, "\t}"], [85, ""], [86, "\t/**"], [87, "\t * @param collapsedDoc"], [88, "\t *            the collapsedDoc to set"], [89, "\t */"], [90, "\tpublic void setCollapsedDoc(ResultScoreDoc[] collapsedDoc) {"], [91, "\t\tthis.collapsedDoc = collapsedDoc;"], [92, "\t}"], [93, ""], [112, "\t/**"], [113, "\t * @return the collapseMax"], [114, "\t */"], [115, "\tpublic int getCollapseMax() {"], [116, "\t\treturn collapseMax;"], [117, "\t}"], [118, ""], [125, "\t\telse if (mode == CollapseMode.COLLAPSE_CLUSTER)"], [126, "\t\t\treturn new CollapseCluster(searchRequest);"]], "deleted": [[4, " * Copyright (C) 2008-2009 Emmanuel Keller / Jaeksoft"], [30, "import org.apache.lucene.util.OpenBitSet;"], [66, "\t\tOpenBitSet collapsedSet = new OpenBitSet(fetchLength);"], [67, ""], [68, "\t\tString lastTerm = null;"], [69, "\t\tint adjacent = 0;"], [70, "\t\tcollapsedDocCount = 0;"], [71, "\t\tfor (int i = 0; i < fetchLength; i++) {"], [72, "\t\t\tString term = fetchedDocs[i].collapseTerm;"], [73, "\t\t\tif (term != null && term.equals(lastTerm)) {"], [74, "\t\t\t\tif (++adjacent >= collapseMax)"], [75, "\t\t\t\t\tcollapsedSet.set(i);"], [76, "\t\t\t} else {"], [77, "\t\t\t\tlastTerm = term;"], [78, "\t\t\t\tadjacent = 0;"], [79, "\t\t\t}"], [80, "\t\t}"], [81, "\t\tcollapsedDocCount = (int) collapsedSet.cardinality();"], [82, ""], [83, "\t\tcollapsedDoc = new ResultScoreDoc[fetchLength - collapsedDocCount];"], [84, ""], [85, "\t\tint currentPos = 0;"], [86, "\t\tResultScoreDoc collapseDoc = null;"], [87, "\t\tfor (int i = 0; i < fetchLength; i++) {"], [88, "\t\t\tif (!collapsedSet.get(i)) {"], [89, "\t\t\t\tcollapseDoc = fetchedDocs[i];"], [90, "\t\t\t\tcollapseDoc.collapseCount = 0;"], [91, "\t\t\t\tcollapsedDoc[currentPos++] = collapseDoc;"], [92, "\t\t\t} else {"], [93, "\t\t\t\tcollapseDoc.collapseCount++;"], [94, "\t\t\t}"], [95, "\t\t}"]]}, "num_lines_added": 30, "num_lines_removed": 32}