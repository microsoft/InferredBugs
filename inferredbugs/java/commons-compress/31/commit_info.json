{"hash": "99696beab393fbaf96cf040c64b798c76e921cd9", "message": "reproduce https://issues.apache.org/jira/browse/COMPRESS-11\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@759326 13f79535-47bb-0310-9956-ffa450edef68", "file_num_lines": 108, "diff_parsed": {"added": [[21, "import java.io.BufferedInputStream;"], [22, "import java.io.ByteArrayOutputStream;"], [29, "import org.apache.commons.compress.AbstractTestCase;"], [34, ""], [76, "\t\tfinal ArchiveInputStream in = new ArchiveStreamFactory().createArchiveInputStream(new BufferedInputStream(is));"], [89, "\tpublic void testArDelete() throws Exception {"], [90, "\t\tfinal File output = new File(dir, \"bla.ar\");"], [91, ""], [92, "\t\t{"], [93, "\t\t\t// create"], [94, "\t\t\tfinal File file1 = getFile(\"test1.xml\");"], [95, "\t\t\tfinal File file2 = getFile(\"test2.xml\");"], [96, ""], [97, "\t\t\tfinal OutputStream out = new FileOutputStream(output);"], [98, "\t        final ArchiveOutputStream os = new ArchiveStreamFactory().createArchiveOutputStream(\"ar\", out);"], [99, "\t\t\tos.putArchiveEntry(new ArArchiveEntry(\"test1.xml\", file1.length()));"], [100, "\t\t\tIOUtils.copy(new FileInputStream(file1), os);"], [101, "\t\t\tos.closeArchiveEntry();"], [102, ""], [103, "\t\t\tos.putArchiveEntry(new ArArchiveEntry(\"test2.xml\", file2.length()));"], [104, "\t\t\tIOUtils.copy(new FileInputStream(file2), os);"], [105, "\t\t\tos.closeArchiveEntry();"], [106, "\t\t\tos.close();"], [107, "\t\t\tout.close();"], [108, "\t\t}"], [109, ""], [110, "\t\tfinal File output2 = new File(dir, \"bla2.ar\");"], [111, ""], [112, "\t\t{"], [113, "\t\t\t// remove all but one file"], [114, "\t\t\tfinal InputStream is = new FileInputStream(output);"], [115, "\t\t\tfinal OutputStream os = new FileOutputStream(output2);"], [116, "\t\t\tfinal ArchiveOutputStream aos = new ArchiveStreamFactory().createArchiveOutputStream(\"ar\", os);"], [117, "\t\t\tfinal ArchiveInputStream ais = new ArchiveStreamFactory().createArchiveInputStream(new BufferedInputStream(is));"], [118, "\t\t\twhile(true) {"], [119, "\t\t\t\tfinal ArArchiveEntry entry = (ArArchiveEntry)ais.getNextEntry();"], [120, "\t\t\t\tif (entry == null) {"], [121, "\t\t\t\t\tbreak;"], [122, "\t\t\t\t}"], [123, ""], [124, "\t\t\t\tif (\"test1.xml\".equals(entry.getName())) {"], [125, "\t\t\t\t\taos.putArchiveEntry(entry);"], [126, "\t\t\t\t}"], [127, "\t\t\t}"], [128, "\t\t\tais.close();"], [129, "\t\t\taos.close();"], [130, "\t\t\tis.close();"], [131, "\t\t\tos.close();"], [132, "\t\t}"], [133, ""], [134, ""], [135, "\t\tlong sum = 0;"], [136, ""], [137, "\t\t{"], [138, "\t\t\tfinal InputStream is = new FileInputStream(output2);"], [139, "\t\t\tfinal ArchiveInputStream ais = new ArchiveStreamFactory().createArchiveInputStream(is);"], [140, "\t\t\twhile(true) {"], [141, "\t\t\t\tfinal ArArchiveEntry entry = (ArArchiveEntry)ais.getNextEntry();"], [142, "\t\t\t\tif (entry == null) {"], [143, "\t\t\t\t\tbreak;"], [144, "\t\t\t\t}"], [145, ""], [146, "\t\t\t\tfinal ByteArrayOutputStream os = new ByteArrayOutputStream();"], [147, "\t\t        IOUtils.copy(ais, os);"], [148, ""], [149, "\t\t        sum +=  entry.getLength();"], [150, "\t\t\t}"], [151, "\t\t\tais.close();"], [152, "\t\t\tis.close();"], [153, "\t\t}"], [154, ""], [155, "\t\tassertEquals(0, sum);"], [156, ""], [157, "\t}"], [158, ""]], "deleted": [[30, "import org.apache.commons.compress.AbstractTestCase;"], [31, ""], [74, "\t\tfinal ArchiveInputStream in = new ArchiveStreamFactory().createArchiveInputStream(\"ar\", is);"]]}, "num_lines_added": 75, "num_lines_removed": 3}