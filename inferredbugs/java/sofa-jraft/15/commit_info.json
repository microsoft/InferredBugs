{"hash": "802310d478c31f48f1c4a1987951a4187de3a9de", "message": "(fix) https://github.com/alipay/sofa-jraft/issues/65 (fix) #65 (#67)\n\n* (fix) https://github.com/alipay/sofa-jraft/issues/65\r\n\r\n* (fix) optimize 'truncate log'  https://github.com/alipay/sofa-jraft/issues/65\r\n\r\n* (fix) typo and expose removeRange method\r\n\r\n* (fix) avoid unnecessary array copy\r\n\r\n* (fix) add fail status message\r\n\r\n* (fix) typo\r\n\r\n* (fix) minor fix", "file_num_lines": 171, "diff_parsed": {"added": [[34, "import com.alipay.sofa.jraft.util.ArrayDeque;"], [47, "    private static final Logger      LOG                = LoggerFactory.getLogger(BallotBox.class);"], [49, "    private FSMCaller                waiter;"], [50, "    private ClosureQueue             closureQueue;"], [51, "    private final StampedLock        stampedLock        = new StampedLock();"], [52, "    private long                     lastCommittedIndex = 0;"], [53, "    private long                     pendingIndex;"], [54, "    private final ArrayDeque<Ballot> pendingMetaQueue   = new ArrayDeque<>();"], [62, "    ArrayDeque<Ballot> getPendingMetaQueue() {"], [129, "            pendingMetaQueue.removeRange(0, (int) (lastCommittedIndex - pendingIndex) + 1);"], [130, "            LOG.debug(\"Committed log fromIndex={}, toIndex={}.\", pendingIndex, lastCommittedIndex);"]], "deleted": [[34, "import com.alipay.sofa.jraft.util.ArrayDequeue;"], [47, "    private static final Logger        LOG                = LoggerFactory.getLogger(BallotBox.class);"], [49, "    private FSMCaller                  waiter;"], [50, "    private ClosureQueue               closureQueue;"], [51, "    private final StampedLock          stampedLock        = new StampedLock();"], [52, "    private long                       lastCommittedIndex = 0;"], [53, "    private long                       pendingIndex;"], [54, "    private final ArrayDequeue<Ballot> pendingMetaQueue   = new ArrayDequeue<>();"], [62, "    ArrayDequeue<Ballot> getPendingMetaQueue() {"], [129, "            for (long index = pendingIndex; index <= lastCommittedIndex; index++) {"], [130, "                pendingMetaQueue.pollFirst();"], [131, "                LOG.debug(\"Committed log index={}\", index);"], [132, "            }"]]}, "num_lines_added": 11, "num_lines_removed": 13}