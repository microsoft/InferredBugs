{"hash": "b101f1790697a1108c5df9ef8809ab42f50ecfc7", "message": "fix timer's thread leak (#279)\n\n* (feat) fix timer's worker thread leak\r\n\r\n* (feat) log\r\n\r\n* (feat) for travis conf\r\n\r\n* (feat) unit test\r\n\r\n* (feat) unit test\r\n\r\n* (feat) final code format\r\n\r\n* (feat) unit test\r\n\r\n* (feat) wait time for teardown\r\n\r\n* (feat) revert default log storage to be RocksDBLogStorage (#280)\r\n\r\n* (feat) code format (#277)\r\n\r\n* (feat) travis_retry\r\n\r\n* (feat) travis_retry\r\n\r\n* (feat) forgot `join`\r\n\r\n* (feat) destroy timer out of lock to avoid block\r\n\r\n* (feat) method name\r\n\r\n* (feat) ut: join fsm shutdown", "file_num_lines": 2486, "diff_parsed": {"added": [[2338, "        List<RepeatedTimer> timers = null;"], [2351, "                // Stop all timers"], [2352, "                timers = stopAllTimers();"], [2403, ""], [2404, "            // Destroy all timers out of lock"], [2405, "            if (timers != null) {"], [2406, "                destroyAllTimers(timers);"], [2407, "            }"], [2408, "        }"], [2409, "    }"], [2410, ""], [2411, "    // Should in lock"], [2412, "    private List<RepeatedTimer> stopAllTimers() {"], [2413, "        final List<RepeatedTimer> timers = new ArrayList<>();"], [2414, "        if (this.electionTimer != null) {"], [2415, "            this.electionTimer.stop();"], [2416, "            timers.add(this.electionTimer);"], [2417, "        }"], [2418, "        if (this.voteTimer != null) {"], [2419, "            this.voteTimer.stop();"], [2420, "            timers.add(this.voteTimer);"], [2421, "        }"], [2422, "        if (this.stepDownTimer != null) {"], [2423, "            this.stepDownTimer.stop();"], [2424, "            timers.add(this.stepDownTimer);"], [2425, "        }"], [2426, "        if (this.snapshotTimer != null) {"], [2427, "            this.snapshotTimer.stop();"], [2428, "            timers.add(this.snapshotTimer);"], [2429, "        }"], [2430, "        return timers;"], [2431, "    }"], [2432, ""], [2433, "    private void destroyAllTimers(final List<RepeatedTimer> timers) {"], [2434, "        for (final RepeatedTimer timer : timers) {"], [2435, "            timer.destroy();"]], "deleted": [[2350, "                // Destroy all timers"], [2351, "                if (this.electionTimer != null) {"], [2352, "                    this.electionTimer.destroy();"], [2353, "                }"], [2354, "                if (this.voteTimer != null) {"], [2355, "                    this.voteTimer.destroy();"], [2356, "                }"], [2357, "                if (this.stepDownTimer != null) {"], [2358, "                    this.stepDownTimer.destroy();"], [2359, "                }"], [2360, "                if (this.snapshotTimer != null) {"], [2361, "                    this.snapshotTimer.destroy();"], [2362, "                }"]]}, "num_lines_added": 36, "num_lines_removed": 13}