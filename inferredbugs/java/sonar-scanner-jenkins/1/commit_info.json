{"hash": "112c4ff2510fb940ae3cd85a831be531395d4660", "message": "Improve integration tests and quality", "file_num_lines": 290, "diff_parsed": {"added": [[36, "import hudson.plugins.sonar.utils.BuilderUtils;"], [37, ""], [227, "    EnvVars env = BuilderUtils.getEnvAndBuildVars(run, listener);"], [233, "      sri = BuilderUtils.getBuildTool(sri, env, listener);"], [299, "    int r = launcher.launch().cmds(args).envs(env).stdout(listener).pwd(BuilderUtils.getModuleRoot(build, workspace)).join();"], [323, "      Computer computer = Computer.currentComputer();"], [363, "    FilePath moduleRoot = BuilderUtils.getModuleRoot(build, workspace);"], [369, "      FilePath projectSettingsFilePath = BuilderUtils.getModuleRoot(build, workspace).child(projectSettingsFile);"]], "deleted": [[225, "    EnvVars env = run.getEnvironment(listener);"], [226, "    if (run instanceof AbstractBuild) {"], [227, "      env.overrideAll(((AbstractBuild<?, ?>) run).getBuildVariables());"], [228, "    }"], [234, "      sri = sri.forNode(getComputer(workspace).getNode(), listener);"], [235, "      sri = sri.forEnvironment(env);"], [271, "  private static Computer getComputer(FilePath ws) {"], [272, "    Computer computer = null;"], [273, "    for (Computer c : Jenkins.getInstance().getComputers()) {"], [274, "      if (c.getChannel() == ws.getChannel()) {"], [275, "        computer = c;"], [276, "        break;"], [277, "      }"], [278, "    }"], [279, "    return computer;"], [280, "  }"], [281, ""], [312, "    int r = launcher.launch().cmds(args).envs(env).stdout(listener).pwd(getModuleRoot(build, workspace)).join();"], [324, "  private static FilePath getModuleRoot(Run<?, ?> run, FilePath workspace) {"], [325, "    FilePath moduleRoot = null;"], [326, "    if (run instanceof AbstractBuild) {"], [327, "      AbstractBuild<?, ?> build = (AbstractBuild<?, ?>) run;"], [328, "      moduleRoot = build.getModuleRoot();"], [329, "    } else {"], [330, "      // otherwise get the first module of the first SCM"], [331, "      Object parent = run.getParent();"], [332, "      if (parent instanceof SCMTriggerItem) {"], [333, "        SCMTriggerItem scmTrigger = (SCMTriggerItem) parent;"], [334, "        Collection<? extends SCM> scms = scmTrigger.getSCMs();"], [335, "        if (scms != null && !scms.isEmpty()) {"], [336, "          SCM scm = scms.iterator().next();"], [337, "          FilePath[] moduleRoots = scm.getModuleRoots(workspace, null);"], [338, "          moduleRoot = moduleRoots != null && moduleRoots.length > 0 ? moduleRoots[0] : null;"], [339, "        }"], [340, "      }"], [341, "      if (moduleRoot == null) {"], [342, "        moduleRoot = workspace;"], [343, "      }"], [344, "    }"], [345, "    return moduleRoot;"], [346, "  }"], [347, ""], [360, "      Computer computer = getComputer(workspace);"], [400, "    FilePath moduleRoot = getModuleRoot(build, workspace);"], [406, "      FilePath projectSettingsFilePath = getModuleRoot(build, workspace).child(projectSettingsFile);"]]}, "num_lines_added": 8, "num_lines_removed": 45}