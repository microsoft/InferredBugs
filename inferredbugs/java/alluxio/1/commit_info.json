{"hash": "0e6edf9e16d5d9f319d5fe93a6cc3d35c71eb5fc", "message": "Fix recovery dataset counter after rm operation", "file_num_lines": 512, "diff_parsed": {"added": [[273, "      dataset.mId = - dataset.mId;"], [557, "      if (maxDatasetId != mDatasetCounter.get() && mDatasetCounter.get() != 0) {"], [558, "        DatasetInfo tempDataset = new DatasetInfo();"], [559, "        tempDataset.mId = - mDatasetCounter.get();"], [560, "        checkpointWriter.appendAndFlush(tempDataset);"], [582, "  private void recoveryFromFile(String fileName, String msg) {"], [584, ""], [585, "    File file = new File(fileName);"], [586, "    if (!file.exists()) {"], [587, "      LOG.info(msg + fileName + \" does not exist.\");"], [588, "    } else {"], [589, "      reader = new MasterLogReader(fileName);"], [590, "      while (reader.hasNext()) {"], [591, "        DatasetInfo dataset = reader.getNextDatasetInfo();"], [592, "        if (Math.abs(dataset.mId) > mDatasetCounter.get()) {"], [593, "          mDatasetCounter.set(Math.abs(dataset.mId));"], [594, "        }"], [595, ""], [596, "        System.out.println(\"Putting \" + dataset);"], [597, "        if (dataset.mId > 0) {"], [600, "        } else {"], [601, "          mDatasets.remove(- dataset.mId);"], [602, "          mDatasetPathToId.remove(dataset.mPath);"], [605, "    }"], [606, "  }"], [608, "  private void recoveryFromLog() {"], [609, "    synchronized (mDatasets) {"], [610, "      recoveryFromFile(Config.MASTER_CHECKPOINT_FILE, \"Master Checkpoint file \");"], [611, "      recoveryFromFile(Config.MASTER_LOG_FILE, \"Master Log file \");"]], "deleted": [[273, "      dataset.mId = -dataset.mId;"], [557, "      if (maxDatasetId > 0) {"], [558, "        mDatasetCounter.set(maxDatasetId);"], [580, "  private void recoveryFromLog() {"], [582, "    synchronized (mDatasets) {"], [583, "      File file = new File(Config.MASTER_CHECKPOINT_FILE);"], [584, "      if (!file.exists()) {"], [585, "        LOG.info(\"Master Checkpoint file \" + Config.MASTER_CHECKPOINT_FILE + \" does not exist.\");"], [586, "      } else {"], [587, "        reader = new MasterLogReader(Config.MASTER_CHECKPOINT_FILE);"], [588, "        while (reader.hasNext()) {"], [589, "          DatasetInfo dataset = reader.getNextDatasetInfo();"], [595, "      file = new File(Config.MASTER_LOG_FILE);"], [596, "      if (!file.exists()) {"], [597, "        LOG.info(\"Master Log file \" + Config.MASTER_LOG_FILE + \" does not exist.\");"], [598, "      } else {"], [599, "        reader = new MasterLogReader(Config.MASTER_LOG_FILE);"], [600, "        while (reader.hasNext()) {"], [601, "          DatasetInfo dataset = reader.getNextDatasetInfo();"], [602, "          if (dataset.mId > 0) {"], [603, "            mDatasets.put(dataset.mId, dataset);"], [604, "            mDatasetPathToId.put(dataset.mPath, dataset.mId);"], [605, "          } else {"], [606, "            mDatasets.remove(-dataset.mId);"], [607, "            mDatasetPathToId.remove(dataset.mPath);"], [608, "          }"], [609, "        }"], [610, "      }"]]}, "num_lines_added": 29, "num_lines_removed": 28}