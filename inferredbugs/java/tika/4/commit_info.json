{"hash": "810b1d4d780ad045c2a40a5b51d3dc9aadc9fcca", "message": "TIKA-45 - RereadableInputStream needs to be able to read to the end of the original stream on first rewind\n    - Committed patch from Keith Bennett\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/tika/trunk@582698 13f79535-47bb-0310-9956-ffa450edef68", "file_num_lines": 69, "diff_parsed": {"added": [[40, "        InputStream is = createTestInputStream();"], [54, "            // The RereadableInputStream should close the original input"], [55, "            // stream (if it hasn't already)."], [60, "    /**"], [61, "     * Test that the constructor's readToEndOfStreamOnFirstRewind parameter"], [62, "     * correctly determines the behavior."], [63, "     *"], [64, "     * @throws IOException"], [65, "     */"], [66, "    public void testRewind() throws IOException {"], [67, "        doTestRewind(true);"], [68, "        doTestRewind(false);"], [69, "    }"], [70, ""], [71, "    private void doTestRewind(boolean readToEndOnRewind) throws IOException {"], [72, ""], [73, "        RereadableInputStream ris = null;"], [74, ""], [75, "        try {"], [76, "            InputStream s1 = createTestInputStream();"], [77, "            ris = new RereadableInputStream(s1, 5, readToEndOnRewind);"], [78, "            ris.read();"], [79, "            assertEquals(1, ris.getSize());"], [80, "            ris.rewind();"], [81, "            boolean moreBytesWereRead = (ris.getSize() > 1);"], [82, "            if (readToEndOnRewind) {"], [83, "                assertTrue(moreBytesWereRead);"], [84, "            } else {"], [85, "                assertFalse(moreBytesWereRead);"], [86, "            }"], [87, "        } finally {"], [88, "            if (ris != null) {"], [89, "                ris.close();"], [90, "            }"], [91, "        }"], [92, ""], [93, "    }"], [94, ""], [95, "    private InputStream createTestInputStream() throws IOException {"], [96, "        return new BufferedInputStream(new FileInputStream(createTestFile()));"], [97, "    }"], [98, ""], [101, "        testfile.deleteOnExit();"]], "deleted": [[40, "        File file = createTestFile();"], [41, "        InputStream is = new BufferedInputStream(new FileInputStream(file));"], [55, "            is.close();"]]}, "num_lines_added": 43, "num_lines_removed": 3}