{"hash": "07261a3951caec003c00d714a7b5097168d586e3", "message": "METR-20494: clean connections", "file_num_lines": 72, "diff_parsed": {"added": [[8, "import java.util.Map;"], [10, "import java.util.Set;"], [11, "import java.util.WeakHashMap;"], [12, "import java.util.concurrent.Executors;"], [13, "import java.util.concurrent.ScheduledExecutorService;"], [14, "import java.util.concurrent.TimeUnit;"], [32, "    private Map<CHConnectionImpl, Boolean> connections = new WeakHashMap<CHConnectionImpl, Boolean>();"], [33, ""], [34, "    private ScheduledExecutorService connectionsCleaner = Executors.newSingleThreadScheduledExecutor();"], [35, ""], [36, "    CHDriver(){"], [37, "        // https://hc.apache.org/httpcomponents-client-4.5.x/tutorial/html/connmgmt.html#d5e418"], [38, "        connectionsCleaner.scheduleAtFixedRate(new Runnable() {"], [39, "            @Override"], [40, "            public void run() {"], [41, "                for (CHConnectionImpl connection : connections.keySet()) {"], [42, "                    connection.cleanConnections();"], [43, "                }"], [44, "            }"], [45, "        }, 0, 5, TimeUnit.SECONDS);"], [46, "    }"], [47, ""], [61, "        CHConnectionImpl connection = new CHConnectionImpl(url, info);"], [62, "        connections.put(connection, true);"], [63, "        return LogProxy.wrap(CHConnection.class, connection);"], [68, "        CHConnectionImpl connection = new CHConnectionImpl(url, properties);"], [69, "        connections.put(connection, true);"], [70, "        return LogProxy.wrap(CHConnection.class, connection);"]], "deleted": [[39, "        return LogProxy.wrap(CHConnection.class, new CHConnectionImpl(url, info));"], [44, "        return LogProxy.wrap(CHConnection.class, new CHConnectionImpl(url, properties));"]]}, "num_lines_added": 28, "num_lines_removed": 2}