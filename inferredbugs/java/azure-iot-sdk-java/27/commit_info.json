{"hash": "2652a4aad237498640d93cba83ff726298addbd1", "message": "fix(e2e): Fix transportclient tests not waiting for devices to subscribe to methods before invoking methods (#821)\n\nsubscribeToDeviceMethod(...) is asynchronous (with a callback), but it was being used as if it was synchronous", "file_num_lines": 872, "diff_parsed": {"added": [[72, "    private static final long METHOD_SUBSCRIBE_TIMEOUT_MILLISECONDS = 15 * 1000; // 15 seconds"], [368, "            DeviceMethodStatusCallBack subscribedCallback = new DeviceMethodStatusCallBack();"], [369, ""], [370, "            ((DeviceClient)testInstance.clientArrayList.get(i)).subscribeToDeviceMethod(new SampleDeviceMethodCallback(), null, subscribedCallback, null);"], [371, ""], [372, "            long startTime = System.currentTimeMillis();"], [373, "            while (!subscribedCallback.isSubscribed)"], [374, "            {"], [375, "                Thread.sleep(200);"], [376, ""], [377, "                if (System.currentTimeMillis() - startTime > METHOD_SUBSCRIBE_TIMEOUT_MILLISECONDS)"], [378, "                {"], [379, "                    fail(buildExceptionMessage(\"Timed out waiting for device to subscribe to methods\", testInstance.clientArrayList.get(i)));"], [380, "                }"], [381, "            }"], [406, "            DeviceMethodStatusCallBack subscribedCallback = new DeviceMethodStatusCallBack();"], [407, ""], [408, "            ((DeviceClient)testInstance.clientArrayList.get(i)).subscribeToDeviceMethod(new SampleDeviceMethodCallback(), null, subscribedCallback, null);"], [409, ""], [410, "            long startTime = System.currentTimeMillis();"], [411, "            while (!subscribedCallback.isSubscribed)"], [412, "            {"], [413, "                Thread.sleep(200);"], [414, ""], [415, "                if (System.currentTimeMillis() - startTime > METHOD_SUBSCRIBE_TIMEOUT_MILLISECONDS)"], [416, "                {"], [417, "                    fail(buildExceptionMessage(\"Timed out waiting for device to subscribe to methods\", testInstance.clientArrayList.get(i)));"], [418, "                }"], [419, "            }"], [748, "        public boolean isSubscribed = false;"], [749, ""], [753, "            isSubscribed = status == OK_EMPTY || status == OK;"]], "deleted": [[367, "            ((DeviceClient)testInstance.clientArrayList.get(i)).subscribeToDeviceMethod(new SampleDeviceMethodCallback(), null, new DeviceMethodStatusCallBack(), null);"], [392, "            ((DeviceClient)testInstance.clientArrayList.get(i)).subscribeToDeviceMethod(new SampleDeviceMethodCallback(), null, new DeviceMethodStatusCallBack(), null);"]]}, "num_lines_added": 32, "num_lines_removed": 2}