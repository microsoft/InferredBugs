{"hash": "b8bc80e037fa2161cb7f78c73cb0e274576008f9", "message": "GH-1156 Protect animals in the guild region (Resolve #1156)", "file_num_lines": 66, "diff_parsed": {"added": [[4, "import net.dzikoysk.funnyguilds.basic.guild.Region;"], [5, "import net.dzikoysk.funnyguilds.basic.guild.RegionUtils;"], [9, "import net.dzikoysk.funnyguilds.util.commons.bukkit.EntityUtils;"], [10, "import org.bukkit.entity.Animals;"], [13, "import org.bukkit.entity.Villager;"], [22, "        EntityUtils.getAttacker(event.getDamager()).peek(attacker -> {"], [23, "            PluginConfiguration config = FunnyGuilds.getInstance().getPluginConfiguration();"], [24, "            User attackerUser = User.get(attacker);"], [25, "            Entity victim = event.getEntity();"], [27, "            if (config.animalsProtection && (victim instanceof Animals || victim instanceof Villager)) {"], [28, "                RegionUtils.getAtOpt(victim.getLocation())"], [29, "                        .map(Region::getGuild)"], [30, "                        .filterNot(guild -> guild.equals(attackerUser.getGuild()))"], [31, "                        .peek(guild -> event.setCancelled(true));"], [33, "                return;"], [36, "            if (!(victim instanceof Player)) {"], [39, ""], [40, "            User victimUser = User.get((Player) event.getEntity());"], [41, ""], [42, "            if (victimUser.hasGuild() && attackerUser.hasGuild()) {"], [43, "                if (victimUser.getUUID().equals(attackerUser.getUUID())) {"], [46, ""], [47, "                if (victimUser.getGuild().equals(attackerUser.getGuild())) {"], [48, "                    if (!victimUser.getGuild().getPvP()) {"], [49, "                        event.setCancelled(true);"], [50, "                        return;"], [51, "                    }"], [54, "                if (victimUser.getGuild().getAllies().contains(attackerUser.getGuild())) {"], [55, "                    if (!config.damageAlly) {"], [56, "                        event.setCancelled(true);"], [57, "                        return;"], [58, "                    }"], [59, ""], [60, "                    if (! (attackerUser.getGuild().getPvP(victimUser.getGuild()) && victimUser.getGuild().getPvP(attackerUser.getGuild()))) {"], [61, "                        event.setCancelled(true);"], [62, "                        return;"], [63, "                    }"], [66, ""], [67, "            if (attacker.equals(victim)) {"], [70, ""], [71, "            if (config.assistEnable && !event.isCancelled()) {"], [72, "                if (PluginHook.isPresent(PluginHook.PLUGIN_WORLDGUARD) && PluginHook.WORLD_GUARD.isInIgnoredRegion(victim.getLocation())) {"], [73, "                    return;"], [74, "                }"], [75, ""], [76, "                victimUser.getCache().addDamage(attackerUser, event.getDamage());"], [77, "            }"], [78, "        });"]], "deleted": [[9, "import org.bukkit.entity.Projectile;"], [13, "import org.bukkit.projectiles.ProjectileSource;"], [19, "        Entity entity = event.getEntity();"], [20, "        Entity damager = event.getDamager();"], [22, "        if (! (entity instanceof Player)) {"], [23, "            return;"], [24, "        }"], [26, "        Player attacker = null;"], [27, ""], [28, "        if (damager instanceof Player) {"], [29, "            attacker = (Player) damager;"], [30, "        }"], [31, "        else if (damager instanceof Projectile) {"], [32, "            ProjectileSource shooter = ((Projectile) damager).getShooter();"], [33, ""], [34, "            if (shooter instanceof Player) {"], [35, "                attacker = (Player) shooter;"], [37, "        }"], [38, ""], [39, "        if (attacker == null) {"], [40, "            return;"], [41, "        }"], [42, ""], [43, "        PluginConfiguration config = FunnyGuilds.getInstance().getPluginConfiguration();"], [44, "        User victimUser = User.get((Player) event.getEntity());"], [45, "        User attackerUser = User.get(attacker);"], [47, "        if (victimUser.hasGuild() && attackerUser.hasGuild()) {"], [48, "            if (victimUser.getUUID().equals(attackerUser.getUUID())) {"], [51, ""], [52, "            if (victimUser.getGuild().equals(attackerUser.getGuild())) {"], [53, "                if (!victimUser.getGuild().getPvP()) {"], [54, "                    event.setCancelled(true);"], [57, "            }"], [58, ""], [59, "            if (victimUser.getGuild().getAllies().contains(attackerUser.getGuild())) {"], [60, "                if (!config.damageAlly) {"], [61, "                    event.setCancelled(true);"], [62, "                    return;"], [65, "                if (! (attackerUser.getGuild().getPvP(victimUser.getGuild()) && victimUser.getGuild().getPvP(attackerUser.getGuild()))) {"], [66, "                    event.setCancelled(true);"], [67, "                    return;"], [70, "        }"], [71, ""], [72, "        if (attacker.equals(entity)) {"], [73, "            return;"], [74, "        }"], [75, ""], [76, "        if (config.assistEnable && !event.isCancelled()) {"], [77, "            if (PluginHook.isPresent(PluginHook.PLUGIN_WORLDGUARD) && PluginHook.WORLD_GUARD.isInIgnoredRegion(entity.getLocation())) {"], [80, ""], [81, "            victimUser.getCache().addDamage(attackerUser, event.getDamage());"], [82, "        }"]]}, "num_lines_added": 48, "num_lines_removed": 52}