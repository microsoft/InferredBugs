{"hash": "e93a308acfc3e402b8d1e8080cdab005e381b2b0", "message": "Optimize ranked guild calculations in rank variable resolver\n\nWe're currently creating a collection of ranking guilds based on\nthe number of members in the guild each time the rank variable resolver\nis being used.\n\nThis change will speed up the rank variable resolver,\nbecause we won't be calculating the entire collection on every use -\ninstead we will be retrieving following guilds until they will\nmeet the given criteria.", "file_num_lines": 99, "diff_parsed": {"added": [[27, "            Guild guild;"], [28, "            int positionIdx = i;"], [30, "            do {"], [31, "                guild = RankManager.getInstance().getGuild(positionIdx++);"], [33, "                if (guild == null) {"], [34, "                    return StringUtils.replace(var, \"{GTOP-\" + i + '}', FunnyGuilds.getInstance().getMessageConfiguration().gtopNoValue);"], [37, "            while (guild.getMembers().size() < config.minMembersToInclude);"], [38, ""], [39, "            int points = guild.getRank().getPoints();"], [40, "            String pointsFormat = config.gtopPoints;"], [42, "            if (!pointsFormat.isEmpty()) {"], [43, "                pointsFormat = pointsFormat.replace(\"{POINTS-FORMAT}\", IntegerRange.inRange(points, config.pointsFormat, \"POINTS\"));"], [44, "                pointsFormat = pointsFormat.replace(\"{POINTS}\", String.valueOf(points));"], [47, "            String guildTag = guild.getTag();"], [49, "            if (config.playerListUseRelationshipColors) {"], [50, "                guildTag = StringUtils.replace(config.prefixOther, \"{TAG}\", guild.getTag());"], [52, "                if (source != null && source.hasGuild()) {"], [53, "                    Guild sourceGuild = source.getGuild();"], [55, "                    if (sourceGuild.getAllies().contains(guild)) {"], [56, "                        guildTag = StringUtils.replace(config.prefixAllies, \"{TAG}\", guild.getTag());"], [57, "                    }"], [58, "                    else if (sourceGuild.getUUID().equals(guild.getUUID())) {"], [59, "                        guildTag = StringUtils.replace(config.prefixOur, \"{TAG}\", guild.getTag());"], [63, ""], [64, "            return StringUtils.replace(var, \"{GTOP-\" + i + '}', guildTag + pointsFormat);"], [65, ""], [70, "            if (user == null) {"], [71, "                return StringUtils.replace(var, \"{PTOP-\" + i + '}', FunnyGuilds.getInstance().getMessageConfiguration().ptopNoValue);"], [72, "            }"], [74, "            int points = user.getRank().getPoints();"], [75, "            String pointsFormat = config.ptopPoints;"], [77, "            if (!pointsFormat.isEmpty()) {"], [78, "                pointsFormat = pointsFormat.replace(\"{POINTS-FORMAT}\", IntegerRange.inRange(points, config.pointsFormat, \"POINTS\"));"], [79, "                pointsFormat = pointsFormat.replace(\"{POINTS}\", String.valueOf(points));"], [81, ""], [82, "            return StringUtils.replace(var, \"{PTOP-\" + i + '}', (user.isOnline() ? config.ptopOnline : config.ptopOffline) + user.getName() + pointsFormat);"]], "deleted": [[10, "import java.util.ArrayList;"], [11, "import java.util.List;"], [12, ""], [30, "            List<Guild> rankedGuilds = new ArrayList<>();"], [32, "            for (int in = 1; in <= RankManager.getInstance().guilds(); in++) {"], [33, "                Guild guild = RankManager.getInstance().getGuild(in);"], [35, "                if (guild != null && guild.getMembers().size() >= config.minMembersToInclude) {"], [36, "                    rankedGuilds.add(guild);"], [40, "            if (rankedGuilds.isEmpty() || i - 1 >= rankedGuilds.size()) {"], [41, "                return StringUtils.replace(var, \"{GTOP-\" + i + '}', FunnyGuilds.getInstance().getMessageConfiguration().gtopNoValue);"], [43, "            else {"], [44, "                Guild guild = rankedGuilds.get(i - 1);"], [45, "                int points = guild.getRank().getPoints();"], [46, "                String pointsFormat = config.gtopPoints;"], [47, ""], [48, "                if (!pointsFormat.isEmpty()) {"], [49, "                    pointsFormat = pointsFormat.replace(\"{POINTS-FORMAT}\", IntegerRange.inRange(points, config.pointsFormat, \"POINTS\"));"], [50, "                    pointsFormat = pointsFormat.replace(\"{POINTS}\", String.valueOf(points));"], [51, "                }"], [53, "                String guildTag = guild.getTag();"], [55, "                if (config.playerListUseRelationshipColors) {"], [56, "                    guildTag = StringUtils.replace(config.prefixOther, \"{TAG}\", guild.getTag());"], [58, "                    if (source != null && source.hasGuild()) {"], [59, "                        Guild sourceGuild = source.getGuild();"], [61, "                        if (sourceGuild.getAllies().contains(guild)) {"], [62, "                            guildTag = StringUtils.replace(config.prefixAllies, \"{TAG}\", guild.getTag());"], [63, "                        }"], [64, "                        else if (sourceGuild.getUUID().equals(guild.getUUID())) {"], [65, "                            guildTag = StringUtils.replace(config.prefixOur, \"{TAG}\", guild.getTag());"], [66, "                        }"], [69, ""], [70, "                return StringUtils.replace(var, \"{GTOP-\" + i + '}', guildTag + pointsFormat);"], [76, "            if (user != null) {"], [77, "                int points = user.getRank().getPoints();"], [78, "                String pointsFormat = config.ptopPoints;"], [80, "                if (!pointsFormat.isEmpty()) {"], [81, "                    pointsFormat = pointsFormat.replace(\"{POINTS-FORMAT}\", IntegerRange.inRange(points, config.pointsFormat, \"POINTS\"));"], [82, "                    pointsFormat = pointsFormat.replace(\"{POINTS}\", String.valueOf(points));"], [83, "                }"], [85, "                return StringUtils.replace(var, \"{PTOP-\" + i + '}', (user.isOnline() ? config.ptopOnline : config.ptopOffline) + user.getName() + pointsFormat);"], [86, "            }"], [87, "            else {"], [88, "                return StringUtils.replace(var, \"{PTOP-\" + i + '}', FunnyGuilds.getInstance().getMessageConfiguration().ptopNoValue);"]]}, "num_lines_added": 36, "num_lines_removed": 43}