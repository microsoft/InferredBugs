{"hash": "8a7ab09133711fa0b1bde6049bd8531599d2e880", "message": "Added support for keyfiles", "file_num_lines": 148, "diff_parsed": {"added": [[7, "import java.io.UnsupportedEncodingException;"], [13, "import org.bouncycastle.util.encoders.Base64;"], [14, ""], [18, "import de.slackspace.openkeepass.crypto.Sha256;"], [23, "import de.slackspace.openkeepass.domain.KeyFile;"], [25, "import de.slackspace.openkeepass.parser.KeePassDatabaseXmlParser;"], [26, "import de.slackspace.openkeepass.parser.KeyFileXmlParser;"], [47, "\tprotected Decrypter decrypter = new Decrypter();"], [48, "\tprotected KeePassDatabaseXmlParser keePassDatabaseXmlParser = new KeePassDatabaseXmlParser();"], [49, "\tprotected KeyFileXmlParser keyFileXmlParser = new KeyFileXmlParser();"], [50, ""], [126, "\t\t\tbyte[] passwordBytes = password.getBytes(\"UTF-8\");"], [127, "\t\t\tbyte[] hashedPassword = Sha256.hash(passwordBytes);"], [128, ""], [129, "\t\t\treturn decryptAndParseDatabase(hashedPassword);"], [130, "\t\t} catch (UnsupportedEncodingException e) {"], [131, "\t\t\tthrow new UnsupportedOperationException(\"The encoding UTF-8 is not supported\");"], [132, "\t\t}"], [133, "\t}"], [134, ""], [135, "\tpublic KeePassFile openDatabase(InputStream keyFileStream) {"], [136, "\t\ttry {"], [137, "\t\t\tKeyFile keyFile = keyFileXmlParser.parse(keyFileStream);"], [138, "\t\t\tbyte[] protectedBuffer = Base64.decode(keyFile.getKey().getData().getBytes(\"UTF-8\"));"], [139, ""], [140, "\t\t\treturn decryptAndParseDatabase(protectedBuffer);"], [141, "\t\t} catch (UnsupportedEncodingException e) {"], [142, "\t\t\tthrow new UnsupportedOperationException(\"The encoding UTF-8 is not supported\");"], [143, "\t\t}"], [144, "\t}"], [145, ""], [146, "\tprivate KeePassFile decryptAndParseDatabase(byte[] key) {"], [147, "\t\ttry {"], [148, "\t\t\tbyte[] aesDecryptedDbFile = decrypter.decryptDatabase(key, keepassHeader, keepassFile);"], [178, "\t\t\treturn keePassDatabaseXmlParser.parse(new ByteArrayInputStream(decompressed), protectedStringCrypto);"]], "deleted": [[20, "import de.slackspace.openkeepass.parser.XmlParser;"], [39, "\tprivate Decrypter decrypter = new Decrypter();"], [40, "\tprivate XmlParser xmlParser = new XmlParser();"], [118, "\t\t\tbyte[] aesDecryptedDbFile = decrypter.decryptDatabase(password, keepassHeader, keepassFile);"], [148, "\t\t\treturn xmlParser.parse(new ByteArrayInputStream(decompressed), protectedStringCrypto);"]]}, "num_lines_added": 35, "num_lines_removed": 5}