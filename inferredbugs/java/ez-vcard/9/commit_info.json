{"hash": "4bc6557d9592af872d9c6e9b5d77c02485b39647", "message": "Refactored the nested vCard code in \"AgentType\" to be more generic.  Any type class can now have a nested vCard as its value by throwing a \"EmbeddedVCardException\" from its marshal/unmarshal methods.", "file_num_lines": 75, "diff_parsed": {"added": [[9, "import ezvcard.io.EmbeddedVCardException;"], [10, "import ezvcard.io.SkipMeException;"], [149, "\t\t} else if (vcard != null) {"], [150, "\t\t\tthrow new EmbeddedVCardException(vcard);"], [152, "\t\t\tthrow new SkipMeException(\"Property has neither a URL nor an embedded vCard.\");"], [159, "\t\t\tsetUrl(VCardStringUtils.unescape(value));"], [161, "\t\t\t//instruct the marshaller to look for an embedded vCard"], [162, "\t\t\tthrow new EmbeddedVCardException(new EmbeddedVCardException.InjectionCallback() {"], [163, "\t\t\t\tpublic void injectVCard(VCard vcard) {"], [164, "\t\t\t\t\tsetVcard(vcard);"], [165, "\t\t\t\t}"], [166, "\t\t\t});"]], "deleted": [[3, "import java.io.IOException;"], [4, "import java.io.StringReader;"], [5, "import java.io.StringWriter;"], [12, "import ezvcard.io.VCardReader;"], [13, "import ezvcard.io.VCardWriter;"], [150, "\t\t//VCardWriter handles 2.1 AGENT types that have an embedded vCard."], [151, "\t\t//this method will not be called for these instances"], [152, ""], [156, "\t\t\tStringWriter sw = new StringWriter();"], [157, "\t\t\tVCardWriter writer = new VCardWriter(sw, version, null, \"\\n\");"], [158, "\t\t\twriter.setCompatibilityMode(compatibilityMode);"], [159, "\t\t\twriter.setAddGenerator(false);"], [160, "\t\t\ttry {"], [161, "\t\t\t\twriter.write(vcard);"], [162, "\t\t\t} catch (IOException e) {"], [163, "\t\t\t\t//never thrown because we're writing to a string"], [164, "\t\t\t}"], [165, "\t\t\tString str = sw.toString();"], [166, ""], [167, "\t\t\tfor (String w : writer.getWarnings()) {"], [168, "\t\t\t\twarnings.add(\"AGENT marshal warning: \" + w);"], [169, "\t\t\t}"], [170, ""], [171, "\t\t\tsb.append(VCardStringUtils.escapeText(str));"], [177, "\t\tvalue = VCardStringUtils.unescape(value);"], [178, ""], [180, "\t\t\turl = value;"], [182, "\t\t\tVCardReader reader = new VCardReader(new StringReader(value));"], [183, "\t\t\treader.setCompatibilityMode(compatibilityMode);"], [184, "\t\t\ttry {"], [185, "\t\t\t\tvcard = reader.readNext();"], [186, "\t\t\t} catch (IOException e) {"], [187, "\t\t\t\t//reading from a string"], [188, "\t\t\t}"], [189, "\t\t\tfor (String w : reader.getWarnings()) {"], [190, "\t\t\t\twarnings.add(\"AGENT unmarshal warning: \" + w);"], [191, "\t\t\t}"], [194, ""]]}, "num_lines_added": 12, "num_lines_removed": 38}