{"hash": "4bc6557d9592af872d9c6e9b5d77c02485b39647", "message": "Refactored the nested vCard code in \"AgentType\" to be more generic.  Any type class can now have a nested vCard as its value by throwing a \"EmbeddedVCardException\" from its marshal/unmarshal methods.", "file_num_lines": 60, "diff_parsed": {"added": [[4, "import static org.junit.Assert.assertNull;"], [5, "import static org.junit.Assert.fail;"], [16, "import ezvcard.io.EmbeddedVCardException;"], [17, "import ezvcard.parameters.ValueParameter;"], [60, "\t\t//with URL"], [61, "\t\tt = new AgentType(\"http://mi5.co.uk/007\");"], [62, "\t\texpected = \"http://mi5.co.uk/007\";"], [65, ""], [66, "\t\t//with vCard"], [67, "\t\tVCard vcard = new VCard();"], [68, "\t\tt = new AgentType(vcard);"], [69, "\t\ttry {"], [70, "\t\t\tt.marshalValue(version, warnings, compatibilityMode);"], [71, "\t\t\tfail();"], [72, "\t\t} catch (EmbeddedVCardException e) {"], [73, "\t\t\t//should be thrown"], [74, "\t\t\tassertEquals(vcard, e.getVCard());"], [75, "\t\t}"], [83, "\t\tVCardSubTypes subTypes;"], [86, "\t\t//with URL"], [87, "\t\tt = new AgentType();"], [88, "\t\tsubTypes = new VCardSubTypes();"], [89, "\t\tsubTypes.setValue(ValueParameter.URL);"], [90, "\t\tt.unmarshalValue(subTypes, \"http://mi5.co.uk/007\", version, warnings, compatibilityMode);"], [91, "\t\tassertEquals(\"http://mi5.co.uk/007\", t.getUrl());"], [92, "\t\tassertNull(t.getVcard());"], [93, ""], [94, "\t\t//with vCard"], [95, "\t\tVCard vcard = new VCard();"], [97, "\t\tsubTypes = new VCardSubTypes();"], [98, "\t\ttry {"], [99, "\t\t\tt.unmarshalValue(subTypes, \"BEGIN:VCARD\\\\nEND:VCARD\", version, warnings, compatibilityMode);"], [100, "\t\t\tfail();"], [101, "\t\t} catch (EmbeddedVCardException e) {"], [102, "\t\t\t//should be thrown"], [103, "\t\t\te.injectVCard(vcard);"], [104, "\t\t}"], [105, "\t\tassertNull(t.getUrl());"], [106, "\t\tassertEquals(vcard, t.getVcard());"]], "deleted": [[4, "import static org.junit.Assert.assertTrue;"], [15, "import ezvcard.parameters.EmailTypeParameter;"], [52, "\t\t//Note: Marshalling of 2.1 AGENT types is tested in VCardWriterTest"], [59, "\t\tVCard agentVcard = new VCard();"], [60, "\t\tagentVcard.setFormattedName(new FormattedNameType(\"Agent 007\"));"], [61, "\t\tEmailType agentEmail = new EmailType(\"007@mi5.co.uk\");"], [62, "\t\tagentEmail.addType(EmailTypeParameter.INTERNET);"], [63, "\t\tagentVcard.getEmails().add(agentEmail);"], [64, "\t\tt = new AgentType(agentVcard);"], [65, ""], [66, "\t\tVCard agentVcard2 = new VCard();"], [67, "\t\tagentVcard2.setFormattedName(new FormattedNameType(\"Agent 009\"));"], [68, "\t\tEmailType agentEmail2 = new EmailType(\"009@mi5.co.uk\");"], [69, "\t\tagentEmail2.addType(EmailTypeParameter.INTERNET);"], [70, "\t\tagentVcard2.getEmails().add(agentEmail2);"], [71, "\t\tagentVcard.setAgent(new AgentType(agentVcard2));"], [72, ""], [73, "\t\t//FIXME this test may fail on other machines because Class.getDeclaredFields() returns the fields in no particular order"], [74, "\t\t//@formatter:off"], [75, "\t\tStringBuilder sb = new StringBuilder();"], [76, "\t\tsb.append(\"BEGIN:VCARD\\n\");"], [77, "\t\tsb.append(\"VERSION:3.0\\n\");"], [78, "\t\tsb.append(\"FN:Agent 007\\n\");"], [79, "\t\tsb.append(\"EMAIL\\\\;TYPE=internet:007@mi5.co.uk\\n\");"], [80, "\t\tsb.append(\"AGENT:\");"], [81, "\t\t\tsb.append(\"BEGIN:VCARD\\\\\\\\n\");"], [82, "\t\t\tsb.append(\"VERSION:3.0\\\\\\\\n\");"], [83, "\t\t\tsb.append(\"FN:Agent 009\\\\\\\\n\");"], [84, "\t\t\tsb.append(\"EMAIL\\\\\\\\\\\\;TYPE=internet:009@mi5.co.uk\\\\\\\\n\");"], [85, "\t\t\tsb.append(\"END:VCARD\\\\\\\\n\\n\");"], [86, "\t\tsb.append(\"END:VCARD\\n\");"], [87, "\t\t//@formatter:on"], [88, ""], [89, "\t\texpected = sb.toString();"], [96, "\t\t//Note: Marshalling of 2.1 AGENT types is tested in VCardWriterTest"], [97, ""], [101, "\t\tVCardSubTypes subTypes = new VCardSubTypes();"], [104, "\t\t//@formatter:off"], [105, "\t\tStringBuilder sb = new StringBuilder();"], [106, "\t\tsb.append(\"BEGIN: VCARD\\\\n\");"], [107, "\t\tsb.append(\"VERSION: 3.0\\\\n\");"], [108, "\t\tsb.append(\"FN: Agent 007\\\\n\");"], [109, "\t\tsb.append(\"EMAIL\\\\;TYPE=internet: 007@mi5.co.uk\\\\n\");"], [110, "\t\tsb.append(\"AGENT: \");"], [111, "\t\t\tsb.append(\"BEGIN: VCARD\\\\\\\\n\");"], [112, "\t\t\tsb.append(\"VERSION: 3.0\\\\\\\\n\");"], [113, "\t\t\tsb.append(\"FN: Agent 009\\\\\\\\n\");"], [114, "\t\t\tsb.append(\"EMAIL\\\\\\\\\\\\;TYPE=internet: 009@mi5.co.uk\\\\\\\\n\");"], [115, "\t\t\tsb.append(\"END: VCARD\\\\\\\\n\\\\n\");"], [116, "\t\tsb.append(\"END: VCARD\\\\n\");"], [117, "\t\t//@formatter:on"], [118, ""], [120, "\t\tt.unmarshalValue(subTypes, sb.toString(), version, warnings, compatibilityMode);"], [121, "\t\tVCard agent1 = t.getVcard();"], [122, "\t\tassertEquals(\"Agent 007\", agent1.getFormattedName().getValue());"], [123, "\t\tassertEquals(\"007@mi5.co.uk\", agent1.getEmails().get(0).getValue());"], [124, "\t\tassertTrue(agent1.getEmails().get(0).getTypes().contains(EmailTypeParameter.INTERNET));"], [125, "\t\tVCard agent2 = agent1.getAgent().getVcard();"], [126, "\t\tassertEquals(\"Agent 009\", agent2.getFormattedName().getValue());"], [127, "\t\tassertEquals(\"009@mi5.co.uk\", agent2.getEmails().get(0).getValue());"], [128, "\t\tassertTrue(agent2.getEmails().get(0).getTypes().contains(EmailTypeParameter.INTERNET));"]]}, "num_lines_added": 39, "num_lines_removed": 61}