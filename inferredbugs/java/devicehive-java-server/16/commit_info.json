{"hash": "a9d9c6adacae9616f1cc99d824b15bd4637cce1d", "message": "OAuthGrantService fixes", "file_num_lines": 312, "diff_parsed": {"added": [[83, "        if (grant != null && user != null && grant.getUserId() == user.getId()) {"], [84, "            return restoreRefs(grant, user, null);"], [93, "        grant = restoreRefs(grant, null, null);"], [172, "            User user = oAuthGrant.getUser();"], [173, "            AccessKey accessKey = oAuthGrant.getAccessKey();"], [175, "            StoreValue storeOp = new StoreValue.Builder(removeRefs(oAuthGrant)).withLocation(location).build();"], [177, "            return restoreRefs(oAuthGrant, user, accessKey);"], [332, ""], [333, "    private OAuthGrant removeRefs(OAuthGrant grant) {"], [334, "        grant.setAccessKey(null);"], [335, "        grant.setUser(null);"], [336, "        return grant;"], [337, "    }"], [338, ""], [339, "    private OAuthGrant restoreRefs(OAuthGrant grant, User user, AccessKey accessKey) {"], [340, "        if (user != null) {"], [341, "            grant.setUser(user);"], [342, "        } else {"], [343, "            grant.setUser(userDao.find(grant.getUserId()));"], [344, "        }"], [345, "        if (accessKey != null) {"], [346, "            grant.setAccessKey(accessKey);"], [347, "        } else {"], [348, "            grant.setAccessKey(accessKeyDao.find(grant.getAccessKeyId()));"], [349, "        }"], [350, "        return grant;"], [351, "    }"]], "deleted": [[83, "        if (grant.getUser().equals(user)) {"], [84, "            return grant;"], [93, "        grant = updateRefs(grant);"], [97, "    private OAuthGrant updateRefs(OAuthGrant grant) {"], [98, "        if (grant == null) {"], [99, "            return null;"], [100, "        }"], [101, ""], [102, "        if (grant.getClient() != null) {"], [103, "            OAuthClient client = oAuthClientDao.find(grant.getClient().getId());"], [104, "            grant.setClient(client);"], [105, "        }"], [106, ""], [107, "        if (grant.getAccessKey() != null) {"], [108, "            AccessKey key = accessKeyDao.find(grant.getAccessKey().getId());"], [109, "            grant.setAccessKey(key);"], [110, "        }"], [111, ""], [112, "        if (grant.getUser() != null) {"], [113, "            User user = userDao.find(grant.getUser().getId());"], [114, "            grant.setUser(user);"], [115, "        }"], [116, "        return grant;"], [117, "    }"], [194, "            StoreValue storeOp = new StoreValue.Builder(oAuthGrant).withLocation(location).build();"], [196, "            return oAuthGrant;"]]}, "num_lines_added": 27, "num_lines_removed": 26}