{"hash": "17aa3f5f60c3a1fb7d1db03209dc9833034a01d8", "message": "Re-throw template errors and buffer templates.\n\nAdded rethrowing of template errors in prod mode so the application can\nreturn it's 500 code or otherwise handle the exception from the main\nexception handling code. This requires full buffering of the template\noutput since we can't guarantee that we haven't flushed some part of the\nresponse to the user. I think in most cases this will not matter, as the\nperformance tests I ran showed slightly higher GC pressure but a bit\nmore reqs/s with full buffering.", "file_num_lines": 53, "diff_parsed": {"added": [[30, "import org.slf4j.Logger;"], [55, "                                        Writer out) throws TemplateException {"], [57, "        if (!ninjaProperties.isProd()) {"], [83, "            logger.error(\"Templating error.\", te);"], [85, "        // Let the exception bubble up to the central handlers"], [86, "        // so the application can return the correct error page"], [87, "        // or perform some other application specific action."], [88, "        throw te;"]], "deleted": [[21, "import java.util.logging.Level;"], [22, "import java.util.logging.Logger;"], [56, "                                        Writer out) {"], [58, "        if (ninjaProperties.isProd()) {"], [59, ""], [60, "            PrintWriter pw = (out instanceof PrintWriter) ? (PrintWriter) out"], [61, "                    : new PrintWriter(out);"], [62, "            pw.println("], [63, "                     \"<script language=javascript>//\\\"></script>\""], [64, "                    + \"<script language=javascript>//\\'></script>\""], [65, "                    + \"<script language=javascript>//\\\"></script>\""], [66, "                    + \"<script language=javascript>//\\'></script>\""], [67, "                    + \"</title></xmp></script></noscript></style></object>\""], [68, "                    + \"</head></pre></table>\""], [69, "                    + \"</form></table></table></table></a></u></i></b>\""], [70, "                    + \"<div align=left \""], [71, "                    + \"style='background-color:#FFFF00; color:#FF0000; \""], [72, "                    + \"display:block; border-top:double; padding:2pt; \""], [73, "                    + \"font-size:medium; font-family:Arial,sans-serif; \""], [74, "                    + \"font-style: normal; font-variant: normal; \""], [75, "                    + \"font-weight: normal; text-decoration: none; \""], [76, "                    + \"text-transform: none'>\");"], [77, "            pw.println(\"<b style='font-size:medium'>Ooops. A really strange error occurred. Please contact admin if error persists.</b>\");"], [78, "            pw.println(\"</div></html>\");"], [79, "            pw.flush();"], [80, "            pw.close();"], [81, ""], [82, "            logger.log(Level.SEVERE, \"Templating error. This should not happen in production\", te);"], [83, ""], [84, ""], [85, ""], [86, "        } else {"], [87, ""], [113, ""], [114, "            logger.log(Level.SEVERE, \"Templating error.\", te);"]]}, "num_lines_added": 8, "num_lines_removed": 35}