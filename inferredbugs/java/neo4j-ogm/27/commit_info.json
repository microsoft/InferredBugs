{"hash": "f005948e909829fb6b54b563ff2fc2291288ad4a", "message": "Added Driver test to show 2.3.1 Neo4j bug", "file_num_lines": 106, "diff_parsed": {"added": [[24, "    private GraphDatabaseService graphDatabaseService;"], [29, "        logger.debug(\"*** starting new embedded driver instance via service loader, (not yet configured) \" + this);"], [37, "        logger.debug(\"*** starting new embedded driver via explicit config \" + this);"], [49, "        this.graphDatabaseService = graphDatabaseService;"], [50, "        registerShutdownHook();"], [59, "    private void registerShutdownHook() {"], [63, "                close();"], [73, "        close();  // force any existing graph database to shutdown"], [74, ""], [75, "        try {"], [76, "            String fileStoreUri = config.getURI();"], [77, ""], [78, "            // if no URI is set, create a temporary folder for the graph db"], [79, "            // that will persist only for the duration of the JVM"], [80, "            // This is effectively what the ImpermanentDatabase does."], [81, "            if (fileStoreUri == null) {"], [82, "                fileStoreUri = createTemporaryEphemeralFileStore();"], [83, "                config.setURI(fileStoreUri);"], [85, ""], [86, "            File file = new File(new URI(fileStoreUri));"], [87, ""], [88, "            graphDatabaseService = new GraphDatabaseFactory().newEmbeddedDatabase(file.getAbsolutePath());"], [89, ""], [90, "            registerShutdownHook();"], [91, "        } catch (Exception e) {"], [92, "            throw new RuntimeException(e);"], [104, "            logger.debug(\" *** Now shutting down embedded database instance: \" + this);"], [106, "            //"], [107, "            graphDatabaseService = null;"]], "deleted": [[24, "    // a single instance of the driver's graphDatabaseService must be shared among all instances of the driver"], [25, "    // so that we do not run into locking problems."], [26, ""], [27, "    private static GraphDatabaseService graphDatabaseService;"], [50, "        EmbeddedDriver.graphDatabaseService = graphDatabaseService;"], [58, "     * @param graphDb the embedded instance to shutdown"], [60, "    private static void registerShutdownHook(final GraphDatabaseService graphDb) {"], [64, "                graphDb.shutdown();"], [74, "        if (graphDatabaseService == null) {"], [75, "            try {"], [76, "                String fileStoreUri = config.getURI();"], [77, "                if (fileStoreUri == null) {"], [78, "                    fileStoreUri = createTemporaryEphemeralFileStore();"], [79, "                    config.setURI(fileStoreUri);"], [80, "                }"], [81, "                File file = new File(new URI(fileStoreUri));"], [82, "                graphDatabaseService = new GraphDatabaseFactory()"], [83, "                        .newEmbeddedDatabaseBuilder(file.getAbsolutePath())"], [84, "                        .newGraphDatabase();"], [85, "                registerShutdownHook(graphDatabaseService);"], [86, "            } catch (Exception e) {"], [87, "                throw new RuntimeException(e);"]]}, "num_lines_added": 29, "num_lines_removed": 22}