{"hash": "937ecb9f09b8084cee43623192275a81457ccfc7", "message": "update to v1.0.23 \u51c6\u5907\u7740\u624b\u5b9e\u73b0\u65b0\u529f\u80fd\uff08\u672a\u5b8c\u6210\uff09", "file_num_lines": 897, "diff_parsed": {"added": [[10, "import java.nio.channels.FileLock;"], [36, "\tprivate String path;// \u7a0b\u5e8f\u4e3b\u76ee\u5f55\u8def\u5f84"], [37, "\tprivate String fileSystemPath;// \u4e3b\u6587\u4ef6\u7cfb\u7edf\u8def\u5f84"], [38, "\tprivate String confdir;// \u8bbe\u7f6e\u6587\u4ef6\u5939\u8def\u5f84"], [39, "\tprivate String mustLogin;// \u5fc5\u987b\u767b\u5f55"], [40, "\tprivate int port;// \u7aef\u53e3\u53f7"], [41, "\tprivate String log;// \u65e5\u5fd7\u7b49\u7ea7"], [42, "\tprivate String vc;// \u9a8c\u8bc1\u7801\u7c7b\u578b"], [43, "\tprivate String FSPath;// \u4e3b\u6587\u4ef6\u7cfb\u7edf\u8def\u5f84\uff08\u8bbe\u7f6e\u7684\u539f\u59cb\u503c\uff09"], [44, "\tprivate List<ExtendStores> extendStores;// \u6269\u5c55\u5b58\u50a8\u533a\u8def\u5f84\u5217\u8868"], [45, "\tprivate int bufferSize;// \u7f13\u5b58\u5927\u5c0f\uff08byte\uff09"], [46, "\tprivate String fileBlockPath;// \u6587\u4ef6\u5757\u5b58\u50a8\u8def\u5f84\uff08\u4f4d\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff09"], [47, "\tprivate String fileNodePath;// \u6587\u4ef6\u8282\u70b9\u5b58\u50a8\u8def\u5f84\uff08\u4f4d\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff09"], [53, "\tprivate boolean allowChangePassword;// \u662f\u5426\u5141\u8bb8\u7528\u6237\u4fee\u6539\u5bc6\u7801"], [54, "\tprivate boolean openFileChain;// \u662f\u5426\u5f00\u542f\u6c38\u4e45\u5916\u90e8\u94fe\u63a5"], [55, "\tprivate boolean allowSignUp;// \u662f\u5426\u5141\u8bb8\u81ea\u7531\u6ce8\u518c\u65b0\u8d26\u6237\uff08\u9ad8\u7ea7\uff09"], [69, "\tprivate final String DEFAULT_PASSWORD_CHANGE_SETTING = \"N\";"], [70, "\tprivate final String DEFAULT_FILE_CHAIN_SETTING = \"CLOSE\";"], [81, "\tpublic static final int INVALID_CHANGE_PASSWORD_SETTING = 11;"], [82, "\tprivate static final int INNVALID_FILE_CHAIN_SETTING = 12;"], [470, "\t\t\tthis.serverp.setProperty(\"password.change\", ss.isAllowChangePassword() ? \"Y\" : \"N\");"], [471, "\t\t\tthis.serverp.setProperty(\"openFileChain\", ss.isOpenFileChain() ? \"OPEN\" : \"CLOSE\");"], [583, "\t\t// \u662f\u5426\u5141\u8bb8\u7528\u6237\u4fee\u6539\u5bc6\u7801"], [584, "\t\tfinal String changePassword = this.serverp.getProperty(\"password.change\");"], [585, "\t\tif (changePassword == null) {"], [586, "\t\t\tPrinter.instance.print(\"\u8b66\u544a\uff1a\u672a\u627e\u5230\u7528\u6237\u4fee\u6539\u5bc6\u7801\u529f\u80fd\u914d\u7f6e\uff0c\u5c06\u91c7\u7528\u9ed8\u8ba4\u503c\uff08\u7981\u6b62\uff09\u3002\");"], [587, "\t\t\tthis.allowChangePassword = false;"], [588, "\t\t} else {"], [589, "\t\t\tswitch (changePassword) {"], [590, "\t\t\tcase \"Y\":"], [591, "\t\t\t\tthis.allowChangePassword = true;"], [592, "\t\t\t\tbreak;"], [593, "\t\t\tcase \"N\":"], [594, "\t\t\t\tthis.allowChangePassword = false;"], [595, "\t\t\t\tbreak;"], [596, "\t\t\tdefault:"], [597, "\t\t\t\tPrinter.instance.print(\"\u9519\u8bef\uff1a\u7528\u6237\u4fee\u6539\u5bc6\u7801\u529f\u80fd\u8bbe\u7f6e\u65e0\u6548\u3002\");"], [598, "\t\t\t\treturn INVALID_CHANGE_PASSWORD_SETTING;"], [599, "\t\t\t}"], [600, "\t\t}"], [601, "\t\t// \u662f\u5426\u63d0\u4f9b\u6c38\u4e45\u8d44\u6e90\u94fe\u63a5"], [602, "\t\tfinal String fileChain = this.serverp.getProperty(\"openFileChain\");"], [603, "\t\tif (fileChain == null) {"], [604, "\t\t\tPrinter.instance.print(\"\u8b66\u544a\uff1a\u672a\u627e\u5230\u6c38\u4e45\u8d44\u6e90\u94fe\u63a5\u529f\u80fd\u914d\u7f6e\uff0c\u5c06\u91c7\u7528\u9ed8\u8ba4\u503c\uff08\u5173\u95ed\uff09\u3002\");"], [605, "\t\t\tthis.openFileChain = false;"], [606, "\t\t} else {"], [607, "\t\t\tswitch (fileChain) {"], [608, "\t\t\tcase \"OPEN\":"], [609, "\t\t\t\tthis.openFileChain = true;"], [610, "\t\t\t\tbreak;"], [611, "\t\t\tcase \"CLOSE\":"], [612, "\t\t\t\tthis.openFileChain = false;"], [613, "\t\t\t\tbreak;"], [614, "\t\t\tdefault:"], [615, "\t\t\t\tPrinter.instance.print(\"\u9519\u8bef\uff1a\u6c38\u4e45\u8d44\u6e90\u94fe\u63a5\u529f\u80fd\u8bbe\u7f6e\u65e0\u6548\u3002\");"], [616, "\t\t\t\treturn INNVALID_FILE_CHAIN_SETTING;"], [617, "\t\t\t}"], [618, "\t\t}"], [619, "\t\t// \u662f\u5426\u5141\u8bb8\u8bbf\u95ee\u8005\u81ea\u7531\u6ce8\u518c\u8d26\u6237"], [620, "\t\tfinal String signUp = this.accountp.getProperty(\"signUpAuth\");"], [621, "\t\tif (signUp != null) {"], [622, "\t\t\tthis.allowSignUp = true;"], [623, "\t\t} else {"], [624, "\t\t\tthis.allowSignUp = false;"], [625, "\t\t}"], [626, "\t\t// \u7f13\u5b58\u5927\u5c0f"], [780, "\t\tdsp.setProperty(\"password.change\", DEFAULT_PASSWORD_CHANGE_SETTING);"], [781, "\t\tdsp.setProperty(\"openFileChain\", DEFAULT_FILE_CHAIN_SETTING);"], [799, ""], [800, "\t\ttry (FileOutputStream accountSettingOut = new FileOutputStream(this.confdir + ACCOUNT_PROPERTIES_FILE)) {"], [801, "\t\t\tFileLock lock = accountSettingOut.getChannel().lock();"], [802, "\t\t\tdap.store(accountSettingOut, \"<This is the default kiftd account setting file. >\");"], [803, "\t\t\tlock.release();"], [964, "\t\t\t\t\t\t\t\tFileLock lock = accountPropIn.getChannel().lock(0L, Long.MAX_VALUE, true);"], [966, "\t\t\t\t\t\t\t\tlock.release();"], [1100, "\t\t\t\tfoldersId.add(config.substring(index + 6));"], [1105, ""], [1107, "\t\tif (fIds == null || fIds.size() == 0) {"], [1110, "\t\tSet<String> configs = accountp.stringPropertieNames();"], [1112, "\t\tfor (String fId : fIds) {"], [1113, "\t\t\tfor (String config : configs) {"], [1114, "\t\t\t\tif (config.endsWith(\".auth.\" + fId)) {"], [1119, "\t\tfor (String config : invalidConfigs) {"], [1122, "\t\ttry (FileOutputStream accountSettingOut = new FileOutputStream(this.confdir + ACCOUNT_PROPERTIES_FILE)) {"], [1123, "\t\t\tFileLock lock = accountSettingOut.getChannel().lock();"], [1124, "\t\t\taccountp.store(accountSettingOut, null);"], [1125, "\t\t\tlock.release();"], [1132, ""], [1133, "\t/**"], [1134, "\t *"], [1135, "\t * <h2>\u662f\u5426\u5141\u8bb8\u7528\u6237\u4fee\u6539\u5bc6\u7801</h2>"], [1136, "\t * <p>"], [1137, "\t * \u5224\u65ad\u662f\u5426\u5141\u8bb8\u7528\u6237\u4fee\u6539\u5bc6\u7801\uff0c\u82e5\u5141\u8bb8\u5219\u5f00\u542f\u7528\u6237\u4fee\u6539\u5bc6\u7801\u529f\u80fd\u3002"], [1138, "\t * </p>"], [1139, "\t *"], [1140, "\t * @author \u9752\u9633\u9f99\u91ce(kohgylw)"], [1141, "\t * @return boolean \u5141\u8bb8\u5219\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse"], [1142, "\t */"], [1143, "\tpublic boolean isAllowChangePassword() {"], [1144, "\t\treturn allowChangePassword;"], [1145, "\t}"], [1146, ""], [1147, "\t/**"], [1148, "\t *"], [1149, "\t * <h2>\u662f\u5426\u5f00\u542f\u6c38\u4e45\u8d44\u6e90\u94fe\u63a5</h2>"], [1150, "\t * <p>"], [1151, "\t * \u5224\u65ad\u662f\u5426\u5f00\u542f\u6c38\u4e45\u8d44\u6e90\u94fe\u63a5\uff0c\u82e5\u5f00\u542f\u5219\u63d0\u4f9b\u6bcf\u4e2a\u53ef\u4e0b\u8f7d\u6587\u4ef6\u7684\u5916\u90e8\u94fe\u63a5\u3002"], [1152, "\t * </p>"], [1153, "\t *"], [1154, "\t * @author \u9752\u9633\u9f99\u91ce(kohgylw)"], [1155, "\t * @return boolean \u5f00\u542f\u5219\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse"], [1156, "\t */"], [1157, "\tpublic boolean isOpenFileChain() {"], [1158, "\t\treturn openFileChain;"], [1159, "\t}"], [1160, ""], [1161, "\t/**"], [1162, "\t *"], [1163, "\t * <h2>\u662f\u5426\u5141\u8bb8\u6ce8\u518c\u65b0\u8d26\u6237</h2>"], [1164, "\t * <p>"], [1165, "\t * \u5224\u65ad\u662f\u5426\u5141\u8bb8\u6ce8\u518c\u65b0\u8d26\u6237\uff0c\u82e5\u5141\u8bb8\u5219\u8bbf\u95ee\u8005\u53ef\u4ee5\u81ea\u7531\u6ce8\u518c\u65b0\u7684\u8d26\u6237\u3002"], [1166, "\t * </p>"], [1167, "\t *"], [1168, "\t * @author \u9752\u9633\u9f99\u91ce(kohgylw)"], [1169, "\t * @return boolean \u5141\u8bb8\u5219\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse"], [1170, "\t */"], [1171, "\tpublic boolean signUp() {"], [1172, "\t\treturn allowSignUp;"], [1173, "\t}"]], "deleted": [[35, "\tprivate String path;"], [36, "\tprivate String fileSystemPath;"], [37, "\tprivate String confdir;"], [38, "\tprivate String mustLogin;"], [39, "\tprivate int port;"], [40, "\tprivate String log;"], [41, "\tprivate String vc;"], [42, "\tprivate String FSPath;"], [43, "\tprivate List<ExtendStores> extendStores;"], [44, "\tprivate int bufferSize;"], [45, "\tprivate String fileBlockPath;"], [46, "\tprivate String fileNodePath;"], [743, "\t\ttry {"], [744, "\t\t\tdap.store(new FileOutputStream(this.confdir + ACCOUNT_PROPERTIES_FILE),"], [745, "\t\t\t\t\t\"<This is the default kiftd account setting file. >\");"], [1040, "\t\t\t\tfoldersId.add(config.substring(index+6));"], [1045, ""], [1047, "\t\tif(fIds == null || fIds.size() == 0) {"], [1050, "\t\tSet<String> configs=accountp.stringPropertieNames();"], [1052, "\t\tfor(String fId:fIds) {"], [1053, "\t\t\tfor (String config:configs) {"], [1054, "\t\t\t\tif(config.endsWith(\".auth.\"+fId)) {"], [1059, "\t\tfor(String config:invalidConfigs) {"], [1062, "\t\ttry {"], [1063, "\t\t\taccountp.store(new FileOutputStream(this.confdir + ACCOUNT_PROPERTIES_FILE), null);"]]}, "num_lines_added": 129, "num_lines_removed": 25}