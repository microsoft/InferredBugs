{"hash": "0ab6226a81200672e774c71b17bf9871043b053a", "message": "HBX-1375: Implement org.hibernate.tools.test.util.JdbcUtil#isDatabaseOnline()", "file_num_lines": 108, "diff_parsed": {"added": [[8, "import java.sql.ResultSet;"], [18, "\tpublic static Properties getConnectionProperties() {"], [20, "\t\tInputStream inputStream = Thread"], [21, "\t\t\t\t.currentThread()"], [22, "\t\t\t\t.getContextClassLoader()"], [44, "\t\t\tCONNECTION_TABLE.put(test, createJdbcConnection());"], [62, "\t\t\texecuteSql(CONNECTION_TABLE.get(test), sqls);"], [83, ""], [84, "\tpublic static boolean isDatabaseOnline() {"], [85, "\t\tboolean result = false;"], [86, "\t\ttry {"], [87, "\t\t\tConnection connection = createJdbcConnection();"], [88, "\t\t\tStatement statement = connection.createStatement();"], [89, "\t\t\tResultSet resultSet = statement.executeQuery(\"SELECT 1 AS C\");"], [90, "\t\t\tif (resultSet.next()) {"], [91, "\t\t\t\tresult = resultSet.getInt(\"C\") == 1;"], [92, "\t\t\t}"], [93, "\t\t\tconnection.commit();"], [94, "\t\t\tstatement.close();"], [95, "\t\t\tconnection.close();"], [96, "\t\t} catch (SQLException e) {"], [97, "\t\t\t// this will happen when the database is offline"], [98, "\t\t}"], [99, "\t\treturn result;"], [100, "\t}"], [101, ""], [102, "\tprivate static Connection createJdbcConnection()"], [103, "\t\t\tthrows SQLException {"], [104, "\t\tProperties connectionProperties = getConnectionProperties();"], [105, "\t\tString connectionUrl = (String)connectionProperties.remove(\"url\");"], [106, "\t\treturn DriverManager"], [107, "\t\t\t\t.getDriver(connectionUrl)"], [108, "\t\t\t\t.connect(connectionUrl, connectionProperties);"], [109, "\t}"], [110, ""], [111, "\tprivate static void executeSql(Connection connection, String[] sqls)"], [112, "\t\t\tthrows SQLException {"], [113, "\t\tStatement statement = connection.createStatement();"], [114, "\t\tfor (int i = 0; i < sqls.length; i++) {"], [115, "\t\t\tstatement.execute(sqls[i]);"], [116, "\t\t}"], [117, "\t\tconnection.commit();"], [118, "\t\tstatement.close();"], [119, "\t}"]], "deleted": [[17, "\tpublic static Properties getConnectionProperties(Class<?> clazz) {"], [19, "\t\tInputStream inputStream = clazz"], [20, "\t\t\t\t.getClassLoader()"], [41, "\t\tProperties connectionProperties = getConnectionProperties(test.getClass());"], [42, "\t\tString connectionUrl = (String)connectionProperties.remove(\"url\");"], [44, "\t\t\tConnection connection = DriverManager"], [45, "\t\t\t\t\t.getDriver(connectionUrl)"], [46, "\t\t\t\t\t.connect(connectionUrl, connectionProperties);"], [47, "\t\t\tCONNECTION_TABLE.put(test, connection);"], [64, "\t\tConnection connection = CONNECTION_TABLE.get(test);"], [66, "\t\t\tStatement statement = connection.createStatement();"], [67, "\t\t\tfor (int i = 0; i < sqls.length; i++) {"], [68, "\t\t\t\tstatement.execute(sqls[i]);"], [69, "\t\t\t}"], [70, "\t\t\tconnection.commit();"], [71, "\t\t\tstatement.close();"]]}, "num_lines_added": 44, "num_lines_removed": 16}